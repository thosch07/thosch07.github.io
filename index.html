<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Enhanced Trading Psychology Assessment</title>
    
    <!-- PayPal SDK with your LIVE Client ID -->
    <script src="https://www.paypal.com/sdk/js?client-id=AQ7d8ZPGOLBz3AC4uVlNgysPHMDEXUvqc2auLwqra9Ou_Wg4qIBNAAcjdAxwgKBIzISotkfcM8x0QgYm&currency=USD"></script>
    
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0f1c 0%, #1a2332 100%);
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(26, 35, 50, 0.9);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 700px;
            width: 100%;
            padding: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #4ade80, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 18px;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80, #3b82f6);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-container {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .question-container.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question {
            font-size: 20px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .options {
            display: grid;
            gap: 12px;
        }

        .option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            padding: 16px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(74, 222, 128, 0.5);
            transform: translateX(5px);
        }

        .option.selected {
            background: rgba(74, 222, 128, 0.2);
            border-color: #4ade80;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 10px;
        }

        button {
            background: linear-gradient(135deg, #4ade80, #3b82f6);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(74, 222, 128, 0.3);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            position: relative;
        }

        .score-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
        }

        .insights {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: left;
        }

        .insight-item {
            margin-bottom: 20px;
            padding-left: 25px;
            position: relative;
        }

        .insight-item:before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: #4ade80;
            font-size: 20px;
        }

        .cta-section {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(59, 130, 246, 0.1));
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
            border: 1px solid rgba(74, 222, 128, 0.3);
        }

        .cta-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: #4ade80;
        }

        .cta-description {
            color: #cbd5e1;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        input[type="email"] {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        input[type="email"]:focus {
            outline: none;
            border-color: #4ade80;
            background: rgba(255, 255, 255, 0.15);
        }

        input[type="email"]::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .tool-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .tool-card:hover {
            transform: translateY(-2px);
            border-color: rgba(74, 222, 128, 0.3);
            background: rgba(255, 255, 255, 0.08);
        }

        .tool-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #4ade80;
        }

        .tool-date {
            color: #94a3b8;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .tool-description {
            color: #cbd5e1;
            line-height: 1.5;
        }

        .admin-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: #1a2332;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.5);
            transition: right 0.3s ease;
            overflow-y: auto;
            z-index: 1000;
            padding: 20px;
        }

        .admin-panel.active {
            right: 0;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .close-admin {
            cursor: pointer;
            font-size: 24px;
            color: #94a3b8;
            transition: color 0.3s ease;
        }

        .close-admin:hover {
            color: #ffffff;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #4ade80;
        }

        .assessment-list {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .assessment-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
            color: #cbd5e1;
        }

        .assessment-item:last-child {
            border-bottom: none;
        }

        /* PayPal Button Container */
        #paypal-button-container {
            margin-top: 20px;
            min-height: 50px;
        }

        .paypal-loading {
            text-align: center;
            color: #94a3b8;
            padding: 20px;
        }

        .purchase-section {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(59, 130, 246, 0.1));
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
            border: 1px solid rgba(74, 222, 128, 0.3);
            text-align: center;
        }

        /* Manual PayPal Button */
        .manual-paypal-button {
            width: 100%;
            padding: 15px;
            background: #FFC439;
            color: #111;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            display: none;
        }

        .manual-paypal-button:hover {
            background: #FFB000;
        }

        /* Launch Week Special Styles */
        .launch-special {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid #f59e0b;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .launch-special h3 {
            color: #000;
            margin: 0 0 10px 0;
            font-size: 24px;
        }

        .launch-special p {
            color: #000;
            font-weight: 600;
            margin: 0;
        }

        #countdown {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            padding: 10px 20px;
            border-radius: 8px;
            display: inline-block;
            margin: 15px 0;
            font-weight: bold;
            color: #ef4444;
        }

        .old-price {
            text-decoration: line-through;
            color: #94a3b8;
            font-size: 18px;
        }

        .new-price {
            color: #4ade80;
            font-size: 28px;
            font-weight: bold;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <!-- Start Screen -->
        <div id="startScreen" class="start-screen">
            <div class="header">
                <h1>AI-Enhanced Trading Psychology Assessment</h1>
                <p class="subtitle">Discover your psychological trading patterns in 2 minutes</p>
            </div>
            <div style="text-align: center; margin-top: 40px;">
                <button onclick="startAssessment()" style="padding: 16px 40px; font-size: 18px;">
                    Start Free Assessment
                </button>
                <p style="margin-top: 20px; color: #94a3b8; font-size: 14px;">
                    No email required ‚Ä¢ 100% free ‚Ä¢ Instant results
                </p>
            </div>
        </div>

        <!-- Assessment Screen -->
        <div id="assessmentScreen" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            
            <div id="questionContainer"></div>
            
            <div class="navigation">
                <button id="prevBtn" onclick="previousQuestion()" disabled>Previous</button>
                <button id="nextBtn" onclick="nextQuestion()" disabled>Next</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="results">
            <h2 style="font-size: 36px; margin-bottom: 30px;">Your Psychology Profile</h2>
            
            <div class="score-circle">
                <svg width="200" height="200">
                    <circle cx="100" cy="100" r="90" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="20"/>
                    <circle id="scoreCircle" cx="100" cy="100" r="90" fill="none" stroke="url(#gradient)" stroke-width="20" 
                            stroke-dasharray="565" stroke-dashoffset="565" transform="rotate(-90 100 100)"
                            style="transition: stroke-dashoffset 1s ease"/>
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#4ade80;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                </svg>
                <div class="score-value" id="scoreValue">0</div>
            </div>

            <div class="insights" id="insights"></div>

            <!-- Launch Week Special Banner -->
            <div class="launch-special">
                <h3>üöÄ LAUNCH WEEK SPECIAL - 25% OFF!</h3>
                <p>Get your complete 10-page analysis for only $35 (normally $47)</p>
                <p style="font-size: 14px; margin-top: 10px;">‚è∞ Offer expires Sunday, June 16th at midnight</p>
            </div>

            <!-- Countdown Timer -->
            <div style="text-align: center; margin: 20px 0;">
                <div id="countdown"></div>
            </div>

            <!-- Purchase Section -->
            <div class="purchase-section">
                <h3 class="cta-title">üìÑ Want a Detailed Professional Analysis?</h3>
                <p class="cta-description">
                    Get your complete 10-page AI-generated psychology report with personalized strategies, 
                    90-day improvement roadmap, and professional trading toolkit.
                </p>
                <p style="font-size: 20px; margin: 15px 0;">
                    <span class="old-price">$47</span>
                    <span class="new-price">NOW: $35</span>
                </p>
                <p style="font-size: 14px; color: #94a3b8; margin-bottom: 20px;">
                    Included in Your Premium Package:
                </p>
                <ul style="text-align: left; display: inline-block; color: #cbd5e1; margin-bottom: 20px;">
                    <li>Complete 10-page professional psychology analysis</li>
                    <li>Unlimited assessment retakes to track progress</li>
                    <li>Priority email notifications for new AI tools (Q3/Q4 2025)</li>
                    <li>Access to updated assessment versions when available</li>
                </ul>
                <input type="email" id="purchaseEmailInput" placeholder="Enter your email address" />
                <div id="paypal-button-container">
                    <div class="paypal-loading">Loading PayPal...</div>
                </div>
                
                <!-- Manual PayPal Button (Backup) -->
                <button class="manual-paypal-button" id="manualPayPalButton" onclick="manualPayPalCheckout()">
                    Pay with PayPal - $35
                </button>
                
                <!-- Admin test button (hidden by default) -->
                <button id="testPurchaseBtn" onclick="testPurchase()" style="display: none; margin-top: 15px; background: #666;">
                    Test Purchase (Admin Only)
                </button>
            </div>

            <!-- Waitlist Section -->
            <div class="cta-section" style="margin-top: 20px;">
                <h3 class="cta-title">üîÆ AI Tools Coming Q3/Q4 2025!</h3>
                <p class="cta-description">
                    Be first to access our revolutionary AI-powered trading psychology tools. 
                    No spam, just early access notifications.
                </p>
                
                <div class="tool-card">
                    <div class="tool-name">üßÆ AI Risk Calculator</div>
                    <div class="tool-date">Coming Q3 2025</div>
                    <div class="tool-description">
                        Instantly calculate optimal position sizes based on your psychology profile
                    </div>
                </div>
                
                <div class="tool-card">
                    <div class="tool-name">üéØ Real-time Emotion Detector</div>
                    <div class="tool-date">Coming Q4 2025</div>
                    <div class="tool-description">
                        Analyze your trading messages and alerts for emotional bias
                    </div>
                </div>
                
                <div class="tool-card">
                    <div class="tool-name">üìä Psychology Analytics Dashboard</div>
                    <div class="tool-date">Coming Q4 2025</div>
                    <div class="tool-description">
                        Track your daily mood patterns vs trading performance
                    </div>
                </div>
                
                <input type="email" id="waitlistEmailInput" placeholder="Enter your email for early access" />
                <button onclick="joinWaitlist()" style="width: 100%;">
                    Get Early Access üöÄ
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <h2>Admin Dashboard</h2>
            <span class="close-admin" onclick="toggleAdminPanel()">√ó</span>
        </div>
        
        <div class="stat-card">
            <div class="stat-label">Total Assessments</div>
            <div class="stat-value" id="totalAssessments">0</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-label">Revenue</div>
            <div class="stat-value" id="totalRevenue">$0</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-label">Waitlist Signups</div>
            <div class="stat-value" id="waitlistCount">0</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-label">Purchase Conversion</div>
            <div class="stat-value" id="conversionRate">0%</div>
        </div>
        
        <button onclick="exportData()" style="width: 100%; margin-top: 20px;">
            Export All Data (CSV)
        </button>
        
        <button onclick="clearAllData()" style="width: 100%; margin-top: 10px; background: #ef4444;">
            Clear All Data
        </button>
        
        <div class="assessment-list" id="assessmentList">
            <h3 style="margin-bottom: 10px;">Recent Assessments</h3>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;

        const questions = [
            {
                question: "When you see your trade moving against you, what's your first instinct?",
                options: [
                    "Close immediately to minimize losses",
                    "Add to the position (average down)",
                    "Wait and hope it reverses",
                    "Check my original analysis before deciding"
                ]
            },
            {
                question: "How do you typically feel after a winning trade?",
                options: [
                    "Confident and ready to trade more",
                    "Lucky and worried it won't happen again",
                    "Analytical - I review what went right",
                    "Frustrated I didn't position bigger"
                ]
            },
            {
                question: "What describes your trade planning process?",
                options: [
                    "I have detailed plans with entry, stop loss, and targets",
                    "I have a general idea but adjust as I go",
                    "I rely mainly on instinct and market feel",
                    "I follow others' recommendations"
                ]
            },
            {
                question: "After a losing streak, you typically:",
                options: [
                    "Take a break to reset mentally",
                    "Trade smaller until confidence returns",
                    "Trade bigger to recover losses quickly",
                    "Switch strategies completely"
                ]
            },
            {
                question: "Your biggest trading weakness is probably:",
                options: [
                    "Cutting profits too early",
                    "Holding losses too long",
                    "Overtrading when emotional",
                    "Analysis paralysis"
                ]
            },
            {
                question: "How do you handle FOMO (Fear of Missing Out)?",
                options: [
                    "I stick to my plan regardless",
                    "Sometimes chase if the setup looks really good",
                    "Often jump in late and regret it",
                    "I've learned to wait for the next opportunity"
                ]
            },
            {
                question: "What percentage of your trades follow your predefined rules?",
                options: [
                    "90-100% - I'm very disciplined",
                    "70-89% - Mostly disciplined",
                    "50-69% - About half the time",
                    "Less than 50% - I often trade on feel"
                ]
            },
            {
                question: "When you're having a great trading day, you:",
                options: [
                    "Stick to my daily limits and stop",
                    "Trade a bit more but stay careful",
                    "Increase position sizes significantly",
                    "Keep trading until I have a loss"
                ]
            }
        ];

        let currentQuestion = 0;
        let answers = [];
        let assessmentData = {
            timestamp: null,
            answers: [],
            score: null,
            profile: null,
            email: null,
            waitlist: false,
            purchase: false,
            transactionId: null
        };
        
        // PayPal initialization variables
        let paypalButtonsInitialized = false;
        let paypalRetryCount = 0;
        const maxPaypalRetries = 10;

        // Countdown Timer
        function updateCountdown() {
            const deadline = new Date('2025-06-16T00:00:00+02:00'); // Sunday midnight MEZ
            const now = new Date();
            const diff = deadline - now;
            
            if (diff > 0) {
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('countdown').innerHTML = 
                    `‚è∞ OFFER ENDS IN: ${days}d ${hours}h ${minutes}m ${seconds}s`;
            } else {
                document.getElementById('countdown').innerHTML = 'OFFER EXPIRED';
                // Reset to normal price
                document.querySelector('.new-price').textContent = '$47';
                document.querySelector('.old-price').style.display = 'none';
            }
        }

        // Initialize PayPal with Launch Price
        function initializePayPal() {
            console.log('üîÑ Attempting to initialize PayPal with Launch Special price...');
            
            // Check if container exists
            const container = document.getElementById('paypal-button-container');
            if (!container) {
                console.error('‚ùå PayPal container not found');
                return;
            }
            
            // Check if PayPal SDK is loaded
            if (typeof paypal === 'undefined') {
                paypalRetryCount++;
                if (paypalRetryCount < maxPaypalRetries) {
                    console.warn('‚è≥ PayPal SDK not loaded yet. Retrying in 1 second...');
                    setTimeout(initializePayPal, 1000);
                } else {
                    console.error('‚ùå PayPal SDK failed to load after ' + maxPaypalRetries + ' attempts');
                    showManualPayPalButton();
                }
                return;
            }
            
            // Clear loading message
            container.innerHTML = '';
            
            console.log('‚úÖ PayPal SDK loaded, initializing buttons with $35 launch price...');
            
            try {
                paypal.Buttons({
                    createOrder: function(data, actions) {
                        const email = document.getElementById('purchaseEmailInput').value;
                        if (!email) {
                            alert('Please enter your email address');
                            return;
                        }
                        
                        console.log('üì¶ Creating order for:', email);
                        
                        return actions.order.create({
                            purchase_units: [{
                                amount: {
                                    value: '35.00', // LAUNCH SPECIAL PRICE!
                                    currency_code: 'USD'
                                },
                                description: 'Trading Psychology Premium Analysis - Launch Week Special'
                            }]
                        });
                    },
                    onApprove: function(data, actions) {
                        console.log('‚úÖ Payment approved, capturing...');
                        
                        return actions.order.capture().then(function(details) {
                            const email = document.getElementById('purchaseEmailInput').value;
                            console.log('üí∞ Payment captured:', details);
                            handleSuccessfulPayment(email, details.id);
                        });
                    },
                    onError: function(err) {
                        console.error('‚ùå PayPal error:', err);
                        alert('Payment failed. Please try again.');
                    },
                    onCancel: function(data) {
                        console.log('‚ùå Payment cancelled by user');
                    }
                }).render('#paypal-button-container').then(function() {
                    console.log('‚úÖ PayPal buttons rendered successfully with launch price');
                    paypalButtonsInitialized = true;
                }).catch(function(err) {
                    console.error('‚ùå Failed to render PayPal buttons:', err);
                    showManualPayPalButton();
                });
            } catch (error) {
                console.error('‚ùå Error initializing PayPal:', error);
                showManualPayPalButton();
            }
        }

        // Show manual PayPal button as fallback
        function showManualPayPalButton() {
            console.log('üì± Showing manual PayPal button as fallback');
            document.getElementById('paypal-button-container').style.display = 'none';
            document.getElementById('manualPayPalButton').style.display = 'block';
        }

        // Manual PayPal checkout with launch price
        function manualPayPalCheckout() {
            const email = document.getElementById('purchaseEmailInput').value;
            if (!email) {
                alert('Please enter your email address');
                return;
            }
            
            // Your PayPal email
            const paypalEmail = 'th.schnitzlein@gmail.com';
            
            // Create PayPal payment URL with launch price
            const paypalUrl = 'https://www.paypal.com/cgi-bin/webscr?' + 
                'cmd=_xclick' +
                '&business=' + encodeURIComponent(paypalEmail) +
                '&item_name=' + encodeURIComponent('Trading Psychology Premium Analysis - Launch Special') +
                '&amount=35.00' + // LAUNCH PRICE!
                '&currency_code=USD' +
                '&return=' + encodeURIComponent(window.location.href + '?success=true') +
                '&cancel_return=' + encodeURIComponent(window.location.href) +
                '&custom=' + encodeURIComponent(email) +
                '&no_note=1' +
                '&no_shipping=1';
            
            // Save email for later
            sessionStorage.setItem('pendingPurchaseEmail', email);
            
            console.log('üîó Redirecting to PayPal with launch price:', paypalUrl);
            
            // Redirect to PayPal
            window.location.href = paypalUrl;
        }

        // Check for successful payment return
        function checkPaymentReturn() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('success') === 'true') {
                const email = sessionStorage.getItem('pendingPurchaseEmail');
                if (email) {
                    console.log('‚úÖ Payment successful return detected');
                    handleSuccessfulPayment(email, 'PAYPAL-' + Date.now());
                    sessionStorage.removeItem('pendingPurchaseEmail');
                    // Remove success parameter from URL
                    window.history.replaceState({}, '', window.location.pathname);
                }
            }
        }

        function startAssessment() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('assessmentScreen').style.display = 'block';
            showQuestion();
        }

        function showQuestion() {
            const container = document.getElementById('questionContainer');
            const progressBar = document.getElementById('progressBar');
            
            progressBar.style.width = ((currentQuestion + 1) / questions.length * 100) + '%';
            
            container.innerHTML = `
                <div class="question-container active">
                    <h2 class="question">${questions[currentQuestion].question}</h2>
                    <div class="options">
                        ${questions[currentQuestion].options.map((option, index) => `
                            <div class="option" onclick="selectOption(${index})">${option}</div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            updateButtons();
        }

        function selectOption(index) {
            answers[currentQuestion] = index;
            
            document.querySelectorAll('.option').forEach((opt, i) => {
                opt.classList.toggle('selected', i === index);
            });
            
            document.getElementById('nextBtn').disabled = false;
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            }
        }

        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            document.getElementById('nextBtn').disabled = answers[currentQuestion] === undefined;
            document.getElementById('nextBtn').textContent = 
                currentQuestion === questions.length - 1 ? 'See Results' : 'Next';
        }

        function calculateScore() {
            const scoreMap = {
                0: [3, 2, 1, 4],
                1: [3, 2, 4, 1],
                2: [4, 3, 2, 1],
                3: [4, 3, 1, 2],
                4: [3, 2, 1, 4],
                5: [4, 2, 1, 3],
                6: [4, 3, 2, 1],
                7: [4, 3, 2, 1]
            };
            
            let totalScore = 0;
            answers.forEach((answer, questionIndex) => {
                totalScore += scoreMap[questionIndex][answer];
            });
            
            return Math.round((totalScore / 32) * 100);
        }

        function getProfile(score) {
            if (score >= 80) {
                return {
                    type: "Disciplined Strategist",
                    description: "You demonstrate exceptional emotional control and systematic approach to trading.",
                    strengths: ["Excellent risk management", "Consistent rule following", "Emotional stability"],
                    weaknesses: ["Possible over-cautiousness", "May miss opportunities"],
                    color: "#4ade80"
                };
            } else if (score >= 60) {
                return {
                    type: "Evolving Trader",
                    description: "You show good foundation but struggle with consistency under pressure.",
                    strengths: ["Growing discipline", "Learning from mistakes", "Developing systems"],
                    weaknesses: ["Occasional emotional trading", "Inconsistent execution"],
                    color: "#3b82f6"
                };
            } else if (score >= 40) {
                return {
                    type: "Emotional Challenger",
                    description: "Your trading is significantly impacted by emotions and lacks systematic approach.",
                    strengths: ["High motivation", "Quick decision making", "Adaptability"],
                    weaknesses: ["Poor risk management", "Impulsive decisions", "Revenge trading"],
                    color: "#f59e0b"
                };
            } else {
                return {
                    type: "Risk Seeker",
                    description: "Your trading style is highly risky and driven by emotions rather than strategy.",
                    strengths: ["Bold approach", "Quick to act", "High risk tolerance"],
                    weaknesses: ["No risk management", "Gambling mentality", "Ignore rules"],
                    color: "#ef4444"
                };
            }
        }

        function showResults() {
            const score = calculateScore();
            const profile = getProfile(score);
            
            assessmentData = {
                timestamp: new Date().toISOString(),
                answers: answers,
                score: score,
                profile: profile.type,
                email: null,
                waitlist: false,
                purchase: false,
                transactionId: null
            };
            
            saveAssessment();
            
            document.getElementById('assessmentScreen').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'block';
            
            // Animate score circle
            setTimeout(() => {
                const circle = document.getElementById('scoreCircle');
                const offset = 565 - (565 * score / 100);
                circle.style.strokeDashoffset = offset;
                
                // Animate score number
                let currentScore = 0;
                const increment = score / 50;
                const timer = setInterval(() => {
                    currentScore += increment;
                    if (currentScore >= score) {
                        currentScore = score;
                        clearInterval(timer);
                    }
                    document.getElementById('scoreValue').textContent = Math.round(currentScore);
                }, 20);
            }, 100);
            
            // Show insights
            const insightsHTML = `
                <h3 style="color: ${profile.color}; margin-bottom: 20px;">${profile.type}</h3>
                <p style="color: #cbd5e1; margin-bottom: 20px; line-height: 1.6;">${profile.description}</p>
                
                <h4 style="color: #4ade80; margin-bottom: 15px;">Your Strengths:</h4>
                ${profile.strengths.map(s => `<div class="insight-item">${s}</div>`).join('')}
                
                <h4 style="color: #f59e0b; margin-bottom: 15px; margin-top: 25px;">Areas for Improvement:</h4>
                ${profile.weaknesses.map(w => `<div class="insight-item">${w}</div>`).join('')}
            `;
            
            document.getElementById('insights').innerHTML = insightsHTML;
            
            // Initialize PayPal after results are shown
            setTimeout(initializePayPal, 500);
            
            // Start countdown timer
            setInterval(updateCountdown, 1000);
            updateCountdown();
        }

        function handleSuccessfulPayment(email, transactionId) {
            assessmentData.email = email;
            assessmentData.purchase = true;
            assessmentData.transactionId = transactionId;
            saveAssessment();
            
            // Generate and download PDF
            generatePDF(email);
            
            // Show success message
            alert(`‚úÖ Payment successful! Your premium analysis has been sent to ${email}`);
            
            // Update UI
            const container = document.getElementById('paypal-button-container');
            if (container) {
                container.innerHTML = '<p style="color: #4ade80;">‚úÖ Purchase complete! Check your downloads.</p>';
            }
            document.getElementById('manualPayPalButton').style.display = 'none';
        }

        function testPurchase() {
            const email = document.getElementById('purchaseEmailInput').value;
            if (!email) {
                alert('Please enter your email address');
                return;
            }
            
            console.log('üß™ Test purchase initiated');
            handleSuccessfulPayment(email, 'TEST-' + Date.now());
        }

        function generatePDF(email) {
            const doc = new jsPDF();
            const profile = getProfile(assessmentData.score);
            
            // Cover Page
            doc.setFillColor(10, 15, 28);
            doc.rect(0, 0, 210, 297, 'F');
            
            doc.setTextColor(74, 222, 128);
            doc.setFontSize(32);
            doc.setFont(undefined, 'bold');
            doc.text('AI-Enhanced Trading', 105, 80, { align: 'center' });
            doc.text('Psychology Analysis', 105, 95, { align: 'center' });
            
            doc.setTextColor(148, 163, 184);
            doc.setFontSize(16);
            doc.setFont(undefined, 'normal');
            doc.text('Professional Report', 105, 115, { align: 'center' });
            
            doc.setTextColor(74, 222, 128);
            doc.setFontSize(48);
            doc.setFont(undefined, 'bold');
            doc.text(`${assessmentData.score}`, 105, 145, { align: 'center' });
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(20);
            doc.text(profile.type, 105, 165, { align: 'center' });
            
            doc.setTextColor(148, 163, 184);
            doc.setFontSize(12);
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, 105, 250, { align: 'center' });
            doc.text(email, 105, 260, { align: 'center' });
            
            // Page 2: Executive Summary
            doc.addPage();
            doc.setFillColor(10, 15, 28);
            doc.rect(0, 0, 210, 297, 'F');
            
            doc.setTextColor(74, 222, 128);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('Executive Summary', 20, 30);
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            
            const summaryText = [
                `Psychology Score: ${assessmentData.score}/100`,
                `Profile Type: ${profile.type}`,
                '',
                'Key Findings:',
                `‚Ä¢ ${profile.description}`,
                '',
                'Critical Action Items:',
                '‚Ä¢ Implement strict risk management rules',
                '‚Ä¢ Create detailed trading plan',
                '‚Ä¢ Track emotional patterns daily',
                '‚Ä¢ Review trades weekly'
            ];
            
            let yPos = 50;
            summaryText.forEach(line => {
                doc.text(line, 20, yPos);
                yPos += 8;
            });
            
            // Page 3: Detailed Pattern Analysis
            doc.addPage();
            doc.setFillColor(10, 15, 28);
            doc.rect(0, 0, 210, 297, 'F');
            
            doc.setTextColor(74, 222, 128);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('Pattern Analysis', 20, 30);
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            
            const patterns = [
                'Trading Behavior Patterns:',
                '',
                '1. Emotional Response Pattern:',
                `   Your score indicates ${profile.type} tendencies.`,
                '   This means you tend to react to market movements with',
                `   ${score >= 60 ? 'controlled' : 'emotional'} responses.`,
                '',
                '2. Risk Management Pattern:',
                `   Your risk tolerance appears to be ${score >= 60 ? 'balanced' : 'excessive'}.`,
                '   This impacts your position sizing and stop loss placement.',
                '',
                '3. Decision Making Pattern:',
                `   You show ${score >= 60 ? 'systematic' : 'impulsive'} decision making.`,
                '   This affects your trade entry and exit timing.'
            ];
            
            yPos = 50;
            patterns.forEach(line => {
                doc.text(line, 20, yPos);
                yPos += 8;
            });
            
            // Page 4: Psychology Risk Assessment
            doc.addPage();
            doc.setFillColor(10, 15, 28);
            doc.rect(0, 0, 210, 297, 'F');
            
            doc.setTextColor(74, 222, 128);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('Psychology Risk Assessment', 20, 30);
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            
            // Risk visualization
            const riskLevel = score < 40 ? 'HIGH' : score < 60 ? 'MEDIUM' : score < 80 ? 'LOW' : 'MINIMAL';
            const riskColor = score < 40 ? [239, 68, 68] : score < 60 ? [245, 158, 11] : score < 80 ? [59, 130, 246] : [74, 222, 128];
            
            doc.setTextColor(...riskColor);
            doc.setFontSize(36);
            doc.setFont(undefined, 'bold');
            doc.text(`${riskLevel} RISK`, 105, 70, { align: 'center' });
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            
            const riskFactors = [
                '',
                'Key Risk Factors:',
                '',
                `‚Ä¢ Emotional Control: ${score >= 60 ? 'Good' : 'Needs improvement'}`,
                `‚Ä¢ Discipline Level: ${score >= 60 ? 'Adequate' : 'Low'}`,
                `‚Ä¢ Risk Management: ${score >= 60 ? 'Present' : 'Lacking'}`,
                `‚Ä¢ Trading Plan: ${score >= 60 ? 'Structured' : 'Undefined'}`,
                '',
                'Risk Management Priorities:',
                '',
                '1. Always use stop losses',
                '2. Risk only 1-2% per trade',
                '3. Keep a trading journal',
                '4. Review trades weekly',
                '5. Take breaks after losses'
            ];
            
            yPos = 100;
            riskFactors.forEach(line => {
                doc.text(line, 20, yPos);
                yPos += 8;
            });
            
            // Page 5: 90-Day Improvement Roadmap
            doc.addPage();
            doc.setFillColor(10, 15, 28);
            doc.rect(0, 0, 210, 297, 'F');
            
            doc.setTextColor(74, 222, 128);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('90-Day Improvement Roadmap', 20, 30);
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            
            const roadmap = [
                'Days 1-30: Foundation Building',
                '',
                '‚Ä¢ Create written trading plan',
                '‚Ä¢ Set daily loss limits',
                '‚Ä¢ Start trading journal',
                '‚Ä¢ Practice with smaller positions',
                '',
                'Days 31-60: Habit Formation',
                '',
                '‚Ä¢ Review trades every weekend',
                '‚Ä¢ Track emotional states before trading',
                '‚Ä¢ Implement pre-trade checklist',
                '‚Ä¢ Focus on process over profits',
                '',
                'Days 61-90: Advanced Development',
                '',
                '‚Ä¢ Analyze win/loss patterns',
                '‚Ä¢ Optimize entry/exit rules',
                '‚Ä¢ Develop personal trading edge',
                '‚Ä¢ Build confidence through consistency'
            ];
            
            yPos = 50;
            roadmap.forEach(line => {
                doc.text(line, 20, yPos);
                yPos += 8;
            });
            
            // Page 6: Personalized Action Strategies
            doc.addPage();
            doc.setFillColor(10, 15, 28);
            doc.rect(0, 0, 210, 297, 'F');
            
            doc.setTextColor(74, 222, 128);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('Personalized Action Strategies', 20, 30);
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            
            const strategies = profile.type === "Disciplined Strategist" ? [
                'Your Personalized Strategies:',
                '',
                '1. Leverage Your Strengths:',
                '   ‚Ä¢ Continue systematic approach',
                '   ‚Ä¢ Mentor other traders',
                '   ‚Ä¢ Document your process',
                '',
                '2. Address Weaknesses:',
                '   ‚Ä¢ Be open to calculated risks',
                '   ‚Ä¢ Avoid over-analysis',
                '   ‚Ä¢ Trust your system',
                '',
                '3. Daily Actions:',
                '   ‚Ä¢ Morning market analysis',
                '   ‚Ä¢ Set daily goals',
                '   ‚Ä¢ Evening performance review'
            ] : profile.type === "Evolving Trader" ? [
                'Your Personalized Strategies:',
                '',
                '1. Build Consistency:',
                '   ‚Ä¢ Create strict trading rules',
                '   ‚Ä¢ Follow them for 30 days',
                '   ‚Ä¢ Track compliance daily',
                '',
                '2. Emotional Management:',
                '   ‚Ä¢ Pre-trade breathing exercise',
                '   ‚Ä¢ Set alerts instead of watching',
                '   ‚Ä¢ Take breaks after 3 trades',
                '',
                '3. Skill Development:',
                '   ‚Ä¢ Focus on one strategy',
                '   ‚Ä¢ Master before adding more',
                '   ‚Ä¢ Review successful trades'
            ] : [
                'Your Personalized Strategies:',
                '',
                '1. Risk Control First:',
                '   ‚Ä¢ Reduce position sizes by 50%',
                '   ‚Ä¢ Use hard stop losses',
                '   ‚Ä¢ Maximum 3 trades per day',
                '',
                '2. Build Discipline:',
                '   ‚Ä¢ Write rules before trading',
                '   ‚Ä¢ No trades without plan',
                '   ‚Ä¢ Review every trade',
                '',
                '3. Emotional Reset:',
                '   ‚Ä¢ Morning meditation',
                '   ‚Ä¢ Physical exercise',
                '   ‚Ä¢ Trading accountability partner'
            ];
            
            yPos = 50;
            strategies.forEach(line => {
                doc.text(line, 20, yPos);
                yPos += 8;
            });
            
            // Page 7: Professional Psychology Toolkit
            doc.addPage();
            doc.setFillColor(10, 15, 28);
            doc.rect(0, 0, 210, 297, 'F');
            
            doc.setTextColor(74, 222, 128);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('Professional Psychology Toolkit', 20, 30);
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            
            const toolkit = [
                'Essential Tools for Trading Psychology:',
                '',
                '1. Pre-Trade Checklist:',
                '   ‚ñ° Market conditions favorable?',
                '   ‚ñ° Setup meets all criteria?',
                '   ‚ñ° Risk/reward acceptable?',
                '   ‚ñ° Position size calculated?',
                '   ‚ñ° Stop loss determined?',
                '',
                '2. Emotional State Check:',
                '   Rate yourself 1-10:',
                '   ‚Ä¢ Confidence level: ___',
                '   ‚Ä¢ Stress level: ___',
                '   ‚Ä¢ Focus level: ___',
                '   If any score <7, reduce size or skip',
                '',
                '3. Post-Trade Review:',
                '   ‚Ä¢ What went right?',
                '   ‚Ä¢ What could improve?',
                '   ‚Ä¢ Emotional state during trade?',
                '   ‚Ä¢ Lessons learned?'
            ];
            
            yPos = 50;
            toolkit.forEach(line => {
                doc.text(line, 20, yPos);
                yPos += 8;
            });
            
            // Page 8: Advanced Psychology Techniques
            doc.addPage();
            doc.setFillColor(10, 15, 28);
            doc.rect(0, 0, 210, 297, 'F');
            
            doc.setTextColor(74, 222, 128);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('Advanced Psychology Techniques', 20, 30);
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            
            const techniques = [
                'Professional Techniques:',
                '',
                '1. Visualization Exercise:',
                '   ‚Ä¢ Close eyes before trading',
                '   ‚Ä¢ Visualize perfect execution',
                '   ‚Ä¢ See yourself following rules',
                '   ‚Ä¢ Feel the calm confidence',
                '',
                '2. Anchor Technique:',
                '   ‚Ä¢ Create physical anchor (fist)',
                '   ‚Ä¢ Use when feeling confident',
                '   ‚Ä¢ Trigger before trades',
                '   ‚Ä¢ Builds state control',
                '',
                '3. Loss Recovery Protocol:',
                '   ‚Ä¢ Stop after 2 consecutive losses',
                '   ‚Ä¢ 15-minute break minimum',
                '   ‚Ä¢ Physical movement',
                '   ‚Ä¢ Review rules before returning',
                '',
                '4. Win Momentum Management:',
                '   ‚Ä¢ Stick to normal size',
                '   ‚Ä¢ Take partial profits',
                '   ‚Ä¢ Avoid overconfidence'
            ];
            
            yPos = 50;
            techniques.forEach(line => {
                doc.text(line, 20, yPos);
                yPos += 8;
            });
            
            // Page 9: Personal Action Plan
            doc.addPage();
            doc.setFillColor(10, 15, 28);
            doc.rect(0, 0, 210, 297, 'F');
            
            doc.setTextColor(74, 222, 128);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('Your Personal Action Plan', 20, 30);
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            
            const actionPlan = [
                'Immediate Actions (This Week):',
                '',
                '‚ñ° Print this report and review daily',
                '‚ñ° Set up trading journal',
                '‚ñ° Define your trading rules',
                '‚ñ° Calculate proper position sizes',
                '‚ñ° Create pre-trade checklist',
                '',
                'Month 1 Goals:',
                '',
                '‚ñ° Follow rules for 20 trading days',
                '‚ñ° Complete trade journal daily',
                '‚ñ° Maintain consistent position sizes',
                '‚ñ° Review performance weekly',
                '',
                'Success Metrics:',
                '',
                '‚Ä¢ Rule compliance: Target 90%+',
                '‚Ä¢ Emotional control: Track daily',
                '‚Ä¢ Profit/Loss: Secondary to process',
                '‚Ä¢ Consistency: Primary focus',
                '',
                'Remember: Psychology drives performance.',
                'Master your mind, master the markets.'
            ];
            
            yPos = 50;
            actionPlan.forEach(line => {
                doc.text(line, 20, yPos);
                yPos += 8;
            });
            
            // Page 10: Resources and Contact
            doc.addPage();
            doc.setFillColor(10, 15, 28);
            doc.rect(0, 0, 210, 297, 'F');
            
            doc.setTextColor(74, 222, 128);
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('Resources & Next Steps', 20, 30);
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            
            const resources = [
                'Recommended Resources:',
                '',
                'Books:',
                '‚Ä¢ Trading in the Zone - Mark Douglas',
                '‚Ä¢ The Disciplined Trader - Mark Douglas',
                '‚Ä¢ Market Wizards - Jack Schwager',
                '',
                'Daily Practices:',
                '‚Ä¢ Morning meditation (10 min)',
                '‚Ä¢ Trading journal review',
                '‚Ä¢ Physical exercise',
                '‚Ä¢ Gratitude practice',
                '',
                'Your Premium Package Includes:',
                '',
                '‚Ä¢ This comprehensive 10-page analysis',
                '‚Ä¢ Unlimited assessment retakes',
                '‚Ä¢ Priority access to new AI tools (2025)',
                '‚Ä¢ Free updates to this report',
                '',
                'Contact & Automated Services:',
                'Website: www.schnitzleinconsulting.com',
                '',
                'Thank you for trusting our AI analysis.',
                'Your journey to trading mastery begins now!'
            ];
            
            yPos = 50;
            resources.forEach(line => {
                doc.text(line, 20, yPos);
                yPos += 8;
            });
            
            // Save the PDF
            doc.save(`Trading_Psychology_Analysis_${assessmentData.score}.pdf`);
        }

        function joinWaitlist() {
            const email = document.getElementById('waitlistEmailInput').value;
            if (!email) {
                alert('Please enter your email address');
                return;
            }
            
            assessmentData.email = email;
            assessmentData.waitlist = true;
            saveAssessment();
            
            alert('‚úÖ You\'re on the waitlist! We\'ll notify you when new AI tools launch.');
            document.getElementById('waitlistEmailInput').value = '';
        }

        function saveAssessment() {
            const assessments = getAssessments();
            assessments.push(assessmentData);
            // Note: localStorage won't work on GitHub Pages, this is for demo
            try {
                localStorage.setItem('tradingAssessments', JSON.stringify(assessments));
            } catch(e) {
                console.log('Storage not available');
            }
            updateAdminStats();
        }

        function getAssessments() {
            try {
                return JSON.parse(localStorage.getItem('tradingAssessments') || '[]');
            } catch(e) {
                return [];
            }
        }

        function updateAdminStats() {
            const assessments = getAssessments();
            const purchases = assessments.filter(a => a.purchase).length;
            const waitlist = assessments.filter(a => a.waitlist).length;
            const revenue = purchases * 35; // Launch price!
            const conversionRate = assessments.length > 0 ? 
                ((purchases / assessments.length) * 100).toFixed(1) : 0;
            
            document.getElementById('totalAssessments').textContent = assessments.length;
            document.getElementById('totalRevenue').textContent = `$${revenue}`;
            document.getElementById('waitlistCount').textContent = waitlist;
            document.getElementById('conversionRate').textContent = `${conversionRate}%`;
            
            // Update assessment list
            const listHTML = assessments.slice(-10).reverse().map(a => `
                <div class="assessment-item">
                    ${new Date(a.timestamp).toLocaleString()} - 
                    Score: ${a.score} - 
                    ${a.purchase ? 'üí∞ Purchased' : a.waitlist ? 'üìß Waitlist' : 'üë§ Free'}
                </div>
            `).join('');
            
            document.getElementById('assessmentList').innerHTML = 
                '<h3 style="margin-bottom: 10px;">Recent Assessments</h3>' + listHTML;
        }

        function exportData() {
            const assessments = getAssessments();
            const csv = [
                ['Timestamp', 'Score', 'Profile', 'Email', 'Waitlist', 'Purchase', 'Transaction ID'],
                ...assessments.map(a => [
                    a.timestamp,
                    a.score,
                    a.profile,
                    a.email || '',
                    a.waitlist ? 'Yes' : 'No',
                    a.purchase ? 'Yes' : 'No',
                    a.transactionId || ''
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trading_assessments_${new Date().toISOString()}.csv`;
            a.click();
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete all data? This cannot be undone.')) {
                localStorage.removeItem('tradingAssessments');
                updateAdminStats();
                alert('All data cleared');
            }
        }

        function toggleAdminPanel() {
            const panel = document.getElementById('adminPanel');
            panel.classList.toggle('active');
            if (panel.classList.contains('active')) {
                updateAdminStats();
                // Show test button for admins
                const testBtn = document.getElementById('testPurchaseBtn');
                if (testBtn) testBtn.style.display = 'block';
            }
        }

        // Check for admin parameter on page load
        function checkAdminParam() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('admin') === 'true') {
                setTimeout(() => {
                    toggleAdminPanel();
                }, 500);
                // Remove parameter from URL
                window.history.replaceState({}, '', window.location.pathname);
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey) {
                switch(e.key) {
                    case 'A':
                        toggleAdminPanel();
                        break;
                    case 'R':
                        location.reload();
                        break;
                    case 'C':
                        clearAllData();
                        break;
                }
            }
        });

        // Initialize on page load
        window.addEventListener('load', function() {
            console.log('üöÄ Trading Psychology Assessment v5.0 - Launch Week Special!');
            console.log('üí≥ PayPal Integration: $35 Launch Price Active');
            console.log('üìä Press Ctrl+Shift+A to open Admin Panel');
            
            // Check for admin parameter
            checkAdminParam();
            
            // Check for payment return
            checkPaymentReturn();
            
            // Check if PayPal SDK is available
            if (typeof paypal !== 'undefined') {
                console.log('‚úÖ PayPal SDK loaded successfully on page load');
            } else {
                console.warn('‚è≥ PayPal SDK still loading...');
            }
        });
    </script>
</body>
</html>
