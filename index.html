<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Enhanced Trading Psychology Assessment</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
            animation: slideUp 0.8s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.1; }
            50% { transform: scale(1.1); opacity: 0.2; }
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 500px;
            margin: 0 auto;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        .progress-container {
            background: #f8f9fa;
            padding: 20px 40px;
            border-bottom: 1px solid #e9ecef;
            position: relative;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transform: translateX(-100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            font-weight: 500;
            color: #495057;
            font-size: 0.95rem;
        }

        .content {
            padding: 40px;
            min-height: 400px;
        }

        .question-container {
            margin-bottom: 40px;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 25px;
            line-height: 1.5;
            text-align: center;
        }

        .answers {
            display: grid;
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .answer {
            padding: 18px 25px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            font-weight: 500;
            color: #495057;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .answer::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(52, 152, 219, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .answer:hover {
            border-color: #3498db;
            background: #f8f9ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.1);
        }

        .answer:hover::before {
            left: 100%;
        }

        .answer.selected {
            border-color: #3498db;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .answer.selected::before {
            display: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e9ecef;
        }

        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: white;
            border: 2px solid transparent;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: 2px solid transparent;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .btn:disabled::before {
            display: none;
        }

        .results {
            text-align: center;
            padding: 40px;
            animation: fadeIn 0.8s ease-out;
        }

        .results h2 {
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .score-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .score-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .score {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .score-label {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .category {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: left;
            border-left: 4px solid #3498db;
            animation: slideInLeft 0.6s ease-out;
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .category h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .risk-level {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .risk-critical { 
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        .risk-high { 
            background: linear-gradient(135deg, #ffa726, #ff7043);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 167, 38, 0.3);
        }
        .risk-moderate { 
            background: linear-gradient(135deg, #42a5f5, #1e88e5);
            color: white;
            box-shadow: 0 4px 15px rgba(66, 165, 245, 0.3);
        }
        .risk-low { 
            background: linear-gradient(135deg, #66bb6a, #43a047);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 187, 106, 0.3);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            text-align: left;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .feature-card:hover::before {
            transform: scaleX(1);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            display: block;
        }

        .feature-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .feature-desc {
            color: #6c757d;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-available {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
        }

        .status-coming-soon {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            color: #8B4513;
        }

        .status-development {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: #1565c0;
        }

        .waitlist-box {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #ff7043;
        }

        .waitlist-box h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .email-input {
            width: 100%;
            max-width: 300px;
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .email-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .disclaimer {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
            margin: 30px 0;
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.5;
        }

        .disclaimer strong {
            color: #495057;
        }

        .hidden {
            display: none !important;
        }

        .development-testing {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
            text-align: left;
        }

        .development-testing h4 {
            color: #1565c0;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .development-testing p {
            color: #424242;
            margin-bottom: 15px;
        }

        .admin-panel {
            background: linear-gradient(135deg, #263238, #37474f);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            display: none;
        }

        .admin-panel h3 {
            margin-bottom: 20px;
            color: #4fc3f7;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: #4fc3f7;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .admin-data {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                margin: 0;
                border-radius: 15px;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .progress-container {
                padding: 15px 20px;
            }
            
            .content {
                padding: 30px 20px;
            }
            
            .question {
                font-size: 1.1rem;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .container {
                background: rgba(30, 30, 30, 0.95);
            }
            
            .progress-container {
                background: #2d3748;
                border-color: #4a5568;
            }
            
            .progress-text {
                color: #e2e8f0;
            }
            
            .question {
                color: #e2e8f0;
            }
            
            .answer {
                background: #2d3748;
                border-color: #4a5568;
                color: #e2e8f0;
            }
            
            .answer:hover {
                background: #374151;
            }
            
            .category {
                background: #2d3748;
                border-left-color: #4299e1;
            }
            
            .category h3 {
                color: #e2e8f0;
            }
            
            .feature-card {
                background: #2d3748;
                border-color: #4a5568;
            }
            
            .feature-title {
                color: #e2e8f0;
            }
            
            .disclaimer {
                background: #2d3748;
                color: #a0aec0;
            }
        }

        /* Accessibility improvements */
        .answer:focus,
        .btn:focus,
        .email-input:focus {
            outline: 2px solid #3498db;
            outline-offset: 2px;
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Success animation */
        .success-checkmark {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #28a745;
            position: relative;
        }

        .success-checkmark::after {
            content: '';
            position: absolute;
            top: 6px;
            left: 8px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI-Enhanced Trading Psychology Assessment</h1>
            <p>Entdecke deine psychologischen Stärken und Schwächen beim Trading mit unserem fortschrittlichen AI-System</p>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Frage 1 von 8</div>
        </div>

        <div class="content">
            <!-- Assessment Questions -->
            <div id="questionContainer" class="question-container">
                <div class="question" id="questionText"></div>
                <div class="answers" id="answersContainer"></div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" style="display: none;">
                        ← Zurück
                    </button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>
                        Weiter →
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsContainer" class="results hidden">
                <h2>🎯 Deine AI-Enhanced Analyse</h2>
                
                <div class="score-display">
                    <div class="score" id="totalScore">0/320</div>
                    <div class="score-label">Trading Psychology Score</div>
                </div>

                <div class="category">
                    <h3>📊 <span id="categoryTitle">Trader-Kategorie</span></h3>
                    <div id="riskLevel" class="risk-level">Wird berechnet...</div>
                    <div id="categoryDescription"></div>
                </div>

                <div class="category">
                    <h3>🔍 Key Findings</h3>
                    <div id="keyFindings"></div>
                </div>

                <div class="category">
                    <h3>📈 Empfehlungen</h3>
                    <div id="recommendations"></div>
                </div>

                <!-- REALISTIC: Current Available Products -->
                <div class="category">
                    <h3>📊 Verfügbare Trading Psychology Produkte</h3>
                    <p style="margin-bottom: 20px; color: #6c757d;">Aktuell verfügbare Produkte für deine Trading Psychology Verbesserung:</p>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <div class="feature-icon">✅</div>
                            <div class="feature-title">AI Psychology Assessment <span class="status-badge status-available">VERFÜGBAR</span></div>
                            <div class="feature-desc">Komplett kostenlos - analysiert deine Trading Psychology in 8 Fragen</div>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">📄</div>
                            <div class="feature-title">Extended AI Analysis <span class="status-badge status-coming-soon">€47</span></div>
                            <div class="feature-desc">8-seitige detaillierte Analyse mit personalisierten Empfehlungen und 90-Tage Roadmap</div>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">🔮</div>
                            <div class="feature-title">AI-Tools Roadmap <span class="status-badge status-development">Q3/Q4 2025</span></div>
                            <div class="feature-desc">Risk Calculator, Emotion Detector, Psychology Tracker - in Entwicklung</div>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon">📧</div>
                            <div class="feature-title">Launch Notifications <span class="status-badge status-available">KOSTENLOS</span></div>
                            <div class="feature-desc">Sei der Erste, der über neue AI-Tools und Produkte informiert wird</div>
                        </div>
                    </div>
                </div>

                <!-- Waitlist Section -->
                <div class="waitlist-box">
                    <h3>📄 Erweiterte AI-Analyse verfügbar!</h3>
                    <p>Erhalte eine detaillierte 8-seitige AI-Analyse mit personalisierten Empfehlungen, 90-Tage Roadmap und Priority Access zu zukünftigen Tools.</p>
                    <p><strong>Preis: €47 (einmalig)</strong></p>
                    <div>
                        <input type="email" class="email-input" id="emailInput" placeholder="Deine E-Mail Adresse">
                        <button class="btn btn-primary" onclick="joinWaitlist()">Interesse anmelden</button>
                    </div>
                    <p style="font-size: 0.9rem; margin-top: 15px; color: #6c757d;">
                        Wir informieren dich über die Verfügbarkeit der Extended Analysis und zukünftige AI-Tools (Q3/Q4 2025).
                    </p>
                </div>

                <!-- Development Testing -->
                <div class="development-testing">
                    <h4>🧪 Development Testing</h4>
                    <p>Teste die neue 8-seitige PDF mit korrigierter Scoring-Logik:</p>
                    <button class="btn btn-secondary" onclick="testCurrentPDF()" style="margin-top: 10px;">
                        Generate Test PDF
                    </button>
                </div>

                <!-- Admin Panel -->
                <div class="admin-panel" id="adminPanel">
                    <h3>🔧 Admin Panel</h3>
                    <div class="admin-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalAssessments">0</div>
                            <div class="stat-label">Total Assessments</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avgScore">0</div>
                            <div class="stat-label">Average Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="waitlistSignups">0</div>
                            <div class="stat-label">Waitlist Signups</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="pdfGenerations">0</div>
                            <div class="stat-label">PDF Downloads</div>
                        </div>
                    </div>
                    <div class="admin-data" id="adminData"></div>
                    <button class="btn btn-secondary" onclick="exportData()" style="margin-top: 15px;">Export Data</button>
                    <button class="btn btn-secondary" onclick="clearAllData()" style="margin-top: 15px; margin-left: 10px;">Clear All Data</button>
                </div>

                <!-- Disclaimer -->
                <div class="disclaimer">
                    <strong>⚠️ Disclaimer:</strong> Diese Analyse dient nur zu Informationszwecken und stellt keine Finanz- oder Anlageberatung dar. 
                    Trading birgt Risiken und vergangene Ergebnisse sind keine Garantie für zukünftige Gewinne. 
                    Bei schwerwiegenden psychologischen Problemen wenden Sie sich an einen professionellen Berater.
                </div>
            </div>
        </div>
    </div>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7RQNXL7CCT"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-7RQNXL7CCT');
    </script>

    <script>
        // Assessment Questions
        const questions = [
            {
                question: "Wie reagierst du normalerweise auf einen größeren Verlust beim Trading?",
                answers: [
                    { text: "Ich trade sofort weiter, um den Verlust wieder reinzuholen", points: 0 },
                    { text: "Ich ärgere mich sehr und mache erstmal eine Pause von mehreren Stunden", points: 20 },
                    { text: "Ich analysiere den Trade und adjustiere meine Strategie entsprechend", points: 30 },
                    { text: "Ich akzeptiere den Verlust als Teil des Spiels und trade normal weiter", points: 40 }
                ]
            },
            {
                question: "Wenn du eine profitable Position hast, wie gehst du damit um?",
                answers: [
                    { text: "Ich schließe sie sofort, um den Gewinn zu sichern", points: 0 },
                    { text: "Ich werde nervös und beobachte ständig den Chart", points: 10 },
                    { text: "Ich verschiebe meinen Stop-Loss nach oben und lasse sie laufen", points: 30 },
                    { text: "Ich halte mich strikt an meinen ursprünglichen Plan", points: 40 }
                ]
            },
            {
                question: "Wie oft tradest du außerhalb deiner vordefinierten Strategie?",
                answers: [
                    { text: "Sehr oft - ich handle meist spontan nach Gefühl", points: 0 },
                    { text: "Manchmal, besonders wenn ich eine 'gute' Gelegenheit sehe", points: 15 },
                    { text: "Selten, nur in sehr besonderen Marktsituationen", points: 30 },
                    { text: "Nie - ich halte mich immer an meine Strategie", points: 40 }
                ]
            },
            {
                question: "Wie gehst du mit einer Serie von Verlusttrades um?",
                answers: [
                    { text: "Ich erhöhe meine Positionsgrößen, um schneller break-even zu werden", points: 0 },
                    { text: "Ich werde frustriert und trade emotionaler", points: 10 },
                    { text: "Ich reduziere meine Positionen und überprüfe meine Strategie", points: 30 },
                    { text: "Ich bleibe ruhig und vertraue auf meine langfristige Strategie", points: 40 }
                ]
            },
            {
                question: "Wann fühlst du FOMO (Fear of Missing Out) am stärksten?",
                answers: [
                    { text: "Ständig - ich will bei jedem Move dabei sein", points: 0 },
                    { text: "Oft, besonders bei großen Marktbewegungen", points: 15 },
                    { text: "Manchmal, aber ich kann es meist kontrollieren", points: 25 },
                    { text: "Selten - ich trade nur meine Setup", points: 40 }
                ]
            },
            {
                question: "Wie planst du deine Trades?",
                answers: [
                    { text: "Ich trade spontan, wenn sich Gelegenheiten ergeben", points: 0 },
                    { text: "Ich habe eine grobe Idee, aber passe während des Trades an", points: 15 },
                    { text: "Ich plane Entry und Exit im Voraus, bin aber flexibel", points: 30 },
                    { text: "Ich habe einen detaillierten Plan mit klaren Entry-, Exit- und Stop-Loss-Levels", points: 40 }
                ]
            },
            {
                question: "Wie beeinflusst dein emotionaler Zustand dein Trading?",
                answers: [
                    { text: "Sehr stark - je nach Laune trade ich völlig anders", points: 0 },
                    { text: "Merklich - schlechte Stimmung führt oft zu schlechten Trades", points: 15 },
                    { text: "Etwas - ich bemerke den Einfluss, kann ihn aber meist kontrollieren", points: 25 },
                    { text: "Kaum - ich trade unabhängig von meiner Stimmung", points: 40 }
                ]
            },
            {
                question: "Wie gehst du mit der Unsicherheit des Markets um?",
                answers: [
                    { text: "Ich finde es sehr stressig und bin oft angespannt", points: 0 },
                    { text: "Es macht mir Sorgen, aber ich trade trotzdem weiter", points: 15 },
                    { text: "Ich akzeptiere es als Teil des Tradings", points: 30 },
                    { text: "Ich sehe Unsicherheit als Chance und nutze sie für meine Strategie", points: 40 }
                ]
            }
        ];

        // Global variables
        let currentQuestion = 0;
        let selectedAnswers = [];
        let totalScore = 0;
        let assessmentStartTime = null;
        let allAssessmentData = [];

        // Storage Management with Enhanced Error Handling
        function checkStorageAvailability() {
            const storage = {
                localStorage: false,
                sessionStorage: false,
                cookies: false
            };

            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                storage.localStorage = true;
                console.log('✅ localStorage available');
            } catch (e) {
                console.log('❌ localStorage not available:', e.message);
            }

            try {
                sessionStorage.setItem('test', 'test');
                sessionStorage.removeItem('test');
                storage.sessionStorage = true;
                console.log('✅ sessionStorage available');
            } catch (e) {
                console.log('❌ sessionStorage not available:', e.message);
            }

            try {
                document.cookie = 'test=test; path=/';
                storage.cookies = document.cookie.indexOf('test=test') !== -1;
                if (storage.cookies) {
                    document.cookie = 'test=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                    console.log('✅ Cookies available');
                }
            } catch (e) {
                console.log('❌ Cookies not available:', e.message);
            }

            console.log('💾 Storage availability:', storage);
            return storage;
        }

        function saveData(key, value) {
            const data = JSON.stringify(value);
            let saved = false;
            
            try {
                localStorage.setItem(key, data);
                console.log(`💾 Data saved to localStorage: ${key}`);
                saved = true;
            } catch (e) {
                console.log(`Warning: Failed to save to localStorage: ${e.message}`);
            }

            if (!saved) {
                try {
                    sessionStorage.setItem(key, data);
                    console.log(`💾 Data saved to sessionStorage: ${key}`);
                    saved = true;
                } catch (e) {
                    console.log(`Warning: Failed to save to sessionStorage: ${e.message}`);
                }
            }

            if (!saved) {
                try {
                    document.cookie = `${key}=${encodeURIComponent(data)}; path=/; max-age=86400`;
                    console.log(`💾 Data saved to cookies: ${key}`);
                    saved = true;
                } catch (e) {
                    console.log(`Warning: Failed to save to cookies: ${e.message}`);
                }
            }

            if (!saved) {
                console.log(`⚠️ Could not save data anywhere for key: ${key}`);
                // Fall back to memory storage
                if (!window.memoryStorage) window.memoryStorage = {};
                window.memoryStorage[key] = data;
                console.log(`💾 Data saved to memory: ${key}`);
                saved = true;
            }

            return saved;
        }

        function loadData(key) {
            // Try localStorage first
            try {
                const data = localStorage.getItem(key);
                if (data) {
                    console.log(`📊 Data loaded from localStorage: ${key}`);
                    return JSON.parse(data);
                }
            } catch (e) {
                console.log(`Warning: Failed to load from localStorage: ${e.message}`);
            }

            // Try sessionStorage
            try {
                const data = sessionStorage.getItem(key);
                if (data) {
                    console.log(`📊 Data loaded from sessionStorage: ${key}`);
                    return JSON.parse(data);
                }
            } catch (e) {
                console.log(`Warning: Failed to load from sessionStorage: ${e.message}`);
            }

            // Try cookies
            try {
                const name = key + "=";
                const decodedCookie = decodeURIComponent(document.cookie);
                const cookieArray = decodedCookie.split(';');
                for (let i = 0; i < cookieArray.length; i++) {
                    let cookie = cookieArray[i];
                    while (cookie.charAt(0) === ' ') {
                        cookie = cookie.substring(1);
                    }
                    if (cookie.indexOf(name) === 0) {
                        const data = cookie.substring(name.length, cookie.length);
                        console.log(`📊 Data loaded from cookies: ${key}`);
                        return JSON.parse(data);
                    }
                }
            } catch (e) {
                console.log(`Warning: Failed to load from cookies: ${e.message}`);
            }

            // Try memory storage
            try {
                if (window.memoryStorage && window.memoryStorage[key]) {
                    console.log(`📊 Data loaded from memory: ${key}`);
                    return JSON.parse(window.memoryStorage[key]);
                }
            } catch (e) {
                console.log(`Warning: Failed to load from memory: ${e.message}`);
            }

            return null;
        }

        function clearData() {
            try {
                localStorage.clear();
                console.log('🗑️ localStorage cleared');
            } catch (e) {
                console.log('Warning: Could not clear localStorage');
            }

            try {
                sessionStorage.clear();
                console.log('🗑️ sessionStorage cleared');
            } catch (e) {
                console.log('Warning: Could not clear sessionStorage');
            }

            try {
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                console.log('🗑️ Cookies cleared');
            } catch (e) {
                console.log('Warning: Could not clear cookies');
            }

            try {
                if (window.memoryStorage) {
                    window.memoryStorage = {};
                    console.log('🗑️ Memory storage cleared');
                }
            } catch (e) {
                console.log('Warning: Could not clear memory storage');
            }
        }

        // Initialize Assessment
        function init() {
            console.log('🚀 Assessment starting...');
            assessmentStartTime = new Date();
            checkStorageAvailability();
            loadExistingData();
            showQuestion();
            updateProgress();
            
            // Track page view
            gtag('event', 'page_view', {
                page_title: 'Trading Psychology Assessment',
                page_location: window.location.href
            });

            gtag('event', 'assessment_started', {
                event_category: 'Assessment',
                event_label: 'User started assessment'
            });

            console.log('✅ Assessment initialized successfully');
        }

        function loadExistingData() {
            try {
                // Load existing assessment data for analytics
                const savedResults = loadData('allAssessmentData') || [];
                allAssessmentData = Array.isArray(savedResults) ? savedResults : [];
                console.log(`📊 Loaded ${allAssessmentData.length} previous assessments`);
                
                // Load current progress if exists
                const savedProgress = loadData('assessmentProgress');
                if (savedProgress && savedProgress.currentQuestion !== undefined) {
                    currentQuestion = savedProgress.currentQuestion;
                    selectedAnswers = savedProgress.selectedAnswers || [];
                    console.log(`🔄 Restored progress: Question ${currentQuestion + 1}`);
                }
            } catch (e) {
                console.log('Warning: Could not load existing data:', e.message);
                allAssessmentData = [];
            }
        }

        function showQuestion() {
            const question = questions[currentQuestion];
            document.getElementById('questionText').textContent = question.question;
            
            const answersContainer = document.getElementById('answersContainer');
            answersContainer.innerHTML = '';
            
            question.answers.forEach((answer, index) => {
                const answerDiv = document.createElement('div');
                answerDiv.className = 'answer';
                answerDiv.textContent = answer.text;
                answerDiv.onclick = () => selectAnswer(index);
                answerDiv.setAttribute('tabindex', '0');
                answerDiv.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectAnswer(index);
                    }
                });
                answersContainer.appendChild(answerDiv);
            });

            // Show/hide navigation buttons
            document.getElementById('prevBtn').style.display = currentQuestion > 0 ? 'block' : 'none';
            document.getElementById('nextBtn').disabled = true;
            
            // Restore previous selection if exists
            if (selectedAnswers[currentQuestion]) {
                const answerIndex = selectedAnswers[currentQuestion].answerIndex;
                document.querySelectorAll('.answer')[answerIndex].classList.add('selected');
                document.getElementById('nextBtn').disabled = false;
            }
        }

        function selectAnswer(answerIndex) {
            // Remove previous selection
            document.querySelectorAll('.answer').forEach(a => a.classList.remove('selected'));
            
            // Add selection to clicked answer
            document.querySelectorAll('.answer')[answerIndex].classList.add('selected');
            
            // Store the answer
            selectedAnswers[currentQuestion] = {
                questionIndex: currentQuestion,
                answerIndex: answerIndex,
                points: questions[currentQuestion].answers[answerIndex].points,
                questionText: questions[currentQuestion].question,
                answerText: questions[currentQuestion].answers[answerIndex].text,
                timestamp: new Date().toISOString()
            };
            
            // Enable next button
            document.getElementById('nextBtn').disabled = false;
            
            // Save progress
            saveData('assessmentProgress', {
                currentQuestion: currentQuestion,
                selectedAnswers: selectedAnswers,
                timestamp: new Date().toISOString()
            });

            // Track answer selection
            gtag('event', 'answer_selected', {
                event_category: 'Assessment',
                event_label: `Question ${currentQuestion + 1}`,
                value: answerIndex
            });

            console.log(`✅ Answer selected: Q${currentQuestion + 1} - Option ${answerIndex + 1} (${questions[currentQuestion].answers[answerIndex].points} points)`);
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion();
                updateProgress();
                
                // Animate transition
                const container = document.getElementById('questionContainer');
                container.style.animation = 'fadeIn 0.6s ease-out';
            } else {
                finishAssessment();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
                updateProgress();
                
                // Animate transition
                const container = document.getElementById('questionContainer');
                container.style.animation = 'fadeIn 0.6s ease-out';
            }
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressFill.style.width = progress + '%';
            progressText.textContent = `Frage ${currentQuestion + 1} von ${questions.length}`;
            
            // Add completion animation at 100%
            if (progress === 100) {
                progressFill.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
            }
        }

        function finishAssessment() {
            const endTime = new Date();
            const duration = Math.round((endTime - assessmentStartTime) / 1000); // in seconds
            
            // Calculate total score
            totalScore = selectedAnswers.reduce((sum, answer) => sum + (answer?.points || 0), 0);
            
            // Show results
            document.getElementById('questionContainer').classList.add('hidden');
            document.getElementById('resultsContainer').classList.remove('hidden');
            
            // Display results
            displayResults();
            
            // Save final results
            const results = {
                score: totalScore,
                answers: selectedAnswers,
                duration: duration,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                referrer: document.referrer,
                sessionId: generateSessionId()
            };
            
            saveData('assessmentResults', results);
            
            // Add to all assessment data
            allAssessmentData.push(results);
            saveData('allAssessmentData', allAssessmentData);

            // Track completion
            gtag('event', 'assessment_completed', {
                event_category: 'Assessment',
                event_label: 'Assessment finished',
                value: totalScore
            });

            gtag('event', 'assessment_duration', {
                event_category: 'Assessment',
                event_label: 'Time to complete',
                value: duration
            });

            console.log('✅ Assessment completed!');
            console.log(`📊 Score: ${totalScore}/320`);
            console.log(`⏱️ Duration: ${duration} seconds`);
            console.log(`📈 Total assessments: ${allAssessmentData.length}`);
        }

        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function displayResults() {
            document.getElementById('totalScore').textContent = `${totalScore}/320`;
            
            // Determine category and risk level with CORRECT logic
            let category, riskLevel, riskClass, description, keyFindings, recommendations;
            
            if (totalScore >= 0 && totalScore <= 80) {
                category = "VULNERABLE TRADER";
                riskLevel = "CRITICAL";
                riskClass = "risk-critical";
                description = "Deine emotionale Kontrolle beim Trading zeigt kritische Schwachstellen. Es besteht akute Gefahr für dein Trading-Kapital.";
                keyFindings = "• Kritische emotionale Vulnerabilitäten erkannt<br>• Hohe Tendenz zu impulsiven Entscheidungen<br>• Unzureichende Risikokontrolle<br>• Sofortige Intervention erforderlich";
                recommendations = "• STOPPE das Trading sofort bis zur Verbesserung<br>• Konsultiere einen Trading Psychology Professional<br>• Entwickle einen strikten Trading Plan<br>• Übe mit Simulator vor Live-Trading<br>• Reduziere Positionsgrößen dramatisch";
            } else if (totalScore >= 81 && totalScore <= 160) {
                category = "DEVELOPING TRADER";
                riskLevel = "HIGH";
                riskClass = "risk-high";
                description = "Du zeigst einige positive Ansätze, aber deine Trading Psychology hat noch erhebliche Schwächen, die deine Performance beeinträchtigen.";
                keyFindings = "• Signifikante emotionale Herausforderungen erkannt<br>• Inkonsistente Strategieumsetzung<br>• Verbesserungspotential bei Risikomanagement<br>• Grundlagen vorhanden, aber nicht gefestigt";
                recommendations = "• Reduziere Positionsgrößen um 50%<br>• Implementiere strikte Stop-Loss Regeln<br>• Führe ein Trading Journal<br>• Arbeite an emotionaler Kontrolle<br>• Nutze praktische Psychology Tools";
            } else if (totalScore >= 161 && totalScore <= 240) {
                category = "DISCIPLINED TRADER";
                riskLevel = "MODERATE";
                riskClass = "risk-moderate";
                description = "Du hast eine gute Grundlage für erfolgreiches Trading entwickelt. Mit einigen Verbesserungen kannst du deine Konsistenz steigern.";
                keyFindings = "• Solide emotionale Grundlage vorhanden<br>• Gute Strategiedisziplin mit gelegentlichen Abweichungen<br>• Verbesserungsbereiche identifiziert<br>• Potential für konsistente Profitabilität";
                recommendations = "• Verfeinere dein Risikomanagement<br>• Arbeite an Konsistenz bei der Strategieumsetzung<br>• Nutze Performance Analytics zur Optimierung<br>• Entwickle Advanced Trading Setups<br>• Fokussiere auf kontinuierliche Verbesserung";
            } else {
                category = "ELITE TRADER";
                riskLevel = "LOW";
                riskClass = "risk-low";
                description = "Außergewöhnliche emotionale Kontrolle und Trading-Disziplin. Du zeigst die psychologischen Eigenschaften erfolgreicher professioneller Trader.";
                keyFindings = "• Außergewöhnliche emotionale Kontrolle demonstriert<br>• Keine signifikanten negativen Muster erkannt<br>• Starke psychologische Kontrolle<br>• Fokus auf Aufrechterhaltung der aktuellen Disziplin";
                recommendations = "• Behalte deine aktuelle Disziplin bei<br>• Teile dein Wissen mit anderen Tradern<br>• Experimentiere mit erweiterten Strategien<br>• Nutze Advanced Analytics für Feintuning<br>• Erwäge professionelles Trading";
            }

            // Animate score display
            animateScore(totalScore);
            
            document.getElementById('categoryTitle').textContent = category;
            document.getElementById('riskLevel').textContent = `Risk Level: ${riskLevel}`;
            document.getElementById('riskLevel').className = `risk-level ${riskClass}`;
            document.getElementById('categoryDescription').textContent = description;
            document.getElementById('keyFindings').innerHTML = keyFindings;
            document.getElementById('recommendations').innerHTML = recommendations;

            // Load and display admin data
            loadAdminData();
        }

        function animateScore(targetScore) {
            const scoreElement = document.getElementById('totalScore');
            let currentScore = 0;
            const increment = Math.ceil(targetScore / 50);
            const timer = setInterval(() => {
                currentScore += increment;
                if (currentScore >= targetScore) {
                    currentScore = targetScore;
                    clearInterval(timer);
                }
                scoreElement.textContent = `${currentScore}/320`;
            }, 30);
        }

        function joinWaitlist() {
            const emailInput = document.getElementById('emailInput');
            const email = emailInput.value.trim();
            
            if (!email || !isValidEmail(email)) {
                alert('Bitte gib eine gültige E-Mail Adresse ein.');
                emailInput.focus();
                return;
            }

            // Check for duplicate emails
            const existingSignups = loadData('allWaitlistSignups') || [];
            const isDuplicate = existingSignups.some(signup => signup.email.toLowerCase() === email.toLowerCase());
            
            if (isDuplicate) {
                alert('Diese E-Mail Adresse ist bereits angemeldet!');
                return;
            }

            // Save email to waitlist
            const waitlistData = {
                email: email,
                score: totalScore,
                timestamp: new Date().toISOString(),
                answers: selectedAnswers,
                sessionId: generateSessionId(),
                category: getCategoryForScore(totalScore),
                source: 'assessment_results'
            };
            
            saveData('waitlistSignup', waitlistData);
            
            // Add to all waitlist signups
            existingSignups.push(waitlistData);
            saveData('allWaitlistSignups', existingSignups);

            // Track waitlist signup
            gtag('event', 'waitlist_signup', {
                event_category: 'Conversion',
                event_label: 'User joined waitlist',
                value: totalScore
            });

            // Show success message
            emailInput.value = '';
            const button = emailInput.nextElementSibling;
            const originalText = button.textContent;
            button.innerHTML = '<span class="success-checkmark"></span> Angemeldet!';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = originalText;
                button.disabled = false;
            }, 3000);

            console.log('📧 Waitlist signup:', email, 'Score:', totalScore);
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function getCategoryForScore(score) {
            if (score <= 80) return 'Vulnerable Trader';
            if (score <= 160) return 'Developing Trader';
            if (score <= 240) return 'Disciplined Trader';
            return 'Elite Trader';
        }

        // Enhanced PDF Generation with Realistic Content
        function generateExtendedPDFReport(email, transactionId) {
            try {
                var jsPDF = window.jspdf.jsPDF;
                var doc = new jsPDF();
                
                // Calculate AI confidence score (realistic based on actual score)
                var confidenceScore = Math.max(20, Math.min(95, (totalScore / 320) * 80 + 15 + (Math.random() * 10 - 5)));
                
                // Page 1: Cover Page
                doc.setFillColor(44, 62, 80);
                doc.rect(0, 0, 210, 297, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(28);
                doc.setFont(undefined, 'bold');
                doc.text('AI-Enhanced Trading', 105, 80, { align: 'center' });
                doc.text('Psychology Analysis', 105, 95, { align: 'center' });
                
                doc.setFontSize(16);
                doc.setFont(undefined, 'normal');
                doc.text('Personalized Report for:', 105, 120, { align: 'center' });
                doc.setFont(undefined, 'bold');
                doc.text(email, 105, 135, { align: 'center' });
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(12);
                doc.text('Generated: ' + new Date().toLocaleDateString('de-DE'), 105, 160, { align: 'center' });
                doc.text('Score: ' + totalScore + '/320 Points', 105, 175, { align: 'center' });
                doc.text('AI Confidence: ' + confidenceScore.toFixed(1) + '%', 105, 190, { align: 'center' });
                
                doc.setFontSize(14);
                doc.text('Schnitzlein Consulting - Psychology Specialists', 105, 250, { align: 'center' });
                doc.text('www.schnitzleinconsulting.com', 105, 265, { align: 'center' });

                // Page 2: Executive Summary
                doc.addPage();
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('Executive Summary', 20, 30);
                
                // Determine category and risk level with CORRECT logic
                let category, riskLevel, description;
                if (totalScore >= 0 && totalScore <= 80) {
                    category = "VULNERABLE TRADER";
                    riskLevel = "CRITICAL";
                    description = "Critical emotional vulnerabilities detected. Immediate intervention required to prevent significant trading losses.";
                } else if (totalScore >= 81 && totalScore <= 160) {
                    category = "DEVELOPING TRADER";
                    riskLevel = "HIGH";
                    description = "Significant negative patterns detected. Considerable improvement needed for consistent profitability.";
                } else if (totalScore >= 161 && totalScore <= 240) {
                    category = "DISCIPLINED TRADER";
                    riskLevel = "MODERATE";
                    description = "Good foundation with improvement areas identified. Potential for enhanced consistency.";
                } else {
                    category = "ELITE TRADER";
                    riskLevel = "LOW";
                    description = "Exceptional psychological control demonstrated. Maintain current discipline and explore advanced strategies.";
                }

                doc.setFontSize(14);
                doc.setFont(undefined, 'normal');
                doc.text('Trader Category: ' + category, 20, 50);
                doc.text('Risk Level: ' + riskLevel, 20, 65);
                doc.text('AI Confidence: ' + confidenceScore.toFixed(1) + '%', 20, 80);
                
                doc.setFontSize(12);
                var splitDescription = doc.splitTextToSize(description, 170);
                doc.text(splitDescription, 20, 100);

                // Assessment breakdown
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('Assessment Breakdown:', 20, 140);
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(11);
                var yPos = 155;
                selectedAnswers.forEach((answer, index) => {
                    if (yPos > 270) {
                        doc.addPage();
                        yPos = 30;
                    }
                    var questionText = 'Q' + (index + 1) + ': ' + questions[index].question;
                    var splitQuestion = doc.splitTextToSize(questionText, 170);
                    doc.text(splitQuestion, 20, yPos);
                    yPos += splitQuestion.length * 5 + 2;
                    
                    var answerText = 'A: ' + questions[index].answers[answer.answerIndex].text + ' (' + answer.points + ' pts)';
                    var splitAnswer = doc.splitTextToSize(answerText, 170);
                    doc.text(splitAnswer, 20, yPos);
                    yPos += splitAnswer.length * 5 + 8;
                });

                // Page 3: Detailed Pattern Analysis
                doc.addPage();
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('Detailed Pattern Analysis', 20, 30);
                
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('Emotional Control Patterns:', 20, 50);
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(11);
                var emotionalScore = Math.max(20, Math.min(95, (totalScore / 320) * 100 + (Math.random() * 10 - 5)));
                doc.text('Emotional Stability: ' + emotionalScore.toFixed(1) + '%', 20, 65);
                
                var riskScore = Math.max(15, Math.min(90, (totalScore / 320) * 100 + (Math.random() * 15 - 7)));
                doc.text('Risk Management: ' + riskScore.toFixed(1) + '%', 20, 75);
                
                var disciplineScore = Math.max(25, Math.min(95, (totalScore / 320) * 100 + (Math.random() * 8 - 4)));
                doc.text('Trading Discipline: ' + disciplineScore.toFixed(1) + '%', 20, 85);

                // Specific pattern analysis based on answers
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Key Patterns Identified:', 20, 110);
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                var patterns = analyzePatterns(selectedAnswers);
                var patternYPos = 125;
                patterns.forEach(pattern => {
                    var splitPattern = doc.splitTextToSize('• ' + pattern, 170);
                    doc.text(splitPattern, 20, patternYPos);
                    patternYPos += splitPattern.length * 5 + 3;
                });

                // Page 4: Psychology Risk Assessment
                doc.addPage();
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('Psychology Risk Assessment', 20, 30);

                // Risk categories with visual representation
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Risk Categories:', 20, 50);
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                
                // FOMO Risk
                var fomoRisk = totalScore < 80 ? 'HIGH' : totalScore < 160 ? 'MODERATE' : 'LOW';
                doc.text('FOMO (Fear of Missing Out): ' + fomoRisk, 20, 70);
                
                // Loss Aversion Risk  
                var lossRisk = totalScore < 80 ? 'CRITICAL' : totalScore < 160 ? 'HIGH' : 'MODERATE';
                doc.text('Loss Aversion: ' + lossRisk, 20, 85);
                
                // Overconfidence Risk
                var overconfidenceRisk = totalScore < 80 ? 'HIGH' : totalScore < 200 ? 'MODERATE' : 'LOW';
                doc.text('Overconfidence: ' + overconfidenceRisk, 20, 100);

                // Impulsivity Risk
                var impulsivityRisk = totalScore < 80 ? 'CRITICAL' : totalScore < 160 ? 'HIGH' : totalScore < 240 ? 'MODERATE' : 'LOW';
                doc.text('Impulsivity: ' + impulsivityRisk, 20, 115);

                // Risk visualization (simple text-based bars)
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Risk Level Visualization:', 20, 140);
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(8);
                var riskLevels = [
                    { name: 'FOMO Risk', level: fomoRisk },
                    { name: 'Loss Aversion', level: lossRisk },
                    { name: 'Overconfidence', level: overconfidenceRisk },
                    { name: 'Impulsivity', level: impulsivityRisk }
                ];
                
                var barYPos = 155;
                riskLevels.forEach(risk => {
                    doc.text(risk.name + ':', 20, barYPos);
                    var barLength = risk.level === 'CRITICAL' ? 50 : risk.level === 'HIGH' ? 40 : risk.level === 'MODERATE' ? 25 : 15;
                    var bar = '█'.repeat(Math.floor(barLength / 2));
                    doc.text(bar + ' (' + risk.level + ')', 60, barYPos);
                    barYPos += 12;
                });

                // Page 5: 30/60/90 Day Improvement Roadmap
                doc.addPage();
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('90-Day Improvement Roadmap', 20, 30);
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('30-Day Plan:', 20, 50);
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                
                if (totalScore < 80) {
                    doc.text('• STOP live trading immediately', 20, 65);
                    doc.text('• Practice with demo account only', 20, 75);
                    doc.text('• Complete psychology education program', 20, 85);
                    doc.text('• Develop strict trading rules', 20, 95);
                    doc.text('• Seek professional psychology consultation', 20, 105);
                } else if (totalScore < 160) {
                    doc.text('• Reduce position sizes by 50%', 20, 65);
                    doc.text('• Implement strict stop-loss rules', 20, 75);
                    doc.text('• Start daily trading journal', 20, 85);
                    doc.text('• Practice emotional control techniques', 20, 95);
                    doc.text('• Set daily loss limits', 20, 105);
                } else {
                    doc.text('• Maintain current discipline', 20, 65);
                    doc.text('• Optimize risk management', 20, 75);
                    doc.text('• Track performance with analytics', 20, 85);
                    doc.text('• Explore advanced strategies', 20, 95);
                    doc.text('• Consider scaling up gradually', 20, 105);
                }

                doc.setFont(undefined, 'bold');
                doc.text('60-Day Plan:', 20, 125);
                doc.setFont(undefined, 'normal');
                if (totalScore < 80) {
                    doc.text('• Continue demo trading only', 20, 140);
                    doc.text('• Weekly psychology sessions', 20, 150);
                    doc.text('• Build emotional awareness', 20, 160);
                } else if (totalScore < 160) {
                    doc.text('• Implement advanced risk controls', 20, 140);
                    doc.text('• Analyze trading patterns weekly', 20, 150);
                    doc.text('• Gradually increase confidence', 20, 160);
                } else {
                    doc.text('• Optimize strategy performance', 20, 140);
                    doc.text('• Explore new market conditions', 20, 150);
                    doc.text('• Share knowledge with community', 20, 160);
                }

                doc.setFont(undefined, 'bold');
                doc.text('90-Day Plan:', 20, 180);
                doc.setFont(undefined, 'normal');
                if (totalScore < 80) {
                    doc.text('• Reassess with new evaluation', 20, 195);
                    doc.text('• Consider returning to live trading', 20, 205);
                    doc.text('• Start with micro positions', 20, 215);
                } else {
                    doc.text('• Achieve consistent profitability', 20, 195);
                    doc.text('• Develop advanced strategies', 20, 205);
                    doc.text('• Consider professional development', 20, 215);
                }

                // Page 6: REALISTIC Current Recommendations
                doc.addPage();
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('Current Available Solutions', 20, 30);
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('What You Can Access Right Now:', 20, 50);
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                
                // Current available products only
                doc.text('IMMEDIATELY AVAILABLE:', 20, 65);
                doc.text('• This AI Psychology Assessment (FREE)', 20, 75);
                doc.text('• Extended 8-page AI Analysis (€47)', 20, 85);
                doc.text('• Email notifications for new tools', 20, 95);
                
                // Realistic next steps based on score
                if (totalScore < 80) {
                    doc.text('IMMEDIATE PRIORITY FOR YOUR LEVEL:', 20, 115);
                    doc.text('• Get the Extended Analysis (€47) for detailed roadmap', 20, 125);
                    doc.text('• STOP live trading - use demo accounts only', 20, 135);
                    doc.text('• Seek professional psychology support', 20, 145);
                    doc.text('• Join waitlist for upcoming Risk Management Tools', 20, 155);
                } else if (totalScore < 160) {
                    doc.text('RECOMMENDED FOR YOUR LEVEL:', 20, 115);
                    doc.text('• Get Extended Analysis (€47) for improvement plan', 20, 125);
                    doc.text('• Reduce position sizes significantly', 20, 135);
                    doc.text('• Start manual trading journal', 20, 145);
                    doc.text('• Join waitlist for Psychology Tracking Tools', 20, 155);
                } else if (totalScore < 240) {
                    doc.text('OPTIMIZATION OPPORTUNITIES:', 20, 115);
                    doc.text('• Extended Analysis (€47) for fine-tuning', 20, 125);
                    doc.text('• Manual performance tracking', 20, 135);
                    doc.text('• Join waitlist for Advanced Analytics Tools', 20, 145);
                } else {
                    doc.text('ELITE LEVEL RECOMMENDATIONS:', 20, 115);
                    doc.text('• Extended Analysis (€47) for edge optimization', 20, 125);
                    doc.text('• Share knowledge with other traders', 20, 135);
                    doc.text('• Join waitlist for Professional Suite Tools', 20, 145);
                }

                doc.setFont(undefined, 'bold');
                doc.text('Future Tool Development (2025):', 20, 175);
                doc.setFont(undefined, 'normal');
                doc.text('• Q3 2025: AI Risk Calculator & Emotion Detector', 20, 190);
                doc.text('• Q4 2025: Psychology Tracker & Trading Journal', 20, 200);
                doc.text('• 2026: Complete AI Psychology Suite', 20, 210);
                doc.text('• Join our email list to be notified of launches', 20, 220);

                // Page 7: Realistic Tools & Techniques
                doc.addPage();
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('Practical Tools & Techniques', 20, 30);
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Tools You Can Use Right Now:', 20, 50);
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                doc.text('• Simple Excel/Google Sheets trading journal', 20, 65);
                doc.text('• Free mindfulness apps (Insight Timer, etc.)', 20, 75);
                doc.text('• Broker\'s built-in price alerts', 20, 85);
                doc.text('• Basic position size calculator (2% rule)', 20, 95);
                doc.text('• Economic calendar (investing.com, etc.)', 20, 105);
                doc.text('• Demo trading accounts for practice', 20, 115);

                doc.setFont(undefined, 'bold');
                doc.text('Immediate Action Protocols:', 20, 135);
                doc.setFont(undefined, 'normal');
                
                if (totalScore < 80) {
                    doc.text('CRITICAL - Emergency Protocol:', 20, 150);
                    doc.text('1. STOP all live trading immediately', 20, 160);
                    doc.text('2. Switch to demo accounts only', 20, 170);
                    doc.text('3. Seek professional psychology help', 20, 180);
                    doc.text('4. Get Extended Analysis (€47) for detailed plan', 20, 190);
                    doc.text('5. Do NOT resume live trading without improvement', 20, 200);
                } else {
                    doc.text('When experiencing FOMO or emotional stress:', 20, 150);
                    doc.text('1. Step away from charts for 30+ minutes', 20, 160);
                    doc.text('2. Review your original trading plan', 20, 170);
                    doc.text('3. Only trade your predetermined setups', 20, 180);
                    doc.text('4. Use smaller position sizes when unsure', 20, 190);
                    
                    doc.text('After 2 consecutive losses:', 20, 210);
                    doc.text('1. Stop trading for the rest of the day', 20, 220);
                    doc.text('2. Analyze what went wrong objectively', 20, 230);
                    doc.text('3. Adjust strategy only if clear pattern emerges', 20, 240);
                }

                // Page 8: Next Steps & Contact
                doc.addPage();
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('Next Steps & Support', 20, 30);
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Immediate Actions:', 20, 50);
                
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                if (totalScore < 80) {
                    doc.text('1. STOP live trading immediately', 20, 65);
                    doc.text('2. Seek professional psychology support', 20, 75);
                    doc.text('3. Join our waitlist for AI Psychology Tools', 20, 85);
                    doc.text('4. Practice emotional control techniques daily', 20, 95);
                } else {
                    doc.text('1. Implement the 30-day improvement plan', 20, 65);
                    doc.text('2. Join our waitlist for Premium AI Tools', 20, 75);
                    doc.text('3. Start using recommended practical tools', 20, 85);
                    doc.text('4. Track your progress weekly', 20, 95);
                }

                doc.setFont(undefined, 'bold');
                doc.text('Available Products & Services:', 20, 115);
                doc.setFont(undefined, 'normal');
                doc.text('• FREE: AI Psychology Assessment (unlimited retakes)', 20, 130);
                doc.text('• €47: Extended 8-page AI Analysis with roadmap', 20, 140);
                doc.text('• FREE: Email updates on new tool launches', 20, 150);
                doc.text('• 2025: AI Tools in development (Risk Calculator, etc.)', 20, 160);

                doc.setFont(undefined, 'bold');
                doc.text('Contact & Support:', 20, 180);
                doc.setFont(undefined, 'normal');
                doc.text('Email: info@schnitzleinconsulting.com', 20, 195);
                doc.text('Website: www.schnitzleinconsulting.com', 20, 205);
                doc.text('Tool Updates: Join our email list for launch notifications', 20, 215);

                doc.setFontSize(8);
                doc.text('This analysis is for educational purposes only and does not constitute financial advice.', 20, 250);
                doc.text('Trading involves risk and past performance does not guarantee future results.', 20, 260);
                doc.text('For serious psychological concerns, please consult a licensed professional.', 20, 270);

                // Save the PDF
                const fileName = 'Trading_Psychology_Analysis_' + new Date().toISOString().split('T')[0] + '.pdf';
                doc.save(fileName);
                
                // Track PDF generation
                gtag('event', 'pdf_generated', {
                    event_category: 'Conversion',
                    event_label: 'PDF downloaded',
                    value: totalScore
                });

                // Save PDF generation record
                const pdfData = {
                    email: email,
                    transactionId: transactionId,
                    score: totalScore,
                    fileName: fileName,
                    timestamp: new Date().toISOString()
                };
                
                const allPdfs = loadData('allPdfGenerations') || [];
                allPdfs.push(pdfData);
                saveData('allPdfGenerations', allPdfs);
                
                console.log('✅ PDF generated successfully!', fileName);
                
            } catch (error) {
                console.error('❌ Error generating PDF:', error);
                alert('Fehler beim Generieren der PDF. Bitte versuche es erneut.');
                
                gtag('event', 'pdf_error', {
                    event_category: 'Error',
                    event_label: error.message
                });
            }
        }

        function analyzePatterns(answers) {
            const patterns = [];
            
            // Analyze specific question patterns
            if (answers[0] && answers[0].points <= 10) {
                patterns.push("High tendency to chase losses immediately after setbacks");
            }
            
            if (answers[1] && answers[1].points <= 10) {
                patterns.push("Premature profit-taking due to anxiety and fear");
            }
            
            if (answers[2] && answers[2].points <= 15) {
                patterns.push("Frequent deviation from trading strategy");
            }
            
            if (answers[3] && answers[3].points <= 10) {
                patterns.push("Emotional escalation during losing streaks");
            }
            
            if (answers[4] && answers[4].points <= 15) {
                patterns.push("Strong FOMO leading to impulsive decisions");
            }
            
            if (answers[5] && answers[5].points <= 15) {
                patterns.push("Insufficient trade planning and preparation");
            }
            
            if (answers[6] && answers[6].points <= 15) {
                patterns.push("Emotional state significantly impacts trading decisions");
            }
            
            if (answers[7] && answers[7].points <= 15) {
                patterns.push("High stress and anxiety in uncertain market conditions");
            }
            
            // If no specific patterns found, add general ones
            if (patterns.length === 0) {
                if (totalScore > 200) {
                    patterns.push("Strong emotional control and disciplined approach");
                    patterns.push("Consistent strategy execution");
                } else {
                    patterns.push("Some areas for improvement in emotional control");
                    patterns.push("Opportunities to enhance trading discipline");
                }
            }
            
            return patterns;
        }

        // Test function for current assessment
        function testCurrentPDF() {
            if (totalScore === 0 && selectedAnswers.length === 0) {
                alert('Bitte führe zuerst das Assessment durch!');
                return;
            }
            
            const testEmail = document.getElementById('emailInput').value || 'test@example.com';
            generateExtendedPDFReport(testEmail, 'TEST_' + Date.now());
            
            gtag('event', 'pdf_test_generated', {
                event_category: 'Development',
                event_label: 'Test PDF generated',
                value: totalScore
            });
        }

        // Admin Functions
        function loadAdminData() {
            try {
                const allAssessments = loadData('allAssessmentData') || [];
                const allWaitlist = loadData('allWaitlistSignups') || [];
                const allPdfs = loadData('allPdfGenerations') || [];
                
                // Calculate statistics
                const totalAssessments = allAssessments.length;
                const avgScore = totalAssessments > 0 ? 
                    Math.round(allAssessments.reduce((sum, a) => sum + a.score, 0) / totalAssessments) : 0;
                const waitlistSignups = allWaitlist.length;
                const pdfGenerations = allPdfs.length;
                
                // Update admin panel
                document.getElementById('totalAssessments').textContent = totalAssessments;
                document.getElementById('avgScore').textContent = avgScore;
                document.getElementById('waitlistSignups').textContent = waitlistSignups;
                document.getElementById('pdfGenerations').textContent = pdfGenerations;
                
                // Detailed data
                const adminData = {
                    storageAvailability: checkStorageAvailability(),
                    assessments: allAssessments.slice(-5), // Last 5
                    waitlist: allWaitlist.slice(-5), // Last 5
                    pdfs: allPdfs.slice(-5), // Last 5
                    statistics: {
                        totalAssessments,
                        avgScore,
                        waitlistSignups,
                        pdfGenerations,
                        conversionRate: totalAssessments > 0 ? ((waitlistSignups / totalAssessments) * 100).toFixed(1) + '%' : '0%'
                    }
                };
                
                document.getElementById('adminData').textContent = JSON.stringify(adminData, null, 2);
                
            } catch (e) {
                console.log('Warning: Could not load admin data:', e.message);
                document.getElementById('adminData').textContent = 'Error loading admin data: ' + e.message;
            }
        }

        function exportData() {
            try {
                const exportData = {
                    assessments: loadData('allAssessmentData') || [],
                    waitlist: loadData('allWaitlistSignups') || [],
                    pdfs: loadData('allPdfGenerations') || [],
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'trading_psychology_data_' + new Date().toISOString().split('T')[0] + '.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                console.log('📤 Data exported successfully');
            } catch (e) {
                console.error('Error exporting data:', e);
                alert('Error exporting data: ' + e.message);
            }
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL data? This cannot be undone.')) {
                clearData();
                loadAdminData();
                alert('All data cleared successfully.');
                console.log('🗑️ All data cleared');
            }
        }

        function toggleAdminPanel() {
            const panel = document.getElementById('adminPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            if (panel.style.display === 'block') {
                loadAdminData();
            }
        }

        // Global functions for debugging and testing
        window.debugInfo = function() {
            console.log('=== DEBUG INFO ===');
            console.log('Current Question:', currentQuestion);
            console.log('Selected Answers:', selectedAnswers);
            console.log('Total Score:', totalScore);
            console.log('Storage Available:', checkStorageAvailability());
            
            const savedProgress = loadData('assessmentProgress');
            const savedResults = loadData('assessmentResults');
            const savedWaitlist = loadData('waitlistSignup');
            
            console.log('Saved Progress:', savedProgress);
            console.log('Saved Results:', savedResults);
            console.log('Saved Waitlist:', savedWaitlist);
            
            // Show admin panel
            toggleAdminPanel();
        };

        window.clearData = clearData;
        window.testCurrentPDF = testCurrentPDF;
        window.exportData = exportData;
        window.toggleAdminPanel = toggleAdminPanel;

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                e.preventDefault();
                debugInfo();
            }
            if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                e.preventDefault();
                testCurrentPDF();
            }
            if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                e.preventDefault();
                clearData();
                alert('All data cleared');
            }
        });

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            gtag('event', 'javascript_error', {
                event_category: 'Error',
                event_label: e.error.message,
                value: 1
            });
        });

        // Performance monitoring
        window.addEventListener('load', function() {
            const loadTime = performance.now();
            console.log(`⚡ Page loaded in ${loadTime.toFixed(2)}ms`);
            
            gtag('event', 'page_load_time', {
                event_category: 'Performance',
                event_label: 'Page load completed',
                value: Math.round(loadTime)
            });
        });

        // Visibility change tracking
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                gtag('event', 'page_hidden', {
                    event_category: 'Engagement',
                    event_label: 'User switched tab/minimized'
                });
            } else {
                gtag('event', 'page_visible', {
                    event_category: 'Engagement',
                    event_label: 'User returned to tab'
                });
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
        
        // Console welcome message
        console.log(`
🚀 Trading Psychology Assessment Tool
📊 Version: 2.0
🔧 Debug Commands:
- debugInfo() - Show debug information
- testCurrentPDF() - Generate test PDF
- clearData() - Clear all data
- exportData() - Export data as JSON

🎹 Keyboard Shortcuts:
- Ctrl+Shift+A - Open admin panel
- Ctrl+Shift+T - Generate test PDF
- Ctrl+Shift+C - Clear all data

© 2025 Schnitzlein Consulting
        `);
    </script>
</body>
</html>
