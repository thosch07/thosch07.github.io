// 🚀 ENHANCED 15-PAGE PDF GENERATION - €47 VERSION
// Ersetze deine generateExtendedPDFReport Funktion mit dieser erweiterten Version

function generateExtendedPDFReport(email, transactionId) {
    try {
        var jsPDF = window.jspdf.jsPDF;
        var doc = new jsPDF();
        var pageHeight = 297; // A4 height in mm
        var pageWidth = 210; // A4 width in mm
        var margin = 20;
        var contentWidth = pageWidth - (margin * 2);
        
        console.log('🔄 Generating enhanced 15-page PDF report...');
        
        // ===== PAGE 1: PROFESSIONAL COVER =====
        doc.setFillColor(102, 126, 234);
        doc.rect(0, 0, pageWidth, pageHeight, 'F');
        
        // Cover title
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(28);
        doc.setFont(undefined, 'bold');
        doc.text('EXTENDED AI TRADING', pageWidth/2, 80, { align: 'center' });
        doc.text('PSYCHOLOGY ANALYSIS', pageWidth/2, 100, { align: 'center' });
        
        // Subtitle
        doc.setFontSize(16);
        doc.setFont(undefined, 'normal');
        doc.text('Professional Psychological Assessment Report', pageWidth/2, 130, { align: 'center' });
        
        // User info box
        doc.setFillColor(255, 255, 255, 0.9);
        doc.rect(margin, 160, contentWidth, 60, 'F');
        doc.setTextColor(102, 126, 234);
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.text('PREPARED FOR:', margin + 10, 175);
        doc.setFont(undefined, 'normal');
        doc.text(email, margin + 10, 190);
        doc.text(`Assessment Score: ${assessmentData.totalScore}/320`, margin + 10, 205);
        doc.text(`Date: ${new Date().toLocaleDateString()}`, margin + 10, 220);
        
        // Footer
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(12);
        doc.text('Schnitzlein Consulting - Trading Psychology Experts', pageWidth/2, 260, { align: 'center' });
        doc.text(`Transaction ID: ${transactionId}`, pageWidth/2, 275, { align: 'center' });
        
        // ===== PAGE 2: EXECUTIVE SUMMARY =====
        doc.addPage();
        doc.setTextColor(0, 0, 0);
        
        // Header
        doc.setFillColor(102, 126, 234);
        doc.rect(0, 0, pageWidth, 30, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(18);
        doc.setFont(undefined, 'bold');
        doc.text('EXECUTIVE SUMMARY', pageWidth/2, 20, { align: 'center' });
        
        doc.setTextColor(0, 0, 0);
        var yPos = 50;
        
        // Overall assessment
        doc.setFontSize(16);
        doc.setFont(undefined, 'bold');
        doc.text('Overall Psychology Assessment', margin, yPos);
        yPos += 15;
        
        doc.setFontSize(12);
        doc.setFont(undefined, 'normal');
        
        // Score breakdown
        var scoreText = `Your trading psychology score of ${assessmentData.totalScore}/320 places you in the "${assessmentData.category}" category. `;
        
        if (assessmentData.totalScore >= 280) {
            scoreText += "This indicates exceptional psychological control and disciplined decision-making. You demonstrate strong emotional regulation and systematic thinking that are crucial for consistent trading success.";
        } else if (assessmentData.totalScore >= 200) {
            scoreText += "This reflects solid psychological foundations with opportunities for optimization. Your disciplined approach is commendable, and targeted improvements in specific areas could significantly enhance your performance.";
        } else if (assessmentData.totalScore >= 120) {
            scoreText += "This suggests developing trading psychology with clear improvement opportunities. You're on the right path, and focusing on emotional awareness and systematic approaches will accelerate your progress.";
        } else {
            scoreText += "This indicates significant emotional challenges that require immediate attention. Recognizing these patterns is the first crucial step toward building bulletproof trading psychology.";
        }
        
        var scoreLines = doc.splitTextToSize(scoreText, contentWidth);
        scoreLines.forEach(line => {
            if (yPos > 270) { doc.addPage(); yPos = 30; }
            doc.text(line, margin, yPos);
            yPos += 6;
        });
        
        yPos += 10;
        
        // Risk level assessment
        doc.setFont(undefined, 'bold');
        doc.text('Risk Level Assessment', margin, yPos);
        yPos += 10;
        doc.setFont(undefined, 'normal');
        
        var riskColor = assessmentData.aiAnalysis.riskLevel === 'HIGH' ? '#e53e3e' : 
                       assessmentData.aiAnalysis.riskLevel === 'MEDIUM' ? '#dd6b20' : '#38a169';
        
        doc.text(`Risk Level: ${assessmentData.aiAnalysis.riskLevel}`, margin, yPos);
        yPos += 15;
        
        var riskText = '';
        switch (assessmentData.aiAnalysis.riskLevel) {
            case 'HIGH':
                riskText = 'Your emotional responses pose significant threats to your trading capital. Immediate implementation of psychological controls and risk management protocols is essential. This report provides specific action steps to address these vulnerabilities.';
                break;
            case 'MEDIUM':
                riskText = 'You show good foundational psychology with some emotional vulnerabilities. Focus on strengthening identified weak areas while maintaining your current strengths. Consistent improvement in these areas will elevate your trading performance.';
                break;
            case 'LOW':
                riskText = 'Excellent emotional control and risk awareness. Your psychology is well-suited for consistent trading performance. Continue monitoring for any developing patterns and maintain your disciplined approach.';
                break;
        }
        
        var riskLines = doc.splitTextToSize(riskText, contentWidth);
        riskLines.forEach(line => {
            if (yPos > 270) { doc.addPage(); yPos = 30; }
            doc.text(line, margin, yPos);
            yPos += 6;
        });
        
        // Key findings summary
        yPos += 15;
        doc.setFont(undefined, 'bold');
        doc.text('Key Findings', margin, yPos);
        yPos += 10;
        doc.setFont(undefined, 'normal');
        
        if (assessmentData.aiAnalysis.detectedPatterns.length > 0) {
            doc.text(`• ${assessmentData.aiAnalysis.detectedPatterns.length} psychological patterns detected`, margin, yPos);
            yPos += 8;
            doc.text(`• Primary classification: ${assessmentData.aiAnalysis.advancedClassification}`, margin, yPos);
            yPos += 8;
            doc.text(`• ${assessmentData.aiAnalysis.personalizedTips.length} specific recommendations provided`, margin, yPos);
        } else {
            doc.text('• No significant negative patterns detected', margin, yPos);
            yPos += 8;
            doc.text('• Strong psychological control demonstrated', margin, yPos);
            yPos += 8;
            doc.text('• Focus on maintaining current discipline', margin, yPos);
        }
        
        // ===== PAGE 3-4: DETAILED PATTERN ANALYSIS =====
        doc.addPage();
        
        // Header
        doc.setFillColor(102, 126, 234);
        doc.rect(0, 0, pageWidth, 30, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(18);
        doc.setFont(undefined, 'bold');
        doc.text('DETAILED PATTERN ANALYSIS', pageWidth/2, 20, { align: 'center' });
        
        doc.setTextColor(0, 0, 0);
        yPos = 50;
        
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.text('AI-Detected Psychological Patterns', margin, yPos);
        yPos += 15;
        
        if (assessmentData.aiAnalysis.detectedPatterns.length > 0) {
            assessmentData.aiAnalysis.detectedPatterns.forEach((pattern, index) => {
                if (yPos > 250) { doc.addPage(); yPos = 30; }
                
                var confidence = assessmentData.aiAnalysis.confidence[pattern.toLowerCase().replace(' ', '_')] || 75;
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text(`${index + 1}. ${pattern}`, margin, yPos);
                yPos += 8;
                
                doc.setFont(undefined, 'normal');
                doc.text(`Confidence Level: ${confidence}%`, margin + 5, yPos);
                yPos += 8;
                
                // Pattern descriptions
                var patternDescription = '';
                switch (pattern.toLowerCase()) {
                    case 'fomo':
                        patternDescription = 'Fear of Missing Out (FOMO) drives impulsive trading decisions. You may enter trades late or chase price movements, often resulting in poor entry points and increased losses.';
                        break;
                    case 'revenge trading':
                        patternDescription = 'Revenge trading occurs when emotions drive you to immediately re-enter the market after a loss, often with larger position sizes to "win back" money quickly.';
                        break;
                    case 'analysis paralysis':
                        patternDescription = 'Analysis paralysis prevents timely decision-making. You may over-analyze setups to the point of missing opportunities or second-guessing valid signals.';
                        break;
                    case 'impulsive behavior':
                        patternDescription = 'Impulsive behavior manifests as quick, emotion-driven trading decisions without proper analysis or adherence to your trading plan.';
                        break;
                    case 'risk inconsistency':
                        patternDescription = 'Risk inconsistency shows in variable position sizing and risk management, often based on emotions rather than systematic rules.';
                        break;
                    default:
                        patternDescription = 'This pattern indicates areas where emotions may be influencing your trading decisions in ways that could impact your performance.';
                }
                
                var descLines = doc.splitTextToSize(patternDescription, contentWidth - 10);
                descLines.forEach(line => {
                    if (yPos > 270) { doc.addPage(); yPos = 30; }
                    doc.text(line, margin + 5, yPos);
                    yPos += 6;
                });
                
                yPos += 10;
                
                // Impact assessment
                doc.setFont(undefined, 'bold');
                doc.text('Impact Assessment:', margin + 5, yPos);
                yPos += 8;
                doc.setFont(undefined, 'normal');
                
                var impact = confidence > 85 ? 'HIGH' : confidence > 70 ? 'MEDIUM' : 'LOW';
                doc.text(`• Severity: ${impact}`, margin + 10, yPos);
                yPos += 6;
                doc.text(`• Urgency: ${confidence > 80 ? 'Immediate attention required' : 'Address within 30 days'}`, margin + 10, yPos);
                yPos += 6;
                doc.text(`• Actionability: High - specific interventions available`, margin + 10, yPos);
                yPos += 15;
            });
        } else {
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            var noPatternText = 'Excellent news! Our AI analysis did not detect any significant negative psychological patterns in your trading behavior. This indicates strong emotional control and disciplined decision-making. Your responses suggest you have developed effective psychological frameworks for trading.';
            var noPatternLines = doc.splitTextToSize(noPatternText, contentWidth);
            noPatternLines.forEach(line => {
                doc.text(line, margin, yPos);
                yPos += 6;
            });
            
            yPos += 15;
            doc.setFont(undefined, 'bold');
            doc.text('Recommendations for Continued Excellence:', margin, yPos);
            yPos += 10;
            doc.setFont(undefined, 'normal');
            doc.text('• Maintain your current disciplined approach', margin, yPos);
            yPos += 6;
            doc.text('• Regular self-assessment to prevent pattern development', margin, yPos);
            yPos += 6;
            doc.text('• Continue education in advanced trading psychology', margin, yPos);
        }
        
        // ===== PAGE 5-6: PSYCHOLOGY RISK ASSESSMENT =====
        doc.addPage();
        
        // Header
        doc.setFillColor(102, 126, 234);
        doc.rect(0, 0, pageWidth, 30, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(18);
        doc.setFont(undefined, 'bold');
        doc.text('PSYCHOLOGY RISK ASSESSMENT', pageWidth/2, 20, { align: 'center' });
        
        doc.setTextColor(0, 0, 0);
        yPos = 50;
        
        // Risk matrix
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.text('Comprehensive Risk Analysis', margin, yPos);
        yPos += 15;
        
        // Emotional volatility assessment
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        doc.text('Emotional Volatility Assessment', margin, yPos);
        yPos += 10;
        doc.setFont(undefined, 'normal');
        
        var volatilityScore = Math.max(0, Math.min(10, 10 - (assessmentData.totalScore / 32)));
        doc.text(`Emotional Volatility Score: ${volatilityScore.toFixed(1)}/10`, margin, yPos);
        yPos += 8;
        
        var volatilityText = volatilityScore < 3 ? 'Low volatility - excellent emotional control' :
                           volatilityScore < 6 ? 'Moderate volatility - good control with room for improvement' :
                           'High volatility - requires immediate attention';
        doc.text(`Assessment: ${volatilityText}`, margin, yPos);
        yPos += 15;
        
        // Decision-making under pressure
        doc.setFont(undefined, 'bold');
        doc.text('Decision-Making Under Pressure', margin, yPos);
        yPos += 10;
        doc.setFont(undefined, 'normal');
        
        var pressureScore = assessmentData.answers[5] * 2.5; // Volatility response question
        doc.text(`Pressure Response Score: ${pressureScore}/10`, margin, yPos);
        yPos += 8;
        
        var pressureText = pressureScore < 3 ? 'Excellent under pressure - maintains clarity' :
                          pressureScore < 6 ? 'Good pressure response with minor improvements needed' :
                          'Struggles under pressure - requires systematic intervention';
        doc.text(`Assessment: ${pressureText}`, margin, yPos);
        yPos += 15;
        
        // Risk management consistency
        doc.setFont(undefined, 'bold');
        doc.text('Risk Management Consistency', margin, yPos);
        yPos += 10;
        doc.setFont(undefined, 'normal');
        
        var riskScore = (3 - assessmentData.answers[6]) * 2.5; // Position sizing question
        doc.text(`Consistency Score: ${riskScore}/10`, margin, yPos);
        yPos += 8;
        
        var riskText = riskScore > 7 ? 'Highly consistent risk management' :
                      riskScore > 4 ? 'Moderately consistent with improvement opportunities' :
                      'Inconsistent risk management - high priority for improvement';
        doc.text(`Assessment: ${riskText}`, margin, yPos);
        yPos += 20;
        
        // Overall risk profile
        doc.setFont(undefined, 'bold');
        doc.setFontSize(14);
        doc.text('Overall Risk Profile', margin, yPos);
        yPos += 15;
        
        doc.setFontSize(12);
        doc.setFont(undefined, 'normal');
        var overallRisk = (volatilityScore + pressureScore + (10 - riskScore)) / 3;
        var riskCategory = overallRisk < 3 ? 'LOW RISK' : overallRisk < 6 ? 'MODERATE RISK' : 'HIGH RISK';
        
        doc.setFont(undefined, 'bold');
        doc.text(`Risk Category: ${riskCategory}`, margin, yPos);
        yPos += 10;
        doc.setFont(undefined, 'normal');
        
        var riskExplanation = '';
        if (overallRisk < 3) {
            riskExplanation = 'Your psychological profile indicates low risk for emotional trading mistakes. You demonstrate strong self-control and consistent decision-making. Continue monitoring and maintaining these strengths.';
        } else if (overallRisk < 6) {
            riskExplanation = 'Your profile shows moderate psychological risk. While you have good foundational skills, there are specific areas that could benefit from targeted improvement to prevent future issues.';
        } else {
            riskExplanation = 'Your profile indicates higher psychological risk that requires immediate attention. The patterns identified could significantly impact your trading performance if not addressed systematically.';
        }
        
        var riskExplLines = doc.splitTextToSize(riskExplanation, contentWidth);
        riskExplLines.forEach(line => {
            if (yPos > 270) { doc.addPage(); yPos = 30; }
            doc.text(line, margin, yPos);
            yPos += 6;
        });
        
        // ===== PAGE 7-9: PERSONALIZED IMPROVEMENT ROADMAP =====
        doc.addPage();
        
        // Header
        doc.setFillColor(102, 126, 234);
        doc.rect(0, 0, pageWidth, 30, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(18);
        doc.setFont(undefined, 'bold');
        doc.text('PERSONALIZED IMPROVEMENT ROADMAP', pageWidth/2, 20, { align: 'center' });
        
        doc.setTextColor(0, 0, 0);
        yPos = 50;
        
        // 30-day action plan
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.text('30-Day Intensive Improvement Plan', margin, yPos);
        yPos += 15;
        
        // Week 1
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        doc.text('WEEK 1: AWARENESS & ASSESSMENT', margin, yPos);
        yPos += 10;
        doc.setFont(undefined, 'normal');
        
        var week1Tasks = [
            'Begin daily emotion tracking before and after trading sessions',
            'Implement the provided psychology tracking spreadsheet',
            'Complete one self-assessment questionnaire daily',
            'Read and understand your specific pattern analysis',
            'Identify your top 3 emotional triggers'
        ];
        
        week1Tasks.forEach(task => {
            if (yPos > 270) { doc.addPage(); yPos = 30; }
            doc.text(`• ${task}`, margin + 5, yPos);
            yPos += 6;
        });
        yPos += 10;
        
        // Week 2
        doc.setFont(undefined, 'bold');
        doc.text('WEEK 2: INTERVENTION DEVELOPMENT', margin, yPos);
        yPos += 10;
        doc.setFont(undefined, 'normal');
        
        var week2Tasks = [
            'Develop personal trading psychology rules based on your patterns',
            'Create pre-trade emotional checklist',
            'Practice the STOP method (Stop, Think, Options, Proceed)',
            'Implement cooling-off periods for high-emotion situations',
            'Begin meditation or breathing exercises (5 minutes daily)'
        ];
        
        week2Tasks.forEach(task => {
            if (yPos > 270) { doc.addPage(); yPos = 30; }
            doc.text(`• ${task}`, margin + 5, yPos);
            yPos += 6;
        });
        yPos += 10;
        
        // Week 3
        doc.setFont(undefined, 'bold');
        doc.text('WEEK 3: SYSTEM IMPLEMENTATION', margin, yPos);
        yPos += 10;
        doc.setFont(undefined, 'normal');
        
        var week3Tasks = [
            'Fully implement your personalized trading psychology system',
            'Practice position sizing rules consistently',
            'Use mandatory wait times before entering trades',
            'Document all emotional responses and their outcomes',
            'Review and adjust rules based on initial results'
        ];
        
        week3Tasks.forEach(task => {
            if (yPos > 270) { doc.addPage(); yPos = 30; }
            doc.text(`• ${task}`, margin + 5, yPos);
            yPos += 6;
        });
        yPos += 10;
        
        // Week 4
        doc.setFont(undefined, 'bold');
        doc.text('WEEK 4: OPTIMIZATION & PLANNING', margin, yPos);
        yPos += 10;
        doc.setFont(undefined, 'normal');
        
        var week4Tasks = [
            'Analyze 30-day progress using tracking data',
            'Identify what worked and what needs adjustment',
            'Refine your psychology system based on results',
            'Plan next 30-day improvement cycle',
            'Celebrate progress and maintain motivation'
        ];
        
        week4Tasks.forEach(task => {
            if (yPos > 270) { doc.addPage(); yPos = 30; }
            doc.text(`• ${task}`, margin + 5, yPos);
            yPos += 6;
        });
        
        // 60-day and 90-day plans
        if (yPos > 220) { doc.addPage(); yPos = 30; }
        
        yPos += 15;
        doc.setFont(undefined, 'bold');
        doc.setFontSize(14);
        doc.text('60-Day Advanced Development', margin, yPos);
        yPos += 15;
        
        doc.setFontSize(12);
        doc.setFont(undefined, 'normal');
        var day60Text = 'After establishing your foundation in the first 30 days, focus on advanced psychological techniques: stress inoculation training, advanced risk management psychology, developing intuitive decision-making skills, and building long-term psychological resilience.';
        var day60Lines = doc.splitTextToSize(day60Text, contentWidth);
        day60Lines.forEach(line => {
            doc.text(line, margin, yPos);
            yPos += 6;
        });
        
        yPos += 15;
        doc.setFont(undefined, 'bold');
        doc.setFontSize(14);
        doc.text('90-Day Mastery Integration', margin, yPos);
        yPos += 15;
        
        doc.setFontSize(12);
        doc.setFont(undefined, 'normal');
        var day90Text = 'By day 90, focus on integrating all psychological improvements into an unconscious competence level. This includes automated emotional responses, effortless risk management, and teaching others to reinforce your own learning.';
        var day90Lines = doc.splitTextToSize(day90Text, contentWidth);
        day90Lines.forEach(line => {
            doc.text(line, margin, yPos);
            yPos += 6;
        });
        
        // ===== PAGE 10-12: SPECIFIC RECOMMENDATIONS =====
        doc.addPage();
        
        // Header
        doc.setFillColor(102, 126, 234);
        doc.rect(0, 0, pageWidth, 30, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(18);
        doc.setFont(undefined, 'bold');
        doc.text('SPECIFIC RECOMMENDATIONS', pageWidth/2, 20, { align: 'center' });
        
        doc.setTextColor(0, 0, 0);
        yPos = 50;
        
        // Personalized recommendations based on patterns
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.text('Tailored Action Steps', margin, yPos);
        yPos += 15;
        
        if (assessmentData.aiAnalysis.personalizedTips.length > 0) {
            assessmentData.aiAnalysis.personalizedTips.forEach((tip, index) => {
                if (yPos > 250) { doc.addPage(); yPos = 30; }
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text(`${index + 1}. ACTION ITEM`, margin, yPos);
                yPos += 10;
                
                doc.setFont(undefined, 'normal');
                var tipLines = doc.splitTextToSize(tip, contentWidth - 10);
                tipLines.forEach(line => {
                    if (yPos > 270) { doc.addPage(); yPos = 30; }
                    doc.text(line, margin + 5, yPos);
                    yPos += 6;
                });
                
                yPos += 5;
                doc.setFont(undefined, 'bold');
                doc.text('Implementation Timeline:', margin + 5, yPos);
                yPos += 6;
                doc.setFont(undefined, 'normal');
                doc.text('• Start: Within 48 hours', margin + 10, yPos);
                yPos += 5;
                doc.text('• Practice: Daily for 2 weeks', margin + 10, yPos);
                yPos += 5;
                doc.text('• Review: Weekly assessment of progress', margin + 10, yPos);
                yPos += 15;
            });
        }
        
        // Emergency protocols
        yPos += 10;
        doc.setFont(undefined, 'bold');
        doc.setFontSize(14);
        doc.text('Emergency Psychology Protocols', margin, yPos);
        yPos += 15;
        
        doc.setFontSize(12);
        doc.setFont(undefined, 'normal');
        var emergencyText = 'When experiencing high emotional states during trading, implement these immediate interventions:';
        doc.text(emergencyText, margin, yPos);
        yPos += 15;
        
        var emergencySteps = [
            'STOP: Immediately step away from trading platform',
            'BREATHE: Take 10 deep breaths (4 counts in, 6 counts out)',
            'ASSESS: Rate your emotional state from 1-10',
            'WAIT: If above 6/10, wait minimum 15 minutes',
            'REVIEW: Check your trading rules before any action',
            'PROCEED: Only if emotional state is below 5/10'
        ];
        
        emergencySteps.forEach(step => {
            if (yPos > 270) { doc.addPage(); yPos = 30; }
            doc.text(`• ${step}`, margin, yPos);
            yPos += 8;
        });
        
        // ===== PAGE 13-14: RESOURCES & TOOLS =====
        doc.addPage();
        
        // Header
        doc.setFillColor(102, 126, 234);
        doc.rect(0, 0, pageWidth, 30, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(18);
        doc.setFont(undefined, 'bold');
        doc.text('RESOURCES & TOOLS', pageWidth/2, 20, { align: 'center' });
        
        doc.setTextColor(0, 0, 0);
        yPos = 50;
        
        // Psychology tracking templates
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.text('Psychology Tracking Templates', margin, yPos);
        yPos += 15;
        
        doc.setFontSize(12);
        doc.setFont(undefined, 'normal');
        doc.text('Your purchase includes access to our comprehensive tracking spreadsheet:', margin, yPos);
        yPos += 10;
        
        var trackingFeatures = [
            'Daily emotion assessment forms',
            'Trade psychology scoring system',
            'Pattern recognition tracking',
            'Progress visualization charts',
            'Goal setting and milestone tracking'
        ];
        
        trackingFeatures.forEach(feature => {
            doc.text(`• ${feature}`, margin + 5, yPos);
            yPos += 6;
        });
        
        yPos += 15;
        
        // Recommended reading
        doc.setFont(undefined, 'bold');
        doc.text('Recommended Reading', margin, yPos);
        yPos += 10;
        doc.setFont(undefined, 'normal');
        
        var books = [
            '"Trading Psychology 2.0" by Brett Steenbarger',
            '"Market Mind Games" by Denise Shull',
            '"The Psychology of Risk" by Ari Kiev',
            '"Mental Game of Trading" by Jared Tendler',
            '"Thinking, Fast and Slow" by Daniel Kahneman'
        ];
        
        books.forEach(book => {
            if (yPos > 270) { doc.addPage(); yPos = 30; }
            doc.text(`• ${book}`, margin + 5, yPos);
            yPos += 6;
        });
        
        yPos += 15;
        
        // Apps and tools
        doc.setFont(undefined, 'bold');
        doc.text('Recommended Apps & Tools', margin, yPos);
        yPos += 10;
        doc.setFont(undefined, 'normal');
        
        var tools = [
            'Headspace or Calm (meditation apps)',
            'TradingView (with custom alerts for psychological breaks)',
            'Mood tracking apps for correlation analysis',
            'Timer apps for mandatory waiting periods',
            'Journal apps for detailed trade reflection'
        ];
        
        tools.forEach(tool => {
            if (yPos > 270) { doc.addPage(); yPos = 30; }
            doc.text(`• ${tool}`, margin + 5, yPos);
            yPos += 6;
        });
        
        // ===== PAGE 15: NEXT STEPS & SUPPORT =====
        doc.addPage();
        
        // Header
        doc.setFillColor(102, 126, 234);
        doc.rect(0, 0, pageWidth, 30, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(18);
        doc.setFont(undefined, 'bold');
        doc.text('NEXT STEPS & SUPPORT', pageWidth/2, 20, { align: 'center' });
        
        doc.setTextColor(0, 0, 0);
        yPos = 50;
        
        // Immediate next steps
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.text('Your Immediate Next Steps', margin, yPos);
        yPos += 15;
        
        doc.setFontSize(12);
        doc.setFont(undefined, 'normal');
        
        var nextSteps = [
            'Download and set up your psychology tracking spreadsheet',
            'Join the 7-day email course that starts tomorrow',
            'Implement your Week 1 action items immediately',
            'Schedule daily 10-minute review sessions',
            'Set calendar reminders for weekly progress checks'
        ];
        
        nextSteps.forEach((step, index) => {
            doc.setFont(undefined, 'bold');
            doc.text(`${index + 1}.`, margin, yPos);
            doc.setFont(undefined, 'normal');
            doc.text(step, margin + 15, yPos);
            yPos += 10;
        });
        
        yPos += 15;
        
        // Support information
        doc.setFont(undefined, 'bold');
        doc.text('Ongoing Support', margin, yPos);
        yPos += 15;
        doc.setFont(undefined, 'normal');
        
        var supportText = 'Your journey to trading psychology mastery doesn\'t end with this report. You have access to ongoing support through our email course, and can reach out with questions about implementing these recommendations.';
        var supportLines = doc.splitTextToSize(supportText, contentWidth);
        supportLines.forEach(line => {
            doc.text(line, margin, yPos);
            yPos += 6;
        });
        
        yPos += 15;
        doc.text('Contact: info@schnitzleinconsulting.com', margin, yPos);
        yPos += 8;
        doc.text('Subject: Psychology Analysis Support', margin, yPos);
        
        yPos += 20;
        
        // Final motivation
        doc.setFont(undefined, 'bold');
        doc.text('Your Success Statement', margin, yPos);
        yPos += 15;
        doc.setFont(undefined, 'normal');
        
        var motivationText = 'Trading psychology mastery is not a destination—it\'s a continuous journey of self-improvement and emotional growth. You now have the tools, insights, and roadmap to transform your trading psychology. The only question remaining is: will you take consistent action on what you\'ve learned? Your future trading success depends on the work you do today.';
        var motivationLines = doc.splitTextToSize(motivationText, contentWidth);
        motivationLines.forEach(line => {
            doc.text(line, margin, yPos);
            yPos += 6;
        });
        
        // Footer with branding
        yPos = 260;
        doc.setFillColor(102, 126, 234);
        doc.rect(0, yPos, pageWidth, 37, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(12);
        doc.setFont(undefined, 'bold');
        doc.text('Schnitzlein Consulting - Trading Psychology Experts', pageWidth/2, yPos + 15, { align: 'center' });
        doc.setFont(undefined, 'normal');
        doc.text('Transforming Traders Through Psychology', pageWidth/2, yPos + 25, { align: 'center' });
        
        // Generate filename and download
        var fileName = `Extended-Trading-Psychology-Analysis-${transactionId}.pdf`;
        doc.save(fileName);
        
        // Track the download
        gtag('event', 'extended_pdf_downloaded', {
            event_category: 'product_delivery',
            event_label: 'extended_analysis',
            value: 47.00
        });
        
        console.log('✅ Enhanced 15-page PDF generated successfully');
        
    } catch (error) {
        console.error('❌ Enhanced PDF generation error:', error);
        alert('There was an issue generating your extended PDF. Your purchase is confirmed - we\'ll email the report within 5 minutes.');
    }
}
