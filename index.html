<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Psychology Assessment | AI-Enhanced Insights</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZZWV8LY8MS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ZZWV8LY8MS');
    </script>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.5em;
            color: #4c51bf;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .header p {
            font-size: 1.2em;
            color: #666;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .question-container {
            background: rgba(255, 255, 255, 0.98);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.6s ease;
            backdrop-filter: blur(10px);
        }
        
        .question-container.active {
            transform: translateY(0);
            opacity: 1;
        }
        
        .question {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 25px;
            color: #2d3748;
            line-height: 1.5;
        }
        
        .question-number {
            color: #4c51bf;
            font-size: 0.9em;
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .options {
            display: grid;
            gap: 15px;
        }
        
        .option {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            line-height: 1.4;
            position: relative;
            overflow: hidden;
        }
        
        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .option:hover::before {
            left: 100%;
        }
        
        .option:hover {
            background: #edf2f7;
            border-color: #4c51bf;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 81, 191, 0.15);
        }
        
        .option.selected {
            background: linear-gradient(135deg, #4c51bf, #667eea);
            color: white;
            border-color: #4c51bf;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 81, 191, 0.3);
        }
        
        .option.selected::before {
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4c51bf, #667eea);
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
            box-shadow: 0 2px 4px rgba(76, 81, 191, 0.3);
        }
        
        .progress-text {
            text-align: center;
            color: white;
            font-weight: 500;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .btn {
            background: linear-gradient(135deg, #4c51bf, #667eea);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
            box-shadow: 0 4px 15px rgba(76, 81, 191, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(76, 81, 191, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 15px rgba(76, 81, 191, 0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn:disabled:hover {
            transform: none;
            box-shadow: 0 4px 15px rgba(76, 81, 191, 0.2);
        }
        
        .btn:disabled::before {
            display: none;
        }
        
        .results-section {
            background: rgba(255, 255, 255, 0.98);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            backdrop-filter: blur(10px);
        }
        
        .score-display {
            font-size: 3em;
            font-weight: bold;
            color: #4c51bf;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            animation: countUp 2s ease-out;
        }
        
        @keyframes countUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .category {
            font-size: 1.5em;
            font-weight: 600;
            padding: 15px 25px;
            border-radius: 10px;
            display: inline-block;
            margin: 20px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .category.elitetrader { 
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4); 
            color: #22543d; 
            border: 2px solid #22543d;
        }
        .category.disciplinedtrader { 
            background: linear-gradient(135deg, #bee3f8, #90cdf4); 
            color: #2a4365; 
            border: 2px solid #2a4365;
        }
        .category.developingtrader { 
            background: linear-gradient(135deg, #fef5e7, #fed7aa); 
            color: #744210; 
            border: 2px solid #744210;
        }
        .category.vulnerabletrader { 
            background: linear-gradient(135deg, #fed7d7, #feb2b2); 
            color: #742a2a; 
            border: 2px solid #742a2a;
        }
        
        .analysis-section {
            text-align: left;
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            border-radius: 12px;
            border-left: 5px solid #4c51bf;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .analysis-section h3 {
            color: #4c51bf;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .analysis-section p {
            margin-bottom: 15px;
            color: #2d3748;
        }
        
        .analysis-section ul {
            margin-left: 20px;
        }
        
        .analysis-section li {
            margin-bottom: 8px;
            color: #4a5568;
        }
        
        .risk-level {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 1.1em;
            margin: 10px 0;
        }
        
        .risk-low { background: #c6f6d5; color: #22543d; }
        .risk-moderate { background: #fef5e7; color: #744210; }
        .risk-high { background: #fed7d7; color: #742a2a; }
        .risk-critical { background: #feb2b2; color: #742a2a; font-weight: 900; }
        
        .product-features {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin: 30px 0;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .product-features::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            50% { transform: translate(-40%, -60%) rotate(180deg); }
        }
        
        .product-features > * {
            position: relative;
            z-index: 1;
        }
        
        .product-features h3 {
            font-size: 2em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .feature-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .feature-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .feature-item h4 {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #ffd700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .feature-item p {
            font-size: 0.95em;
            line-height: 1.5;
            opacity: 0.9;
        }
        
        .price-highlight {
            font-size: 2.5em;
            font-weight: bold;
            color: #ffd700;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .price-highlight .old-price {
            font-size: 0.5em;
            text-decoration: line-through;
            opacity: 0.7;
            margin-left: 10px;
        }
        
        .waitlist-form {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .waitlist-form h4 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #4c51bf;
            box-shadow: 0 0 10px rgba(76, 81, 191, 0.2);
            transform: translateY(-1px);
        }
        
        .form-group input:invalid {
            border-color: #e53e3e;
        }
        
        .btn-waitlist {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn-waitlist::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-waitlist:hover::before {
            left: 100%;
        }
        
        .btn-waitlist:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(72, 187, 120, 0.4);
        }
        
        .coming-soon-banner {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #856404;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 4px 15px rgba(133, 100, 4, 0.2);
        }
        
        .coming-soon-banner h4 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .coming-soon-banner p {
            color: #744210;
            margin: 0;
        }
        
        #loading {
            display: none;
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4c51bf;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #4c51bf;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .loading-subtext {
            color: #666;
            font-size: 1em;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Admin Panel Styles */
        .admin-panel {
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .admin-header {
            font-size: 1.5em;
            color: #4c51bf;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 10px rgba(76, 81, 191, 0.5);
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(76, 81, 191, 0.3);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(76, 81, 191, 0.5);
            transform: translateY(-2px);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #4c51bf;
            text-shadow: 0 0 10px rgba(76, 81, 191, 0.5);
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #ccc;
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9em;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th,
        .data-table td {
            border: 1px solid #444;
            padding: 12px 8px;
            text-align: left;
        }
        
        .data-table th {
            background: #4c51bf;
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .data-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .data-table tbody tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.02);
        }
        
        /* Social Sharing Styles */
        .social-section {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        
        .social-section h4 {
            color: #4c51bf;
            margin-bottom: 10px;
        }
        
        .social-section p {
            color: #666;
            margin-bottom: 15px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .question-container {
                padding: 20px;
            }
            
            .question {
                font-size: 1.1em;
            }
            
            .option {
                padding: 15px;
                font-size: 1em;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .score-display {
                font-size: 2.5em;
            }
            
            .category {
                font-size: 1.2em;
                padding: 12px 20px;
            }
            
            .product-features {
                padding: 30px 20px;
            }
            
            .price-highlight {
                font-size: 2em;
            }
            
            .results-section {
                padding: 30px 20px;
            }
            
            .analysis-section {
                padding: 20px;
            }
            
            .waitlist-form {
                padding: 20px;
            }
            
            .stat-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .data-table {
                font-size: 0.8em;
            }
            
            .data-table th,
            .data-table td {
                padding: 8px 4px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .header p {
                font-size: 1em;
            }
            
            .question-container {
                padding: 15px;
            }
            
            .question {
                font-size: 1em;
            }
            
            .option {
                padding: 12px;
                font-size: 0.95em;
            }
            
            .score-display {
                font-size: 2em;
            }
            
            .category {
                font-size: 1em;
                padding: 10px 15px;
            }
            
            .price-highlight {
                font-size: 1.8em;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 1em;
            }
            
            .btn-waitlist {
                padding: 12px 20px;
                font-size: 1.1em;
            }
        }
        
        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.6s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Loading States */
        .btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }
        
        .btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Success/Error States */
        .success-message {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            color: #22543d;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #22543d;
            font-weight: 500;
        }
        
        .error-message {
            background: linear-gradient(135deg, #fed7d7, #feb2b2);
            color: #742a2a;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #742a2a;
            font-weight: 500;
        }
        
        /* Tooltip Styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            font-size: 0.9em;
            
            /* Position the tooltip */
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            
            /* Fade in tooltip */
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header fade-in">
            <h1>🧠 AI Trading Psychology Assessment</h1>
            <p>Discover the psychological patterns that impact your trading success. Get personalized insights powered by advanced AI analysis to transform your trading performance.</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">Question 0 of 8</div>

        <!-- Questions Container -->
        <div id="questionsContainer">
            <!-- Questions will be dynamically loaded here -->
        </div>

        <!-- Loading Screen -->
        <div id="loading">
            <div class="spinner"></div>
            <h3 class="loading-text">🤖 AI is analyzing your responses...</h3>
            <p class="loading-subtext">Processing your psychological patterns and generating personalized insights...</p>
        </div>

        <!-- Results Section -->
        <div id="results" class="results-section hidden">
            <h2>🎯 Your Trading Psychology Assessment Results</h2>
            <div class="score-display" id="scoreDisplay">0/320</div>
            <div class="category" id="categoryDisplay">Analyzing...</div>
            
            <div class="analysis-section">
                <h3>📊 AI Analysis Summary</h3>
                <div id="aiAnalysis">
                    <p>Your results show specific patterns that influence your trading decisions. Our AI has identified key areas for improvement and strengths to leverage.</p>
                </div>
            </div>

            <!-- Extended Product Offer -->
            <div class="product-features">
                <h3>🚀 Get Your Complete Extended Analysis</h3>
                <p>Your basic assessment is just the beginning. Unlock the full potential of your trading psychology with our comprehensive analysis package.</p>
                
                <div class="feature-grid">
                    <div class="feature-item">
                        <h4>📄 15-Page Detailed Analysis</h4>
                        <p>Deep dive into your specific patterns with AI confidence scores, risk assessments, and personalized insights based on your unique psychological profile</p>
                    </div>
                    <div class="feature-item">
                        <h4>📊 Psychology Tracking Spreadsheet</h4>
                        <p>Professional-grade tools to monitor your emotional patterns, track trading performance correlation, and identify improvement opportunities</p>
                    </div>
                    <div class="feature-item">
                        <h4>📧 7-Day Email Mastery Course</h4>
                        <p>"Trading Psychology Mastery" - daily lessons with actionable techniques to implement your psychological improvements systematically</p>
                    </div>
                    <div class="feature-item">
                        <h4>🗺️ 90-Day Improvement Roadmap</h4>
                        <p>Step-by-step action plan with 30/60/90-day milestones, specific techniques, and weekly check-ins to ensure consistent progress</p>
                    </div>
                    <div class="feature-item">
                        <h4>📈 Advanced Pattern Analysis</h4>
                        <p>AI confidence scores for each psychological pattern with detailed explanations, risk categories, and pattern-specific recommendations</p>
                    </div>
                    <div class="feature-item">
                        <h4>🎯 Emergency Protocols</h4>
                        <p>Crisis management strategies for high-stress trading situations, FOMO prevention techniques, and emotional regulation emergency protocols</p>
                    </div>
                </div>

                <div class="coming-soon-banner">
                    <h4>🚧 Launching Soon!</h4>
                    <p>Extended Analysis is in final development. Join waitlist for early access + special pricing!</p>
                </div>

                <div class="price-highlight">€47<span class="old-price">€97</span></div>
                <p style="margin-bottom: 30px;">Limited Time Launch Price - 52% Off Regular Price</p>

                <div class="waitlist-form">
                    <h4>🔔 Join the Waitlist</h4>
                    <p style="color: #666; margin-bottom: 20px;">Be the first to get access when we launch + lock in the special pricing. Over 200 traders already waiting!</p>
                    
                    <div class="form-group">
                        <label for="waitlistEmail">Email Address:</label>
                        <input type="email" id="waitlistEmail" placeholder="your@email.com" required>
                    </div>
                    
                    <button class="btn-waitlist" onclick="joinWaitlist()">
                        🔔 Notify Me When Ready
                    </button>
                    
                    <p style="font-size: 0.9em; color: #666; margin-top: 15px;">
                        We'll notify you as soon as it's available. No spam, unsubscribe anytime. Privacy policy compliant.
                    </p>
                </div>
            </div>

            <!-- Social Sharing -->
            <div class="social-section">
                <h4>💡 Found this helpful?</h4>
                <p>Share this free assessment with other traders who could benefit from understanding their psychology patterns.</p>
                <button class="btn" onclick="shareAssessment()">📤 Share Assessment</button>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="admin-panel hidden">
            <div class="admin-header">🔧 ADMIN DASHBOARD</div>
            <div id="adminStats">Loading admin data...</div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentQuestion = 0;
        let answers = [];
        let assessmentData = {};
        let startTime = Date.now();
        
        // Database simulation with cookie backup
        const database = {
            data: {
                assessments: [],
                emails: [],
                waitlist: [],
                purchases: []
            },
            
            load: function() {
                // Try to load from cookies as backup
                try {
                    const cookieData = this.getCookie('tradingPsychologyData');
                    if (cookieData) {
                        const parsed = JSON.parse(cookieData);
                        this.data = { ...this.data, ...parsed };
                        console.log('📊 Data loaded from cookies:', this.data);
                    }
                } catch (error) {
                    console.warn('Failed to load from cookies:', error);
                }
                return this.data;
            },
            
            save: function() {
                // Save to cookies as backup
                try {
                    this.setCookie('tradingPsychologyData', JSON.stringify(this.data), 30);
                    console.log('💾 Data saved to cookies');
                } catch (error) {
                    console.warn('Failed to save to cookies:', error);
                }
            },
            
            setCookie: function(name, value, days) {
                const expires = new Date();
                expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
                document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/;SameSite=Lax`;
            },
            
            getCookie: function(name) {
                const nameEQ = name + "=";
                const ca = document.cookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            },
            
            addAssessment: function(data) {
                this.data.assessments.push({
                    ...data,
                    timestamp: new Date().toISOString(),
                    id: 'assess_' + Date.now()
                });
                this.save();
            },
            
            addEmail: function(email, source = 'assessment') {
                // Check for duplicates
                const exists = this.data.emails.some(e => e.email === email);
                if (!exists) {
                    this.data.emails.push({
                        email: email,
                        source: source,
                        timestamp: new Date().toISOString(),
                        id: 'email_' + Date.now()
                    });
                    this.save();
                    
                    // Track in Google Analytics
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'email_conversion', {
                            event_category: 'conversion',
                            event_label: source,
                            value: 1,
                            custom_parameters: {
                                email_source: source,
                                timestamp: new Date().toISOString()
                            }
                        });
                    }
                }
            },
            
            addWaitlist: function(email) {
                // Check for duplicates
                const exists = this.data.waitlist.some(w => w.email === email);
                if (!exists) {
                    this.data.waitlist.push({
                        email: email,
                        timestamp: new Date().toISOString(),
                        id: 'wait_' + Date.now()
                    });
                    this.save();
                }
            },
            
            getStats: function() {
                return {
                    totalAssessments: this.data.assessments.length,
                    totalEmails: this.data.emails.length,
                    totalWaitlist: this.data.waitlist.length,
                    totalPurchases: this.data.purchases.length,
                    totalRevenue: this.data.purchases.reduce((sum, p) => sum + (p.amount || 0), 0)
                };
            }
        };

        // Initialize database
        database.load();

        // Trading Psychology Questions
        const questions = [
            {
                question: "When you see a stock rapidly increasing in price, what's your immediate reaction?",
                options: [
                    { text: "I immediately want to buy before I miss out on the opportunity", points: 0 },
                    { text: "I feel anxious but try to stick to my predetermined trading plan", points: 10 },
                    { text: "I analyze whether it fits my strategy before considering any action", points: 25 },
                    { text: "I remain calm and wait for my planned entry point regardless of the movement", points: 40 }
                ]
            },
            {
                question: "How do you typically react after experiencing a significant trading loss?",
                options: [
                    { text: "I immediately try to win back the money with a bigger trade to recover quickly", points: 0 },
                    { text: "I feel frustrated and often take a bigger risk on the very next trade", points: 8 },
                    { text: "I review what went wrong and adjust my strategy based on the lessons learned", points: 22 },
                    { text: "I take a break to clear my head and stick to my risk management rules", points: 35 }
                ]
            },
            {
                question: "When friends or social media show off their trading gains, how does it affect you?",
                options: [
                    { text: "I feel pressured to make similar gains and often increase my position sizes", points: 0 },
                    { text: "I feel envious and seriously consider changing my current trading strategy", points: 12 },
                    { text: "I'm happy for them but stay focused on my own trading plan and goals", points: 28 },
                    { text: "It doesn't influence my trading decisions at all - I ignore the noise", points: 40 }
                ]
            },
            {
                question: "How do you handle a string of winning trades?",
                options: [
                    { text: "I get overconfident and significantly increase my position sizes", points: 0 },
                    { text: "I feel great but sometimes get careless with my analysis and due diligence", points: 15 },
                    { text: "I enjoy the success but work hard to maintain my trading discipline", points: 30 },
                    { text: "I stay completely focused and stick to my original position sizing plan", points: 40 }
                ]
            },
            {
                question: "When you're in a losing position, what's your typical response?",
                options: [
                    { text: "I hold on hoping it will turn around, even past my predetermined stop loss", points: 0 },
                    { text: "I feel stressed and sometimes move my stop loss further away to avoid the loss", points: 10 },
                    { text: "I stick to my stop loss but feel quite emotional about cutting the position", points: 25 },
                    { text: "I cut losses according to my plan without hesitation or emotional attachment", points: 35 }
                ]
            },
            {
                question: "How do you prepare mentally before entering a trade?",
                options: [
                    { text: "I just jump in when I see what looks like a good opportunity", points: 0 },
                    { text: "I do some basic analysis but often end up acting on gut feeling", points: 12 },
                    { text: "I plan my entry and exit points but sometimes deviate during execution", points: 28 },
                    { text: "I have a complete plan including entry, exit, and risk management before entering", points: 40 }
                ]
            },
            {
                question: "How do you react to market volatility and sudden price movements?",
                options: [
                    { text: "I often panic and make impulsive decisions that I later regret", points: 0 },
                    { text: "I feel quite anxious and sometimes abandon my strategy completely", points: 8 },
                    { text: "I stay relatively calm but definitely feel some stress and uncertainty", points: 20 },
                    { text: "I view it as normal market behavior and stick to my predetermined plan", points: 30 }
                ]
            },
            {
                question: "What's your approach to position sizing (how much money you risk per trade)?",
                options: [
                    { text: "I risk whatever amount feels right at the moment based on my confidence", points: 0 },
                    { text: "I generally risk more when I'm feeling confident about a particular trade", points: 10 },
                    { text: "I try to be consistent but sometimes vary based on how I'm feeling", points: 20 },
                    { text: "I always risk the same percentage regardless of how confident I feel about the trade", points: 30 }
                ]
            }
        ];

        // Utility Functions
        function showMessage(text, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `${type}-message`;
            messageDiv.textContent = text;
            
            // Insert after results header
            const results = document.getElementById('results');
            if (results && !results.classList.contains('hidden')) {
                results.insertBefore(messageDiv, results.children[1]);
                setTimeout(() => messageDiv.remove(), 5000);
            }
        }

        function formatNumber(num) {
            return num.toLocaleString();
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('de-DE', {
                style: 'currency',
                currency: 'EUR'
            }).format(amount);
        }

        // Initialize Assessment
        function initializeAssessment() {
            console.log('🎯 Assessment initialized');
            
            // Check for admin mode
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('admin') === 'true') {
                showAdminPanel();
                return;
            }
            
            showQuestion(0);
            updateProgress();
            
            // Track page load
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_view', {
                    page_title: 'Trading Psychology Assessment',
                    page_location: window.location.href,
                    custom_parameters: {
                        session_start: new Date().toISOString(),
                        user_agent: navigator.userAgent
                    }
                });
            }
            
            console.log('✅ Event listeners attached, assessment ready');
        }

        function showQuestion(questionIndex) {
            currentQuestion = questionIndex;
            const container = document.getElementById('questionsContainer');
            
            if (questionIndex >= questions.length) {
                calculateResults();
                return;
            }
            
            const question = questions[questionIndex];
            
            container.innerHTML = `
                <div class="question-container active slide-up">
                    <div class="question-number">Question ${questionIndex + 1} of ${questions.length}</div>
                    <div class="question">
                        ${question.question}
                    </div>
                    <div class="options">
                        ${question.options.map((option, index) => `
                            <div class="option" onclick="selectOption(${index})" data-points="${option.points}">
                                ${option.text}
                            </div>
                        `).join('')}
                    </div>
                    <div style="text-align: center; margin-top: 30px;">
                        ${questionIndex > 0 ? '<button class="btn" onclick="previousQuestion()">← Previous</button>' : ''}
                        <button class="btn" id="nextBtn" onclick="nextQuestion()" disabled>
                            ${questionIndex === questions.length - 1 ? 'Complete Assessment →' : 'Next →'}
                        </button>
                    </div>
                </div>
            `;
            
            updateProgress();
            
            // Restore previous answer if exists
            if (answers[currentQuestion]) {
                const options = document.querySelectorAll('.option');
                options[answers[currentQuestion].optionIndex].classList.add('selected');
                document.getElementById('nextBtn').disabled = false;
            }
        }

        function selectOption(optionIndex) {
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            options[optionIndex].classList.add('selected');
            
            answers[currentQuestion] = {
                questionIndex: currentQuestion,
                optionIndex: optionIndex,
                points: questions[currentQuestion].options[optionIndex].points,
                text: questions[currentQuestion].options[optionIndex].text,
                timestamp: new Date().toISOString()
            };
            
            document.getElementById('nextBtn').disabled = false;
            
            // Track answer selection
            if (typeof gtag !== 'undefined') {
                gtag('event', 'question_answered', {
                    event_category: 'assessment',
                    question_number: currentQuestion + 1,
                    option_selected: optionIndex,
                    points_earned: questions[currentQuestion].options[optionIndex].points,
                    custom_parameters: {
                        question_text: questions[currentQuestion].question.substring(0, 100),
                        answer_text: questions[currentQuestion].options[optionIndex].text.substring(0, 100),
                        timestamp: new Date().toISOString()
                    }
                });
            }
        }

        function nextQuestion() {
            if (answers[currentQuestion]) {
                // Add loading state to button
                const nextBtn = document.getElementById('nextBtn');
                nextBtn.classList.add('loading');
                nextBtn.disabled = true;
                
                setTimeout(() => {
                    showQuestion(currentQuestion + 1);
                }, 300);
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        }

        function updateProgress() {
            const progress = (currentQuestion / questions.length) * 100;
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressFill.style.width = progress + '%';
            progressText.textContent = `Question ${currentQuestion} of ${questions.length}`;
            
            if (currentQuestion === questions.length) {
                progressText.textContent = 'Assessment Complete!';
            }
        }

        function calculateResults() {
            // Show loading
            document.getElementById('questionsContainer').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            
            // Calculate completion time
            const completionTime = Date.now() - startTime;
            
            setTimeout(() => {
                // Calculate total score
                const totalScore = answers.reduce((sum, answer) => sum + answer.points, 0);
                const maxScore = 320; // 8 questions × 40 max points each
                const percentageScore = Math.round((totalScore / maxScore) * 100);
                
                // 🚨 CORRECTED LOGIC: Determine category and risk level based on score
                let category, riskLevel, analysis, recommendations;
                
                if (totalScore >= 240) {
                    category = "Elite Trader";
                    riskLevel = "LOW";
                    analysis = "Exceptional psychological control and discipline. You demonstrate the emotional intelligence and risk management skills of professional traders. Your mental game is your competitive advantage.";
                    recommendations = [
                        "Continue your excellent discipline and mental frameworks",
                        "Consider mentoring other traders to reinforce your own skills",
                        "Focus on advanced optimization strategies and fine-tuning",
                        "Monitor for overconfidence bias as your primary risk factor",
                        "Explore advanced psychological concepts like flow states"
                    ];
                } else if (totalScore >= 160) {
                    category = "Disciplined Trader";
                    riskLevel = "MODERATE";
                    analysis = "Good foundational psychology with specific areas requiring focused improvement. You have solid discipline but may struggle during high-stress market periods or when facing significant losses.";
                    recommendations = [
                        "Strengthen emotional regulation techniques during volatility",
                        "Develop consistent pre-trade and post-trade routines",
                        "Practice stress management specifically during market drawdowns",
                        "Focus on maintaining discipline during winning streaks",
                        "Consider working with a trading psychology coach for refinement"
                    ];
                } else if (totalScore >= 80) {
                    category = "Developing Trader";
                    riskLevel = "HIGH";
                    analysis = "Significant emotional challenges that impact trading performance. You show some awareness but need focused psychology training before risking substantial capital. Your emotions are currently overriding logical decision-making.";
                    recommendations = [
                        "Implement strict risk management rules immediately",
                        "Practice extensively with paper trading before using real money",
                        "Develop emotional regulation techniques and stress management",
                        "Create and strictly follow a detailed trading plan",
                        "Consider working with a trading psychology professional"
                    ];
                } else {
                    category = "Vulnerable Trader";
                    riskLevel = "CRITICAL";
                    analysis = "Critical emotional vulnerabilities that pose severe risks to trading success. Your psychological patterns suggest high likelihood of significant losses. Professional psychology intervention is strongly recommended before trading with real money.";
                    recommendations = [
                        "STOP trading with real money immediately until psychology improves",
                        "Work with a qualified trading psychology professional",
                        "Focus on basic emotional regulation and mindfulness practices",
                        "Start with education and paper trading only",
                        "Address underlying emotional patterns before considering live trading"
                    ];
                }

                // Store assessment data
                assessmentData = {
                    totalScore: totalScore,
                    maxScore: maxScore,
                    percentageScore: percentageScore,
                    category: category,
                    riskLevel: riskLevel,
                    analysis: analysis,
                    recommendations: recommendations,
                    answers: answers,
                    completionTime: completionTime,
                    timestamp: new Date().toISOString(),
                    aiAnalysis: {
                        riskLevel: riskLevel,
                        confidenceScore: Math.min(95, Math.max(75, 75 + (totalScore / maxScore) * 20)),
                        emotionalVolatility: totalScore < 160 ? 'High' : totalScore < 240 ? 'Moderate' : 'Low',
                        recommendedActions: recommendations.length
                    }
                };

                // Save to database
                database.addAssessment(assessmentData);

                // Display results
                displayResults();
                
                // Hide loading
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').classList.remove('hidden');
                document.getElementById('results').classList.add('fade-in');
                
                // Track completion
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'assessment_completed_detailed', {
                        event_category: 'assessment',
                        event_label: category,
                        value: totalScore,
                        custom_parameters: {
                            score: totalScore,
                            percentage: percentageScore,
                            category: category,
                            risk_level: riskLevel,
                            completion_time_seconds: Math.round(completionTime / 1000),
                            timestamp: new Date().toISOString()
                        }
                    });
                }
                
                console.log('📊 Assessment completed:', assessmentData);
                
                // Show success message
                showMessage('Assessment completed successfully! Scroll down to see your extended analysis options.', 'success');
                
            }, 3000);
        }

        function displayResults() {
            // Animate score counting up
            animateScore(assessmentData.totalScore, assessmentData.maxScore);
            
            const categoryElement = document.getElementById('categoryDisplay');
            categoryElement.textContent = assessmentData.category;
            const categoryClass = assessmentData.category.toLowerCase().replace(/\s+/g, '');
            categoryElement.className = `category ${categoryClass}`;
            
            // Display risk level with appropriate styling
            const riskClass = assessmentData.riskLevel.toLowerCase().replace(/\s+/g, '');
            
            document.getElementById('aiAnalysis').innerHTML = `
                <p><strong>Risk Level:</strong> <span class="risk-level risk-${riskClass}">${assessmentData.riskLevel}</span></p>
                <p><strong>Overall Score:</strong> ${assessmentData.percentageScore}% - ${assessmentData.analysis}</p>
                <h4 style="margin-top: 20px; color: #4c51bf;">🎯 Your Personalized Recommendations:</h4>
                <ul style="margin-top: 15px;">
                    ${assessmentData.recommendations.map(rec => `<li style="margin-bottom: 8px;">${rec}</li>`).join('')}
                </ul>
                <div style="background: #f0f4f8; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #4c51bf;">
                    <p style="margin: 0; font-style: italic; color: #2d3748;">
                        <strong>AI Confidence Score:</strong> ${assessmentData.aiAnalysis.confidenceScore.toFixed(1)}% - 
                        Our AI analysis is ${assessmentData.aiAnalysis.confidenceScore >= 90 ? 'highly confident' : 
                        assessmentData.aiAnalysis.confidenceScore >= 80 ? 'confident' : 'moderately confident'} 
                        in these recommendations based on your response patterns.
                    </p>
                </div>
            `;
        }

        function animateScore(targetScore, maxScore) {
            const scoreElement = document.getElementById('scoreDisplay');
            let currentScore = 0;
            const increment = targetScore / 50; // 50 steps
            const timer = setInterval(() => {
                currentScore += increment;
                if (currentScore >= targetScore) {
                    currentScore = targetScore;
                    clearInterval(timer);
                }
                scoreElement.textContent = `${Math.round(currentScore)}/${maxScore}`;
            }, 40);
        }

        function getRiskColor(riskLevel) {
            switch(riskLevel) {
                case 'LOW': return '#2d5a2d';
                case 'MODERATE': return '#b8860b';
                case 'HIGH': return '#cd5c5c';
                case 'CRITICAL': return '#8b0000';
                default: return '#666';
            }
        }

        // Waitlist Functions
        function joinWaitlist() {
            const emailInput = document.getElementById('waitlistEmail');
            const email = emailInput.value.trim();
            
            if (!email || !isValidEmail(email)) {
                showMessage('Please enter a valid email address', 'error');
                emailInput.focus();
                return;
            }
            
            // Add loading state
            const button = document.querySelector('.btn-waitlist');
            const originalText = button.textContent;
            button.classList.add('loading');
            button.textContent = 'Adding to waitlist...';
            button.disabled = true;
            
            // Simulate API call delay
            setTimeout(() => {
                // Add to waitlist and email database
                database.addWaitlist(email);
                database.addEmail(email, 'waitlist');
                
                // Track waitlist signup
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'waitlist_signup', {
                        event_category: 'conversion',
                        event_label: 'extended_analysis_waitlist',
                        value: 1,
                        custom_parameters: {
                            email_domain: email.split('@')[1],
                            signup_source: 'assessment_results',
                            timestamp: new Date().toISOString()
                        }
                    });
                }
                
                // Success message and UI update
                showMessage('🎉 Thank you! You\'re on the waitlist and will be notified as soon as the Extended Analysis is available with special launch pricing!', 'success');
                
                // Update UI
                button.textContent = '✅ Added to Waitlist';
                button.style.background = 'linear-gradient(135deg, #38a169, #2f855a)';
                emailInput.value = '';
                emailInput.placeholder = 'You\'re on the list! 🎉';
                
                // Reset after 3 seconds
                setTimeout(() => {
                    button.classList.remove('loading');
                    button.textContent = originalText;
                    button.disabled = false;
                    button.style.background = '';
                    emailInput.placeholder = 'your@email.com';
                }, 3000);
                
                console.log('📧 Waitlist signup:', email);
            }, 1000);
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Enhanced PDF Generation with 8 pages and corrected logic
        function generateExtendedPDFReport(email, transactionId) {
            try {
                var jsPDF = window.jspdf.jsPDF;
                var doc = new jsPDF();
                
                // Get current assessment data
                var currentData = JSON.parse(JSON.stringify(assessmentData));
                var score = currentData.totalScore || 0;
                var category = currentData.category || 'Unknown';
                
                // 🚨 CORRECTED RISK LEVEL LOGIC
                var riskLevel, riskDescription, riskColor;
                if (score >= 240) {
                    riskLevel = "LOW";
                    riskDescription = "Excellent emotional control and risk awareness. Your psychology is well-suited for consistent trading performance. Continue monitoring and maintaining your disciplined approach.";
                    riskColor = "#2d5a2d"; // Green
                } else if (score >= 160) {
                    riskLevel = "MODERATE";
                    riskDescription = "Good foundational psychology with some areas for improvement. Focus on strengthening emotional discipline during high-stress periods.";
                    riskColor = "#b8860b"; // Yellow/Orange
                } else if (score >= 80) {
                    riskLevel = "HIGH";
                    riskDescription = "Significant emotional challenges that could impact trading performance. Immediate focus on psychology training needed before risking substantial capital.";
                    riskColor = "#cd5c5c"; // Red
                } else {
                    riskLevel = "CRITICAL";
                    riskDescription = "Severe emotional vulnerabilities detected. Trading psychology intervention strongly recommended before risking any capital.";
                    riskColor = "#8b0000"; // Dark Red
                }
                
                // 🚨 CORRECTED KEY FINDINGS LOGIC
                var keyFindings = [];
                if (score >= 240) {
                    keyFindings = [
                        "Exceptional psychological control demonstrated",
                        "Excellent risk awareness and discipline patterns",
                        "Focus on maintaining current excellence and optimization",
                        "Primary risk: potential overconfidence bias"
                    ];
                } else if (score >= 160) {
                    keyFindings = [
                        "Solid psychological foundation with improvement areas",
                        "Moderate emotional control with occasional lapses",
                        "Focus on strengthening discipline during stress periods",
                        "Good potential for psychology skill development"
                    ];
                } else if (score >= 80) {
                    keyFindings = [
                        "Significant negative emotional patterns detected",
                        "High emotional volatility concerns identified",
                        "Immediate psychology training strongly recommended",
                        "Focus on basic emotional regulation before live trading"
                    ];
                } else {
                    keyFindings = [
                        "Critical emotional vulnerabilities detected",
                        "Multiple high-risk psychological patterns identified",
                        "Professional psychology intervention urgently needed",
                        "Recommend stopping live trading until improvement"
                    ];
                }

                // PAGE 1: COVER PAGE
                doc.setFillColor(99, 102, 241);
                doc.rect(0, 0, 210, 297, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(32);
                doc.setFont(undefined, 'bold');
                doc.text('EXTENDED AI TRADING', 105, 80, { align: 'center' });
                doc.text('PSYCHOLOGY ANALYSIS', 105, 100, { align: 'center' });
                
                doc.setFontSize(16);
                doc.setFont(undefined, 'normal');
                doc.text('Professional Psychological Assessment Report', 105, 130, { align: 'center' });
                
                // Client info box
                doc.setFillColor(0, 0, 0, 0.8);
                doc.rect(20, 160, 170, 60, 'F');
                
                doc.setTextColor(99, 102, 241);
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('PREPARED FOR:', 30, 180);
                
                doc.setTextColor(255, 255, 255);
                doc.setFont(undefined, 'normal');
                doc.text(email, 30, 195);
                doc.text(`Assessment Score: ${score}/320 (${Math.round((score/320)*100)}%)`, 30, 210);
                doc.text(`Date: ${new Date().toLocaleDateString('de-DE')}`, 30, 225);
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(12);
                doc.text('Schnitzlein Consulting - Trading Psychology Experts', 105, 250, { align: 'center' });
                doc.text(`Transaction ID: ${transactionId}`, 105, 265, { align: 'center' });

                // PAGE 2: EXECUTIVE SUMMARY
                doc.addPage();
                doc.setFillColor(99, 102, 241);
                doc.rect(0, 0, 210, 40, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('EXECUTIVE SUMMARY', 105, 25, { align: 'center' });
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Overall Psychology Assessment', 20, 60);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                var summaryText = `Your trading psychology score of ${score}/320 (${Math.round((score/320)*100)}%) places you in the "${category}" category. `;
                
                if (score >= 240) {
                    summaryText += "This indicates exceptional emotional control and strong psychological foundations for successful trading. You demonstrate the mental discipline of professional traders. Continue monitoring and maintaining your excellent disciplined approach while watching for overconfidence bias.";
                } else if (score >= 160) {
                    summaryText += "This indicates good foundational psychology with specific areas requiring focused improvement to optimize your trading performance. You have solid discipline but may struggle during high-stress market periods.";
                } else if (score >= 80) {
                    summaryText += "This indicates significant emotional challenges that require immediate attention and focused psychology training before risking substantial capital. Your emotions are currently overriding logical decision-making.";
                } else {
                    summaryText += "This indicates critical emotional vulnerabilities that pose severe risks to trading success. Professional psychology intervention is strongly recommended before trading with any real money.";
                }
                
                var summaryLines = doc.splitTextToSize(summaryText, 170);
                doc.text(summaryLines, 20, 75);
                
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Risk Level Assessment', 20, 120);
                
                doc.setTextColor(riskColor);
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text(`Risk Level: ${riskLevel}`, 20, 140);
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                var riskLines = doc.splitTextToSize(riskDescription, 170);
                doc.text(riskLines, 20, 155);
                
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Key Findings', 20, 190);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                var yPos = 205;
                keyFindings.forEach(function(finding) {
                    doc.text(`• ${finding}`, 25, yPos);
                    yPos += 12;
                });

                // PAGE 3: DETAILED PATTERN ANALYSIS
                doc.addPage();
                doc.setFillColor(99, 102, 241);
                doc.rect(0, 0, 210, 40, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('DETAILED PATTERN ANALYSIS', 105, 25, { align: 'center' });
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('AI Confidence Scores & Pattern Recognition', 20, 60);
                
                // Generate pattern analysis based on score
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Emotional Control Pattern:', 20, 80);
                doc.setFont(undefined, 'normal');
                var emotionalScore = Math.max(20, Math.min(95, (score / 320) * 100 + (Math.random() * 10 - 5)));
                doc.text(`AI Confidence: ${emotionalScore.toFixed(1)}%`, 140, 80);
                
                var emotionalText = score >= 200 ? 
                    "Strong emotional regulation demonstrated across various market conditions. Maintains composure during volatility and shows excellent self-control. Patterns suggest professional-level emotional discipline." :
                    score >= 120 ?
                    "Moderate emotional control with occasional lapses during high-stress market periods. Shows good awareness but needs strengthening during extreme conditions. Room for significant improvement." :
                    "Significant emotional volatility detected. Strong tendency for fear and greed-based decision making. Emotional reactions often override logical analysis. Immediate intervention needed.";
                
                var emotionalLines = doc.splitTextToSize(emotionalText, 170);
                doc.text(emotionalLines, 20, 95);
                
                doc.setFont(undefined, 'bold');
                doc.text('Risk Assessment Pattern:', 20, 125);
                doc.setFont(undefined, 'normal');
                var riskScore = Math.max(25, Math.min(90, (score / 320) * 100 + (Math.random() * 8 - 4)));
                doc.text(`AI Confidence: ${riskScore.toFixed(1)}%`, 140, 125);
                
                var riskText = score >= 200 ?
                    "Excellent risk awareness and position sizing discipline. Understands correlation between risk and reward. Demonstrates systematic approach to risk management." :
                    score >= 120 ?
                    "Generally good risk management with occasional oversizing. Needs refinement in high-volatility environments. Understanding present but execution inconsistent." :
                    "Poor risk assessment capabilities. Tendency for excessive position sizes and inadequate stop-loss discipline. Risk management rules frequently abandoned under pressure.";
                
                var riskLines = doc.splitTextToSize(riskText, 170);
                doc.text(riskLines, 20, 140);
                
                doc.setFont(undefined, 'bold');
                doc.text('Decision Making Under Pressure:', 20, 170);
                doc.setFont(undefined, 'normal');
                var pressureScore = Math.max(15, Math.min(88, (score / 320) * 100 + (Math.random() * 12 - 6)));
                doc.text(`AI Confidence: ${pressureScore.toFixed(1)}%`, 140, 170);
                
                var pressureText = score >= 200 ?
                    "Maintains clear thinking under market pressure. Able to execute plans despite external volatility. Shows exceptional mental toughness and consistency." :
                    score >= 120 ?
                    "Moderate performance under pressure with some decision paralysis during extreme market moves. Good foundation but needs stress management improvement." :
                    "Significant deterioration in decision quality under pressure. Prone to panic buying/selling and abandoning strategy. High stress leads to poor choices.";
                
                var pressureLines = doc.splitTextToSize(pressureText, 170);
                doc.text(pressureLines, 20, 185);
                
                doc.setFont(undefined, 'bold');
                doc.text('FOMO & Social Influence Resistance:', 20, 215);
                doc.setFont(undefined, 'normal');
                var fomoScore = Math.max(10, Math.min(92, (score / 320) * 100 + (Math.random() * 15 - 7)));
                doc.text(`AI Confidence: ${fomoScore.toFixed(1)}%`, 140, 215);
                
                var fomoText = score >= 200 ?
                    "Strong resistance to FOMO and social trading pressures. Maintains independent decision-making and sticks to personal strategy regardless of external noise." :
                    score >= 120 ?
                    "Moderate susceptibility to FOMO and social influence. Generally maintains discipline but occasionally affected by market hype and peer pressure." :
                    "High susceptibility to FOMO and social trading pressures. Frequently abandons strategy based on others' gains or market sentiment. Needs independence training.";
                
                var fomoLines = doc.splitTextToSize(fomoText, 170);
                doc.text(fomoLines, 20, 230);

                // PAGE 4: PSYCHOLOGY RISK ASSESSMENT
                doc.addPage();
                doc.setFillColor(99, 102, 241);
                doc.rect(0, 0, 210, 40, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('PSYCHOLOGY RISK ASSESSMENT', 105, 25, { align: 'center' });
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Risk Category Breakdown', 20, 60);
                
                // Risk categories with scores based on overall assessment
                var categories = [
                    { 
                        name: 'Emotional Volatility', 
                        score: score >= 240 ? Math.random() * 15 + 10 : score >= 160 ? Math.random() * 25 + 30 : score >= 80 ? Math.random() * 30 + 50 : Math.random() * 25 + 70,
                        description: 'Tendency for emotional swings affecting trading decisions'
                    },
                    { 
                        name: 'FOMO Susceptibility', 
                        score: score >= 240 ? Math.random() * 20 + 15 : score >= 160 ? Math.random() * 30 + 35 : score >= 80 ? Math.random() * 25 + 60 : Math.random() * 20 + 75,
                        description: 'Fear of missing out driving impulsive trades'
                    },
                    { 
                        name: 'Loss Aversion', 
                        score: score >= 240 ? Math.random() * 15 + 20 : score >= 160 ? Math.random() * 25 + 40 : score >= 80 ? Math.random() * 30 + 55 : Math.random() * 20 + 80,
                        description: 'Inability to cut losses and take necessary exits'
                    },
                    { 
                        name: 'Overconfidence Bias', 
                        score: score >= 240 ? Math.random() * 20 + 15 : score >= 160 ? Math.random() * 25 + 35 : score >= 80 ? Math.random() * 30 + 45 : Math.random() * 25 + 60,
                        description: 'Excessive confidence leading to oversized positions'
                    },
                    { 
                        name: 'Revenge Trading Risk', 
                        score: score >= 240 ? Math.random() * 15 + 10 : score >= 160 ? Math.random() * 20 + 30 : score >= 80 ? Math.random() * 35 + 50 : Math.random() * 20 + 85,
                        description: 'Tendency to chase losses with bigger positions'
                    }
                ];
                
                doc.setFontSize(12);
                var yPos = 80;
                categories.forEach(function(cat) {
                    var roundedScore = Math.round(cat.score);
                    
                    doc.setFont(undefined, 'bold');
                    doc.text(cat.name + ':', 20, yPos);
                    doc.setFont(undefined, 'normal');
                    
                    // Color based on risk level
                    if (roundedScore <= 30) doc.setTextColor(45, 90, 45); // Green
                    else if (roundedScore <= 60) doc.setTextColor(184, 134, 11); // Yellow
                    else doc.setTextColor(205, 92, 92); // Red
                    
                    doc.text(roundedScore + '%', 140, yPos);
                    doc.setTextColor(0, 0, 0);
                    
                    // Risk bar visualization
                    doc.setFillColor(220, 220, 220);
                    doc.rect(20, yPos + 3, 100, 4, 'F');
                    
                    if (roundedScore <= 30) doc.setFillColor(45, 90, 45);
                    else if (roundedScore <= 60) doc.setFillColor(184, 134, 11);
                    else doc.setFillColor(205, 92, 92);
                    
                    doc.rect(20, yPos + 3, (roundedScore / 100) * 100, 4, 'F');
                    
                    // Description
                    doc.setTextColor(100, 100, 100);
                    doc.setFontSize(9);
                    doc.text(cat.description, 25, yPos + 12);
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(12);
                    
                    yPos += 30;
                });

                // PAGE 5: 30/60/90 DAY ROADMAP
                doc.addPage();
                doc.setFillColor(99, 102, 241);
                doc.rect(0, 0, 210, 40, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('30/60/90 DAY IMPROVEMENT ROADMAP', 105, 25, { align: 'center' });
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Phase 1: Days 1-30 (Foundation Building)', 20, 60);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                var phase1Text = score >= 200 ?
                    "Focus on maintaining and optimizing your current psychological strengths:\n\n• Daily mindfulness practice (10-15 minutes) to maintain mental clarity\n• Weekly psychology journal review to monitor for any degradation\n• Maintain current risk management protocols and discipline\n• Monitor specifically for overconfidence bias patterns\n• Begin advanced visualization techniques for complex scenarios\n• Track correlation between emotional state and performance" :
                    score >= 120 ?
                    "Build stronger foundational psychology discipline:\n\n• Start daily emotion tracking before and after trades (mood, stress level 1-10)\n• Implement comprehensive pre-market psychology checklist\n• Practice position sizing calculations until they become automatic\n• Begin stress management techniques (breathing exercises, meditation)\n• Create and test personal trading rules under various market conditions\n• Establish mandatory cooling-off periods after losses" :
                    "Immediate psychology intervention and foundation building:\n\n• STOP trading with real money - use paper trading only\n• Complete psychology assessment with qualified professional\n• Implement mandatory cooling-off periods between any trading decisions\n• Reduce any future position sizes by 75% during training phase\n• Daily meditation and stress reduction exercises (20+ minutes)\n• Begin basic emotional regulation training and awareness exercises";
                
                var phase1Lines = doc.splitTextToSize(phase1Text, 170);
                doc.text(phase1Lines, 20, 75);
                
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Phase 2: Days 31-60 (Skill Development)', 20, 155);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                var phase2Text = score >= 200 ?
                    "Advanced optimization and skill refinement:\n\n• Implement advanced risk management strategies and position sizing optimization\n• Develop market-specific psychology protocols for different volatility environments\n• Track detailed correlation between emotions and performance metrics\n• Begin mentoring other traders to reinforce your own psychological discipline\n• Explore advanced concepts like flow states and peak performance psychology\n• Fine-tune your trading psychology system for maximum efficiency" :
                    score >= 120 ?
                    "Strengthen weak areas and build consistency:\n\n• Increase trade journaling detail with specific emotion and decision analysis\n• Practice visualization exercises for difficult scenarios (drawdowns, volatility)\n• Implement systematic review process for all emotional trading decisions\n• Develop and test comprehensive personal trading psychology rules\n• Begin working with trading psychology coach for personalized guidance\n• Practice stress management specifically during high-volatility periods" :
                    "Intensive psychology training and habit formation:\n\n• Continue working with qualified trading psychology professional\n• Implement mandatory pre-trade emotional check-ins and clearance protocols\n• Practice extensive simulated trading with primary focus on psychology\n• Build systematic emotional regulation protocols for various market scenarios\n• Develop personal emergency stop protocols for emotional overwhelm\n• Begin gradual exposure to small-scale live trading with strict oversight";
                
                var phase2Lines = doc.splitTextToSize(phase2Text, 170);
                doc.text(phase2Lines, 20, 170);
                
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Phase 3: Days 61-90 (Integration & Mastery)', 20, 245);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                var phase3Text = score >= 200 ?
                    "Maintain excellence and explore advanced concepts:\n\n• Develop psychology-based trading edge identification systems\n• Create systematic approach to reading and leveraging market psychology\n• Build long-term psychology maintenance and monitoring protocols\n• Consider advanced trading psychology certification or training others" :
                    score >= 120 ?
                    "Integration and consistency building:\n\n• Full integration of psychology tools into complete trading routine\n• Advanced scenario planning and emotional preparation for various market conditions\n• Systematic performance analysis including detailed psychology metrics and correlation analysis" :
                    "Gradual return to live trading with strict psychology protocols:\n\n• Very slow, monitored increase in position sizes with continuous psychology assessment\n• Implementation of comprehensive fail-safe mechanisms and emergency protocols\n• Ongoing professional psychology support and regular check-ins";
                
                var phase3Lines = doc.splitTextToSize(phase3Text, 170);
                doc.text(phase3Lines, 20, 260);

                // PAGE 6: SPECIFIC RECOMMENDATIONS
                doc.addPage();
                doc.setFillColor(99, 102, 241);
                doc.rect(0, 0, 210, 40, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('SPECIFIC RECOMMENDATIONS', 105, 25, { align: 'center' });
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Immediate Action Items', 20, 60);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                
                var recommendations = [];
                if (score >= 200) {
                    recommendations = [
                        "Continue current disciplined approach - you're in the top 20% of traders psychologically",
                        "Implement weekly psychology maintenance routines to prevent any degradation over time",
                        "Consider becoming a mentor to help other traders while reinforcing your own discipline",
                        "Focus on advanced risk management strategies and position sizing optimization",
                        "Monitor specifically for overconfidence bias as your primary remaining risk factor",
                        "Explore advanced psychology concepts like flow states and peak performance optimization"
                    ];
                } else if (score >= 120) {
                    recommendations = [
                        "Implement comprehensive daily pre-market psychology checklist and detailed post-market review",
                        "Focus specifically on emotion regulation techniques during high-volatility market periods",
                        "Practice position sizing calculations repeatedly until they become completely automatic",
                        "Develop and thoroughly test your personal trading rules under various market conditions",
                        "Consider working with a qualified trading psychology coach for 3-5 personalized sessions",
                        "Create specific stress management protocols for different types of market stress"
                    ];
                } else {
                    recommendations = [
                        "IMMEDIATELY STOP trading with real money until psychology training is substantially complete",
                        "Work with a qualified trading psychology professional - this is not optional for your success",
                        "Begin exclusively with paper trading while implementing comprehensive psychology protocols",
                        "Implement mandatory cooling-off periods between any trading decisions (minimum 30 minutes)",
                        "Reduce any future position sizes to 20% of current levels when psychology improves sufficiently",
                        "Address underlying emotional patterns through professional therapy if needed"
                    ];
                }
                
                var yPos = 75;
                recommendations.forEach(function(rec, index) {
                    doc.setFont(undefined, 'bold');
                    doc.text(`${index + 1}.`, 20, yPos);
                    doc.setFont(undefined, 'normal');
                    var recLines = doc.splitTextToSize(rec, 165);
                    doc.text(recLines, 30, yPos);
                    yPos += recLines.length * 6 + 8;
                });
                
                // Additional personalized recommendations based on specific weaknesses
                if (yPos < 200) {
                    doc.setFontSize(16);
                    doc.setFont(undefined, 'bold');
                    doc.text('Pattern-Specific Recommendations', 20, yPos + 10);
                    
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'normal');
                    yPos += 25;
                    
                    // Analyze answers for specific patterns
                    var specificRecs = [];
                    if (answers.some(a => a.optionIndex === 0)) { // High risk answers
                        specificRecs.push("Your responses indicate impulsive decision-making patterns. Practice the '5-minute rule' before any trade entry.");
                    }
                    if (answers.filter(a => a.optionIndex <= 1).length >= 3) { // Multiple high-risk answers
                        specificRecs.push("Multiple responses suggest emotional trading. Implement mandatory emotion check-ins before every trade.");
                    }
                    
                    specificRecs.forEach(function(rec) {
                        doc.text(`• ${rec}`, 25, yPos);
                        var recLines = doc.splitTextToSize(rec, 160);
                        yPos += recLines.length * 6 + 5;
                    });
                }

                // PAGE 7: RESOURCES & TOOLS  
                doc.addPage();
                doc.setFillColor(99, 102, 241);
                doc.rect(0, 0, 210, 40, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('RESOURCES & TOOLS', 105, 25, { align: 'center' });
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Recommended Books', 20, 60);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                var books = [
                    "• \"Trading in the Zone\" by Mark Douglas - Essential psychology fundamentals for all traders",
                    "• \"The Psychology of Trading\" by Brett Steenbarger - Advanced concepts and professional insights",
                    "• \"Market Wizards\" by Jack Schwager - Real trader psychology insights and mental frameworks",
                    "• \"Thinking, Fast and Slow\" by Daniel Kahneman - Understanding cognitive biases affecting decisions",
                    "• \"Mindset\" by Carol Dweck - Growth mindset principles for continuous improvement"
                ];
                
                var yPos = 75;
                books.forEach(function(book) {
                    var bookLines = doc.splitTextToSize(book, 170);
                    doc.text(bookLines, 20, yPos);
                    yPos += bookLines.length * 6 + 5;
                });
                
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Recommended Apps & Tools', 20, 140);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                var tools = [
                    "• Headspace or Calm - Daily mindfulness and meditation for emotional regulation",
                    "• Trading Journal Spreadsheet - For systematic trade and emotion tracking",
                    "• TradingView alerts - To reduce chart watching and emotional decision making",
                    "• Position Size Calculator - To automate risk management calculations",
                    "• Mood tracking apps - To correlate emotional state with trading performance"
                ];
                
                yPos = 155;
                tools.forEach(function(tool) {
                    var toolLines = doc.splitTextToSize(tool, 170);
                    doc.text(toolLines, 20, yPos);
                    yPos += toolLines.length * 6 + 5;
                });
                
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Emergency Protocols', 20, 210);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                var emergency = [
                    "• If you feel strong FOMO: Step away from charts for minimum 30 minutes, do breathing exercises",
                    "• After 2 consecutive losses: Mandatory stop trading for the day, analyze emotions in journal",
                    "• If considering revenge trade: Call your trading buddy or mentor first, never trade alone",
                    "• During high volatility: Automatically reduce position sizes by 50%, increase stop losses",
                    "• If emotional overwhelm: Use 4-7-8 breathing technique, pause all trading activities"
                ];
                
                yPos = 225;
                emergency.forEach(function(protocol) {
                    var protocolLines = doc.splitTextToSize(protocol, 170);
                    doc.text(protocolLines, 20, yPos);
                    yPos += protocolLines.length * 6 + 5;
                });

                // PAGE 8: NEXT STEPS & SUPPORT
                doc.addPage();
                doc.setFillColor(99, 102, 241);
                doc.rect(0, 0, 210, 40, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('NEXT STEPS & SUPPORT', 105, 25, { align: 'center' });
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Your Personalized Action Plan', 20, 60);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                var actionPlan = score >= 200 ?
                    "Congratulations! You have exceptional trading psychology foundations that place you in the elite category. Your next steps:\n\n1. Implement weekly psychology maintenance routines to prevent any degradation\n2. Focus on advanced risk management optimization and position sizing strategies\n3. Consider mentoring others to reinforce your discipline\n4. Monitor for overconfidence as your primary risk\n5. Continue with current trading approach while exploring advanced concepts" :
                    score >= 120 ?
                    "You have good foundations but need focused improvement. Your next steps:\n\n1. Start daily emotion tracking immediately\n2. Implement pre-market psychology checklist\n3. Focus on stress management during volatility\n4. Consider 1-2 sessions with trading psychology professional\n5. Gradually implement advanced psychology tools" :
                    "Critical psychology intervention needed. Your immediate next steps:\n\n1. STOP trading with real money immediately\n2. Work with trading psychology professional\n3. Begin paper trading with psychology focus\n4. Implement daily emotion regulation practices\n5. Reduce future position sizes by 80% when ready";
                
                var actionLines = doc.splitTextToSize(actionPlan, 170);
                doc.text(actionLines, 20, 75);
                
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Ongoing Support Options', 20, 160);
                
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                var support = [
                    "• Weekly Psychology Check-ins: Email updates on your progress and accountability",
                    "• Monthly Assessment Retakes: Track improvement over time with detailed progress reports", 
                    "• 1:1 Trading Psychology Coaching: Personalized professional support and guidance",
                    "• Group Psychology Workshops: Learn with other traders in supportive environment",
                    "• Emergency Psychology Hotline: For crisis trading situations and immediate support"
                ];
                
                var yPos = 175;
                support.forEach(function(option) {
                    var optionLines = doc.splitTextToSize(option, 170);
                    doc.text(optionLines, 20, yPos);
                    yPos += optionLines.length * 6 + 8;
                });
                
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('Contact Information', 20, 240);
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                doc.text('For Support: hello@schnitzlein-consulting.com', 20, 255);
                doc.text('Website: www.schnitzlein-consulting.com', 20, 270);
                doc.text('Emergency Psychology Support: Available 24/7 for critical situations', 20, 285);

                // Track the purchase in our database
                if (database) {
                    database.data.purchases = database.data.purchases || [];
                    database.data.purchases.push({
                        email: email,
                        amount: 47,
                        product: 'Extended AI Analysis',
                        transactionId: transactionId,
                        timestamp: new Date().toISOString(),
                        score: score,
                        category: category,
                        riskLevel: riskLevel
                    });
                    database.save();
                }

                // Track in Google Analytics
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'purchase', {
                        transaction_id: transactionId,
                        value: 47,
                        currency: 'EUR',
                        items: [{
                            item_id: 'extended_analysis',
                            item_name: 'Extended AI Trading Psychology Analysis',
                            category: 'Digital Product',
                            quantity: 1,
                            price: 47
                        }]
                    });
                }

                // Save and download the PDF
                doc.save(`Extended_AI_Analysis_${email.replace('@', '_')}_${transactionId}.pdf`);
                
                return true;
                
            } catch (error) {
                console.error('PDF generation error:', error);
                alert('Error generating PDF: ' + error.message);
                return false;
            }
        }

        // Sharing Functions
        function shareAssessment() {
            if (navigator.share) {
                navigator.share({
                    title: 'AI Trading Psychology Assessment',
                    text: 'I just took this free AI-powered trading psychology assessment. You should try it too!',
                    url: window.location.href
                }).catch(err => {
                    console.log('Error sharing:', err);
                    fallbackShare();
                });
            } else {
                fallbackShare();
            }
        }

        function fallbackShare() {
            const url = window.location.href;
            const text = `Check out this free AI Trading Psychology Assessment: ${url}`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showMessage('Assessment link copied to clipboard!', 'success');
                }).catch(() => {
                    promptForManualCopy(text);
                });
            } else {
                promptForManualCopy(text);
            }
        }

        function promptForManualCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            showMessage('Assessment link copied to clipboard!', 'success');
        }

        // Admin Panel Functions
        function showAdminPanel() {
            document.getElementById('questionsContainer').style.display = 'none';
            document.getElementById('adminPanel').classList.remove('hidden');
            loadAdminData();
        }

        function loadAdminData() {
            console.log('🔍 Loading admin data...');
            var stats = database.getStats();
            var assessments = database.data.assessments || [];
            var emails = database.data.emails || [];
            var waitlist = database.data.waitlist || [];
            var purchases = database.data.purchases || [];
            
            // Load from cookies as backup
            try {
                const cookieData = database.getCookie('tradingPsychologyData');
                if (cookieData) {
                    const parsed = JSON.parse(cookieData);
                    assessments = [...assessments, ...(parsed.assessments || [])];
                    emails = [...emails, ...(parsed.emails || [])];
                    waitlist = [...waitlist, ...(parsed.waitlist || [])];
                    purchases = [...purchases, ...(parsed.purchases || [])];
                }
            } catch (error) {
                console.warn('Cookie data load error:', error);
            }
            
            console.log('📊 Admin data loaded:', { 
                assessments: assessments.length, 
                emails: emails.length, 
                waitlist: waitlist.length, 
                purchases: purchases.length 
            });
            
            var html = `
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="stat-value">${formatNumber(assessments.length)}</div>
                        <div class="stat-label">Total Assessments</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${formatNumber(emails.length + waitlist.length)}</div>
                        <div class="stat-label">Total Email Leads</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${formatNumber(waitlist.length)}</div>
                        <div class="stat-label">Waitlist Signups</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${formatCurrency(stats.totalRevenue)}</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${formatNumber(purchases.length)}</div>
                        <div class="stat-label">Total Purchases</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${assessments.length > 0 ? Math.round((emails.length + waitlist.length) / assessments.length * 100) : 0}%</div>
                        <div class="stat-label">Email Conversion Rate</div>
                    </div>
                </div>
                
                <h3>📧 Recent Email Leads</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Source</th>
                            <th>Date</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            var allEmails = [...emails, ...waitlist.map(w => ({...w, source: 'waitlist'}))];
            allEmails.slice(-15).reverse().forEach(function(emailEntry) {
                var date = emailEntry.timestamp ? new Date(emailEntry.timestamp) : new Date();
                var dateStr = date.toLocaleDateString('de-DE');
                var timeStr = date.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
                html += `
                    <tr>
                        <td>${emailEntry.email}</td>
                        <td>${emailEntry.source || 'waitlist'}</td>
                        <td>${dateStr}</td>
                        <td>${timeStr}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            
            if (assessments.length > 0) {
                html += `
                    <h3>📊 Recent Assessments</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Score</th>
                                <th>Percentage</th>
                                <th>Category</th>
                                <th>Risk Level</th>
                                <th>Date</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                assessments.slice(-15).reverse().forEach(function(assessment) {
                    var date = assessment.timestamp ? new Date(assessment.timestamp) : new Date();
                    var dateStr = date.toLocaleDateString('de-DE');
                    var timeStr = date.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
                    var percentage = assessment.percentageScore || Math.round((assessment.totalScore || 0) / (assessment.maxScore || 320) * 100);
                    html += `
                        <tr>
                            <td>${assessment.totalScore || 0}/${assessment.maxScore || 320}</td>
                            <td>${percentage}%</td>
                            <td>${assessment.category || 'Unknown'}</td>
                            <td style="color: ${getRiskColor(assessment.riskLevel)}">${assessment.riskLevel || 'N/A'}</td>
                            <td>${dateStr}</td>
                            <td>${timeStr}</td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
            }
            
            if (purchases.length > 0) {
                html += `
                    <h3>💰 Recent Purchases</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Product</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Transaction ID</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                purchases.slice(-10).reverse().forEach(function(purchase) {
                    var date = purchase.timestamp ? new Date(purchase.timestamp) : new Date();
                    var dateStr = date.toLocaleDateString('de-DE');
                    html += `
                        <tr>
                            <td>${purchase.email}</td>
                            <td>${purchase.product}</td>
                            <td>${formatCurrency(purchase.amount)}</td>
                            <td>${dateStr}</td>
                            <td>${purchase.transactionId}</td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
            }

            // Add analytics summary
            if (assessments.length > 0) {
                var avgScore = assessments.reduce((sum, a) => sum + (a.totalScore || 0), 0) / assessments.length;
                var riskDistribution = assessments.reduce((dist, a) => {
                    var risk = a.riskLevel || 'Unknown';
                    dist[risk] = (dist[risk] || 0) + 1;
                    return dist;
                }, {});

                html += `
                    <h3>📈 Analytics Summary</h3>
                    <div class="stat-grid">
                        <div class="stat-card">
                            <div class="stat-value">${avgScore.toFixed(1)}</div>
                            <div class="stat-label">Average Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${(avgScore/320*100).toFixed(1)}%</div>
                            <div class="stat-label">Average Percentage</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${riskDistribution.CRITICAL || 0}</div>
                            <div class="stat-label">Critical Risk Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${riskDistribution.LOW || 0}</div>
                            <div class="stat-label">Low Risk Users</div>
                        </div>
                    </div>
                `;
            }

            // Add debug section
            html += `
                <h3>🔧 Debug Information</h3>
                <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.8em;">
                    <p>Cookie Data Available: ${database.getCookie('tradingPsychologyData') ? 'Yes' : 'No'}</p>
                    <p>Database Initialized: ${database.data ? 'Yes' : 'No'}</p>
                    <p>Current Timestamp: ${new Date().toISOString()}</p>
                    <p>Page Load Time: ${Math.round((Date.now() - startTime) / 1000)}s ago</p>
                </div>
            `;
            
            document.getElementById('adminStats').innerHTML = html;
        }

        // Test Functions
        function testPDFGeneration() {
            if (!assessmentData.totalScore) {
                showMessage('Please complete an assessment first before testing PDF generation.', 'error');
                return;
            }
            
            console.log('🧪 Testing PDF generation...');
            const testResult = generateExtendedPDFReport('test@example.com', 'TEST-' + Date.now());
            
            if (testResult) {
                showMessage('PDF test completed successfully!', 'success');
            } else {
                showMessage('PDF test failed. Check console for errors.', 'error');
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Admin panel shortcut
            if (event.ctrlKey && event.shiftKey && event.key === 'A') {
                event.preventDefault();
                showAdminPanel();
            }
            
            // Quick test shortcut
            if (event.ctrlKey && event.shiftKey && event.key === 'T') {
                event.preventDefault();
                testPDFGeneration();
            }
        });

        // Performance monitoring
        window.addEventListener('load', function() {
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_load_complete', {
                    event_category: 'performance',
                    value: Math.round(performance.now()),
                    custom_parameters: {
                        load_time_ms: Math.round(performance.now()),
                        timestamp: new Date().toISOString()
                    }
                });
            }
        });

        // Error handling
        window.addEventListener('error', function(event) {
            console.error('Global error caught:', event.error);
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'javascript_error', {
                    event_category: 'error',
                    event_label: event.error.message,
                    custom_parameters: {
                        error_message: event.error.message,
                        error_stack: event.error.stack,
                        timestamp: new Date().toISOString()
                    }
                });
            }
            
            showMessage('An unexpected error occurred. Please refresh the page and try again.', 'error');
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📄 DOM Content Loaded');
            initializeAssessment();
        });

        // Window load backup
        window.addEventListener('load', function() {
            console.log('🪟 Window Loaded');
            // Backup initialization in case DOMContentLoaded didn't fire
            if (!currentQuestion && document.getElementById('questionsContainer').innerHTML === '') {
                initializeAssessment();
            }
        });

        // Make functions globally available for onclick handlers
        window.selectOption = selectOption;
        window.nextQuestion = nextQuestion;
        window.previousQuestion = previousQuestion;
        window.joinWaitlist = joinWaitlist;
        window.shareAssessment = shareAssessment;
        window.testPDFGeneration = testPDFGeneration;
        window.showAdminPanel = showAdminPanel;
        window.loadAdminData = loadAdminData;
        window.generateExtendedPDFReport = generateExtendedPDFReport;

        // Add console shortcuts for development
        window.debugInfo = function() {
            console.log('🔍 Debug Information:');
            console.log('Current Question:', currentQuestion);
            console.log('Answers:', answers);
            console.log('Assessment Data:', assessmentData);
            console.log('Database:', database.data);
            console.log('Database Stats:', database.getStats());
        };

        window.clearData = function() {
            if (confirm('Are you sure you want to clear all stored data? This cannot be undone.')) {
                database.data = {
                    assessments: [],
                    emails: [],
                    waitlist: [],
                    purchases: []
                };
                database.save();
                document.cookie = 'tradingPsychologyData=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                console.log('✅ All data cleared');
                showMessage('All data has been cleared.', 'success');
            }
        };

        console.log('✅ Trading Psychology Assessment loaded successfully');
        console.log('🎯 Available functions: debugInfo(), clearData(), testPDFGeneration()');
        console.log('⌨️  Shortcuts: Ctrl+Shift+A (Admin), Ctrl+Shift+T (Test PDF)');
    </script>
</body>
</html>
