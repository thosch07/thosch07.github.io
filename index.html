<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Psychology Assessment | Discover Your Emotional Trading Weaknesses</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7ZVV3LY8MS"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-7ZVV3LY8MS');
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 100%;
            padding: 40px;
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            line-height: 1.2;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .intro-stats {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .intro-stats h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .intro-stats p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .question-container {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .question-container.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .progress-bar {
            background: #ecf0f1;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .question {
            margin-bottom: 30px;
        }
        
        .question h3 {
            color: #2c3e50;
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .option:hover {
            background: #e3f2fd;
            border-color: #2196f3;
            transform: translateY(-2px);
        }
        
        .option.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .results {
            display: none;
            text-align: center;
            animation: fadeIn 0.5s ease-in;
        }
        
        .results.active {
            display: block;
        }
        
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: 700;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .score-interpretation {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            text-align: left;
        }
        
        .score-interpretation h4 {
            color: #2c3e50;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .recommendations {
            list-style: none;
            padding: 0;
        }
        
        .recommendations li {
            background: white;
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            font-size: 14px;
        }
        
        .email-capture {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
        }
        
        .email-capture h4 {
            font-size: 20px;
            margin-bottom: 15px;
        }
        
        .email-form {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .email-input {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .email-btn {
            background: white;
            color: #f5576c;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .email-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .intro {
            display: block;
            text-align: center;
        }
        
        .start-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }
        
        .pdf-download {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 10px;
            display: inline-block;
        }
        
        .pdf-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(39, 174, 96, 0.3);
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .email-form {
                flex-direction: column;
            }
            
            .pdf-download {
                display: block;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">🧠</div>
            <h1>Trading Psychology Assessment</h1>
            <p class="subtitle">Discover your emotional trading weaknesses in just 5 minutes</p>
        </div>
        
        <div class="intro">
            <div class="intro-stats">
                <h3>🎯 Based on 10+ Years of Market Expertise</h3>
                <p>Professional analysis of your emotional trading patterns</p>
            </div>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 30px; text-align: left;">
                <h4 style="color: #2c3e50; margin-bottom: 15px;">You'll discover:</h4>
                <ul style="color: #6c757d; line-height: 1.6;">
                    <li>✅ Your emotional risk profile (1-100 points)</li>
                    <li>✅ Your biggest psychological weaknesses</li>
                    <li>✅ Concrete solution recommendations</li>
                    <li>✅ Personalized PDF report with action plan</li>
                </ul>
            </div>
            
            <button class="start-btn" onclick="startAssessment()">Start Assessment Now</button>
        </div>
        
        <div class="progress-bar" style="display: none;">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        
        <div class="question-container" id="question1">
            <div class="question">
                <h3>1. How do you react to an unexpected 5% loss in your portfolio?</h3>
                <div class="options">
                    <div class="option" onclick="selectAnswer(1, 1, this)">I sell everything immediately to prevent further losses</div>
                    <div class="option" onclick="selectAnswer(1, 2, this)">I get nervous but stick to my plan</div>
                    <div class="option" onclick="selectAnswer(1, 3, this)">I analyze the situation objectively and act accordingly</div>
                    <div class="option" onclick="selectAnswer(1, 4, this)">I buy more, seeing the dip as an opportunity</div>
                </div>
            </div>
        </div>
        
        <div class="question-container" id="question2">
            <div class="question">
                <h3>2. You see a stock that has risen 20%. What do you think?</h3>
                <div class="options">
                    <div class="option" onclick="selectAnswer(2, 1, this)">"I missed a huge opportunity!"</div>
                    <div class="option" onclick="selectAnswer(2, 2, this)">"Too bad, but there are other opportunities"</div>
                    <div class="option" onclick="selectAnswer(2, 3, this)">"I'll analyze if there's still potential"</div>
                    <div class="option" onclick="selectAnswer(2, 4, this)">"That wasn't part of my strategy"</div>
                </div>
            </div>
        </div>
        
        <div class="question-container" id="question3">
            <div class="question">
                <h3>3. How often do you check your portfolio during a trading day?</h3>
                <div class="options">
                    <div class="option" onclick="selectAnswer(3, 1, this)">Constantly - every few minutes</div>
                    <div class="option" onclick="selectAnswer(3, 2, this)">Several times per hour</div>
                    <div class="option" onclick="selectAnswer(3, 3, this)">2-3 times daily at fixed times</div>
                    <div class="option" onclick="selectAnswer(3, 4, this)">Only once at the end of the day</div>
                </div>
            </div>
        </div>
        
        <div class="question-container" id="question4">
            <div class="question">
                <h3>4. After a series of losses...</h3>
                <div class="options">
                    <div class="option" onclick="selectAnswer(4, 1, this)">I increase my position sizes to recover losses</div>
                    <div class="option" onclick="selectAnswer(4, 2, this)">I trade more emotionally and impulsively</div>
                    <div class="option" onclick="selectAnswer(4, 3, this)">I take a break and analyze my strategy</div>
                    <div class="option" onclick="selectAnswer(4, 4, this)">I temporarily reduce my position sizes</div>
                </div>
            </div>
        </div>
        
        <div class="question-container" id="question5">
            <div class="question">
                <h3>5. Your biggest enemy when trading is...</h3>
                <div class="options">
                    <div class="option" onclick="selectAnswer(5, 1, this)">FOMO (Fear of Missing Out)</div>
                    <div class="option" onclick="selectAnswer(5, 2, this)">Greed for quick profits</div>
                    <div class="option" onclick="selectAnswer(5, 3, this)">Fear of losses</div>
                    <div class="option" onclick="selectAnswer(5, 4, this)">Impatience with my strategy</div>
                </div>
            </div>
        </div>
        
        <div class="question-container" id="question6">
            <div class="question">
                <h3>6. How do you handle profits?</h3>
                <div class="options">
                    <div class="option" onclick="selectAnswer(6, 1, this)">I sell too early out of fear of losing the profit</div>
                    <div class="option" onclick="selectAnswer(6, 2, this)">I become overconfident and risk more</div>
                    <div class="option" onclick="selectAnswer(6, 3, this)">I follow my predefined exit plan</div>
                    <div class="option" onclick="selectAnswer(6, 4, this)">I let profits run and cut losses short</div>
                </div>
            </div>
        </div>
        
        <div class="question-container" id="question7">
            <div class="question">
                <h3>7. Social media and trading news influence my decisions...</h3>
                <div class="options">
                    <div class="option" onclick="selectAnswer(7, 1, this)">Very strongly - I often trade based on posts/news</div>
                    <div class="option" onclick="selectAnswer(7, 2, this)">Sometimes I let myself be influenced</div>
                    <div class="option" onclick="selectAnswer(7, 3, this)">Rarely - I use them as additional information</div>
                    <div class="option" onclick="selectAnswer(7, 4, this)">Never - I rely only on my analysis</div>
                </div>
            </div>
        </div>
        
        <div class="question-container" id="question8">
            <div class="question">
                <h3>8. Your risk management is based on...</h3>
                <div class="options">
                    <div class="option" onclick="selectAnswer(8, 1, this)">Gut feeling depending on market conditions</div>
                    <div class="option" onclick="selectAnswer(8, 2, this)">Rough guidelines that I sometimes follow</div>
                    <div class="option" onclick="selectAnswer(8, 3, this)">Clear rules that I usually follow</div>
                    <div class="option" onclick="selectAnswer(8, 4, this)">Strict mathematical formulas</div>
                </div>
            </div>
        </div>
        
        <div class="nav-buttons" style="display: none;">
            <button class="btn btn-secondary" onclick="previousQuestion()">Back</button>
            <button class="btn btn-primary" onclick="nextQuestion()" disabled id="nextBtn">Next</button>
        </div>
        
        <div class="results" id="results">
            <div class="score-circle" id="scoreCircle">0</div>
            <h2 id="scoreTitle">Your Trading Psychology Score</h2>
            <div class="score-interpretation" id="scoreInterpretation">
                <!-- Content will be filled by JavaScript -->
            </div>
            
            <div style="text-align: center; margin: 30px 0;">
                <button class="pdf-download" onclick="generatePersonalizedReport()">📄 Download Your Personalized Report</button>
            </div>
            
            <div class="email-capture">
                <h4>🎁 Want More Trading Psychology Tips?</h4>
                <p>Join our community for advanced strategies and insights</p>
                <div class="email-form">
                    <input type="email" class="email-input" placeholder="Your email address" id="emailInput">
                    <button class="email-btn" onclick="submitEmail()">Join Community</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentQuestion = 0;
        let answers = {};
        let userScore = 0;
        let userAnalysis = null;
        const totalQuestions = 8;
        
        function startAssessment() {
            // Track assessment start
            gtag('event', 'assessment_started', {
                'event_category': 'engagement',
                'event_label': 'trading_psychology_assessment'
            });
            
            document.querySelector('.intro').style.display = 'none';
            document.querySelector('.progress-bar').style.display = 'block';
            document.querySelector('.nav-buttons').style.display = 'flex';
            currentQuestion = 1;
            showQuestion(1);
            updateProgress();
        }
        
        function showQuestion(questionNum) {
            // Track question progression
            gtag('event', 'question_viewed', {
                'event_category': 'engagement',
                'event_label': `question_${questionNum}`,
                'value': questionNum
            });
            
            // Hide all questions
            document.querySelectorAll('.question-container').forEach(q => {
                q.classList.remove('active');
            });
            
            // Show current question
            document.getElementById(`question${questionNum}`).classList.add('active');
        }
        
        function selectAnswer(questionNum, answerValue, element) {
            // Track answer selection
            gtag('event', 'answer_selected', {
                'event_category': 'engagement',
                'event_label': `question_${questionNum}_answer_${answerValue}`,
                'value': answerValue
            });
            
            // Remove selection from other options
            element.parentElement.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Select this option
            element.classList.add('selected');
            
            // Store answer
            answers[questionNum] = answerValue;
            
            // Enable next button
            document.getElementById('nextBtn').disabled = false;
        }
        
        function nextQuestion() {
            if (currentQuestion < totalQuestions) {
                currentQuestion++;
                showQuestion(currentQuestion);
                updateProgress();
                document.getElementById('nextBtn').disabled = true;
                
                // Check if answer already exists for this question
                if (answers[currentQuestion]) {
                    document.getElementById('nextBtn').disabled = false;
                }
            } else {
                showResults();
            }
        }
        
        function previousQuestion() {
            if (currentQuestion > 1) {
                currentQuestion--;
                showQuestion(currentQuestion);
                updateProgress();
                document.getElementById('nextBtn').disabled = false;
            }
        }
        
        function updateProgress() {
            const progress = (currentQuestion / totalQuestions) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            
            // Update button text
            if (currentQuestion === totalQuestions) {
                document.getElementById('nextBtn').textContent = 'Show Results';
            } else {
                document.getElementById('nextBtn').textContent = 'Next';
            }
        }
        
        function calculateScore() {
            let totalScore = 0;
            
            // Scoring logic (higher score = better emotional control)
            for (let q = 1; q <= totalQuestions; q++) {
                const answer = answers[q];
                let questionScore = 0;
                
                switch(q) {
                    case 1: // Reaction to losses
                        questionScore = answer === 1 ? 2 : answer === 2 ? 6 : answer === 3 ? 10 : 8;
                        break;
                    case 2: // FOMO reactions
                        questionScore = answer === 1 ? 2 : answer === 2 ? 6 : answer === 3 ? 8 : 10;
                        break;
                    case 3: // Portfolio checking frequency
                        questionScore = answer === 1 ? 2 : answer === 2 ? 4 : answer === 3 ? 8 : 10;
                        break;
                    case 4: // After losses
                        questionScore = answer === 1 ? 1 : answer === 2 ? 3 : answer === 3 ? 9 : 10;
                        break;
                    case 5: // Biggest enemy
                        questionScore = answer === 1 ? 4 : answer === 2 ? 5 : answer === 3 ? 6 : 7;
                        break;
                    case 6: // Handling profits
                        questionScore = answer === 1 ? 4 : answer === 2 ? 3 : answer === 3 ? 9 : 10;
                        break;
                    case 7: // Social media influence
                        questionScore = answer === 1 ? 2 : answer === 2 ? 5 : answer === 3 ? 8 : 10;
                        break;
                    case 8: // Risk management
                        questionScore = answer === 1 ? 2 : answer === 2 ? 5 : answer === 3 ? 8 : 10;
                        break;
                }
                
                totalScore += questionScore;
            }
            
            return Math.round((totalScore / 80) * 100); // Convert to percentage
        }
        
        function getScoreInterpretation(score) {
            if (score >= 80) {
                return {
                    title: "🏆 Trading Discipline Champion (80-100 Points)",
                    description: "Impressive! You already have very good emotional control developed.",
                    recommendations: [
                        "Refine your strategies for even more consistent results",
                        "Share your knowledge with other traders",
                        "Focus on advanced risk management techniques",
                        "Work on optimizing your profit-taking strategies"
                    ],
                    color: "#27ae60"
                };
            } else if (score >= 60) {
                return {
                    title: "📈 Solid Trader with Potential (60-79 Points)",
                    description: "You're on the right track! With some adjustments, you'll become even more successful.",
                    recommendations: [
                        "Develop clearer rules for emotional situations",
                        "Implement a structured trading journal",
                        "Work on your discipline during losing streaks",
                        "Reduce the frequency of portfolio checks"
                    ],
                    color: "#f39c12"
                };
            } else if (score >= 40) {
                return {
                    title: "⚠️ Emotional Trader (40-59 Points)",
                    description: "Your emotions strongly influence your trading decisions. Time for changes!",
                    recommendations: [
                        "Create a detailed trading plan and stick to it",
                        "Implement strict stop-loss rules",
                        "Temporarily reduce your position sizes",
                        "Avoid social media during trading hours"
                    ],
                    color: "#e67e22"
                };
            } else {
                return {
                    title: "🚨 High Emotional Vulnerability (0-39 Points)",
                    description: "Your emotions control your trading. Immediate action required!",
                    recommendations: [
                        "Take a trading break and work on your psychology",
                        "Start with very small position sizes",
                        "Implement a strict risk management system",
                        "Seek professional support for trading psychology"
                    ],
                    color: "#e74c3c"
                };
            }
        }
        
        function getDetailedAnalysis(score) {
            if (score >= 80) {
                return {
                    title: "Trading Discipline Champion",
                    category: "🏆 Elite Trader (80-100 Points)",
                    description: "Exceptional emotional control and discipline",
                    strengths: ["Advanced Risk Management", "Emotional Stability", "Strategic Execution", "Consistent Performance"],
                    weaknesses: ["Over-Analysis Tendency", "Missing Opportunity Windows"],
                    emotionalControl: 9,
                    riskManagement: 9,
                    discipline: 9,
                    decisionMaking: 8,
                    recommendations: [
                        "Focus on opportunity optimization rather than risk avoidance",
                        "Share knowledge with other traders for additional income streams",
                        "Consider advanced strategies like options or forex",
                        "Develop systematic approach to capturing market inefficiencies"
                    ]
                };
            } else if (score >= 60) {
                return {
                    title: "Solid Trader with Potential",
                    category: "📈 Developing Trader (60-79 Points)",
                    description: "Good foundation with specific areas for improvement",
                    strengths: ["Loss Management", "Strategic Thinking", "Risk Awareness"],
                    weaknesses: ["Portfolio Checking Frequency", "Profit-Taking Timing", "Social Media Influence"],
                    emotionalControl: 7,
                    riskManagement: 6,
                    discipline: 7,
                    decisionMaking: 6,
                    recommendations: [
                        "Implement structured portfolio checking times (max 3x daily)",
                        "Create clear profit-taking rules based on technical levels",
                        "Limit social media exposure during trading hours",
                        "Develop written trading plan with specific entry/exit criteria"
                    ]
                };
            } else if (score >= 40) {
                return {
                    title: "Emotional Trader",
                    category: "⚠️ High Risk Pattern (40-59 Points)",
                    description: "Emotions significantly impact trading decisions",
                    strengths: ["Market Interest", "Learning Motivation"],
                    weaknesses: ["FOMO Trading", "Revenge Trading", "Poor Risk Management", "Emotional Decision Making"],
                    emotionalControl: 4,
                    riskManagement: 4,
                    discipline: 5,
                    decisionMaking: 4,
                    recommendations: [
                        "Reduce position sizes by 50% immediately",
                        "Implement mandatory cooling-off periods after losses",
                        "Create detailed trading journal to track emotional patterns",
                        "Set strict daily loss limits and walk away when hit"
                    ]
                };
            } else {
                return {
                    title: "High Emotional Vulnerability",
                    category: "🚨 Critical Risk Level (0-39 Points)",
                    description: "Immediate intervention required",
                    strengths: ["Willingness to Assess", "Potential for Growth"],
                    weaknesses: ["Panic Selling", "Overtrading", "No Risk Controls", "Emotional Volatility"],
                    emotionalControl: 2,
                    riskManagement: 2,
                    discipline: 3,
                    decisionMaking: 2,
                    recommendations: [
                        "STOP active trading until psychological issues addressed",
                        "Start with paper trading only for minimum 30 days",
                        "Seek professional trading psychology support",
                        "Begin with micro-positions when ready to return (max $100 risk per trade)"
                    ]
                };
            }
        }
        
        function showResults() {
            // Track assessment completion
            userScore = calculateScore();
            userAnalysis = getDetailedAnalysis(userScore);
            
            gtag('event', 'assessment_completed', {
                'event_category': 'engagement',
                'event_label': 'completed',
                'value': userScore
            });
            
            // Track score range
            let scoreRange = '';
            if (userScore >= 80) scoreRange = 'champion';
            else if (userScore >= 60) scoreRange = 'solid';
            else if (userScore >= 40) scoreRange = 'emotional';
            else scoreRange = 'vulnerable';
            
            gtag('event', 'score_achieved', {
                'event_category': 'assessment',
                'event_label': scoreRange,
                'value': userScore
            });
            
            // Hide questions and navigation
            document.querySelectorAll('.question-container').forEach(q => {
                q.classList.remove('active');
            });
            document.querySelector('.nav-buttons').style.display = 'none';
            document.querySelector('.progress-bar').style.display = 'none';
            
            const interpretation = getScoreInterpretation(userScore);
            
            document.getElementById('scoreCircle').textContent = userScore;
            document.getElementById('scoreCircle').style.background = interpretation.color;
            document.getElementById('scoreTitle').textContent = interpretation.title;
            
            const interpretationHtml = `
                <h4>${interpretation.title}</h4>
                <p style="margin-bottom: 20px; color: #6c757d;">${interpretation.description}</p>
                <h5 style="color: #2c3e50; margin-bottom: 15px;">🎯 Your Next Steps:</h5>
                <ul class="recommendations">
                    ${interpretation.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                </ul>
            `;
            
            document.getElementById('scoreInterpretation').innerHTML = interpretationHtml;
            document.getElementById('results').classList.add('active');
        }
        
        function generatePersonalizedReport() {
            // Check if email is provided first
            const email = document.getElementById('emailInput').value;
            if (!email || !email.includes('@')) {
                alert('Please enter your email address first to receive your personalized report!');
                document.getElementById('emailInput').focus();
                return;
            }
            
            // Track PDF download
            gtag('event', 'pdf_download', {
                'event_category': 'conversion',
                'event_label': 'report_download',
                'value': userScore
            });
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Get user info
            const userName = email.split('@')[0] || 'Trader';
            
            // Set up PDF styling
            const pageWidth = doc.internal.pageSize.width;
            const margin = 20;
            const maxWidth = pageWidth - (margin * 2);
            
            // Professional Header with gradient effect
            doc.setFillColor(102, 126, 234);
            doc.rect(0, 0, pageWidth, 45, 'F');
            
            // Add a subtle second color band
            doc.setFillColor(118, 75, 162);
            doc.rect(0, 35, pageWidth, 10, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(28);
            doc.setFont(undefined, 'bold');
            doc.text('Trading Psychology Report', pageWidth/2, 25, { align: 'center' });
            
            doc.setFontSize(16);
            doc.setFont(undefined, 'normal');
            doc.text(`Personal Analysis for ${userName}`, pageWidth/2, 37, { align: 'center' });
            
            // Reset text color
            doc.setTextColor(44, 62, 80);
            
            let yPosition = 70;
            
            // Score Section with better styling
            doc.setFillColor(248, 249, 250);
            doc.rect(margin, yPosition - 10, maxWidth, 35, 'F');
            
            doc.setFontSize(22);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(102, 126, 234);
            doc.text(`Your Score: ${userScore}/100`, margin + 10, yPosition + 5);
            
            yPosition += 20;
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(44, 62, 80);
            // Clean category text (remove emojis for PDF)
            const cleanCategory = userAnalysis.category.replace(/[🏆📈⚠️🚨]/g, '').trim();
            doc.text(cleanCategory, margin + 10, yPosition);
            
            yPosition += 15;
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(127, 140, 141);
            doc.text(userAnalysis.description, margin + 10, yPosition);
            
            yPosition += 35;
            
            // Performance Breakdown with visual bars
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(44, 62, 80);
            doc.text('Performance Breakdown', margin, yPosition);
            yPosition += 20;
            
            const metrics = [
                { name: 'Emotional Control', value: userAnalysis.emotionalControl },
                { name: 'Risk Management', value: userAnalysis.riskManagement },
                { name: 'Discipline', value: userAnalysis.discipline },
                { name: 'Decision Making', value: userAnalysis.decisionMaking }
            ];
            
            metrics.forEach(metric => {
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(44, 62, 80);
                doc.text(`${metric.name}: ${metric.value}/10`, margin + 5, yPosition);
                
                // Add visual bar
                const barWidth = (metric.value / 10) * 80;
                doc.setFillColor(220, 220, 220);
                doc.rect(margin + 90, yPosition - 5, 80, 6, 'F');
                doc.setFillColor(102, 126, 234);
                doc.rect(margin + 90, yPosition - 5, barWidth, 6, 'F');
                
                yPosition += 12;
            });
            yPosition += 15;
            
            // Strengths Section
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(39, 174, 96);
            doc.text('Your Strengths', margin, yPosition);
            yPosition += 15;
            
            doc.setFillColor(232, 244, 253);
            doc.rect(margin, yPosition - 5, maxWidth, userAnalysis.strengths.length * 10 + 10, 'F');
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(44, 62, 80);
            userAnalysis.strengths.forEach(strength => {
                doc.text(`✓ ${strength}`, margin + 10, yPosition + 5);
                yPosition += 10;
            });
            yPosition += 15;
            
            // Weaknesses Section
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(231, 76, 60);
            doc.text('Key Areas for Improvement', margin, yPosition);
            yPosition += 15;
            
            doc.setFillColor(254, 242, 242);
            doc.rect(margin, yPosition - 5, maxWidth, userAnalysis.weaknesses.length * 10 + 10, 'F');
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(44, 62, 80);
            userAnalysis.weaknesses.forEach(weakness => {
                doc.text(`→ ${weakness}`, margin + 10, yPosition + 5);
                yPosition += 10;
            });
            yPosition += 20;
            
            // Check if we need a new page
            if (yPosition > 240) {
                doc.addPage();
                yPosition = 30;
            }
            
            // Action Plan Section
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.setTextColor(102, 126, 234);
            doc.text('Your Personalized Action Plan', margin, yPosition);
            yPosition += 20;
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.setTextColor(44, 62, 80);
            userAnalysis.recommendations.forEach((rec, index) => {
                // Add step number in a circle
                doc.setFillColor(102, 126, 234);
                doc.circle(margin + 8, yPosition - 2, 6, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFont(undefined, 'bold');
                doc.text((index + 1).toString(), margin + 8, yPosition + 1, { align: 'center' });
                
                // Add recommendation text
                doc.setTextColor(44, 62, 80);
                doc.setFont(undefined, 'normal');
                const lines = doc.splitTextToSize(rec, maxWidth - 25);
                lines.forEach((line, lineIndex) => {
                    doc.text(line, margin + 20, yPosition + (lineIndex * 6));
                });
                yPosition += (lines.length * 6) + 10;
            });
            
            yPosition += 15;
            
            // Professional Footer
            if (yPosition > 240) {
                doc.addPage();
                yPosition = 30;
            }
            
            doc.setFillColor(102, 126, 234);
            doc.rect(margin, yPosition, maxWidth, 40, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('Expert Insight', margin + 10, yPosition + 15);
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            doc.text('Based on 10+ years of market experience', margin + 10, yPosition + 25);
            doc.text('This analysis reflects your current trading psychology patterns and provides', margin + 10, yPosition + 32);
            doc.text('actionable steps for improvement.', margin + 10, yPosition + 37);
            
            // Save the PDF
            const fileName = `Trading-Psychology-Report-${userName}-Score-${userScore}.pdf`;
            doc.save(fileName);
            
            // Show success message and capture email
            submitEmail();
            alert(`🎉 Your personalized report has been downloaded!\n\nScore: ${userScore}/100\nReport: ${fileName}\n\nCheck your Downloads folder.`);
        }
        
        function submitEmail() {
            const email = document.getElementById('emailInput').value;
            if (email && email.includes('@')) {
                // Track email signup
                gtag('event', 'email_signup', {
                    'event_category': 'conversion',
                    'event_label': 'newsletter_signup'
                });
                
                alert('Perfect! Welcome to our trading psychology community. You\'ll receive advanced tips and strategies via email.');
                
                // You can add tracking/analytics here
                console.log('Email captured:', email);
                console.log('User score:', userScore);
            } else {
                alert('Please enter a valid email address.');
            }
        }
    </script>
</body>
</html>
